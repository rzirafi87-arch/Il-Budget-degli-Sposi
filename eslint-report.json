[{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\api.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\cresima-budget.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\cresima-page.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\cresima-timeline.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\dashboard-empty.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\dashboard-filled.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\dashboard.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used.","line":1,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent } from '@testing-library/react';\r\nimport '@testing-library/jest-dom';\nimport DashboardPage from '../dashboard/page';\n\r\ndescribe('DashboardPage', () => {\r\n  afterEach(() => {\r\n    // Ripristina localStorage dopo ogni test\r\n    Object.defineProperty(window, 'localStorage', {\r\n      value: {\r\n        getItem: () => '',\r\n        setItem: jest.fn(),\r\n      },\r\n      writable: true,\r\n    });\r\n  });\r\n\r\n  it('mostra schermata di selezione se lingua/nazione/evento non sono impostati', () => {\r\n    Object.defineProperty(window, 'localStorage', {\r\n      value: {\r\n        getItem: () => '',\r\n        setItem: jest.fn(),\r\n      },\r\n      writable: true,\r\n    });\r\n    render(<DashboardPage />);\r\n    expect(screen.getByText(/Seleziona lingua, nazione ed evento/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('mostra dashboard se lingua/nazione/evento sono impostati', () => {\r\n    Object.defineProperty(window, 'localStorage', {\r\n      value: {\r\n        getItem: (key: string) => {\r\n          if (key === 'language') return 'it';\r\n          if (key === 'country') return 'it';\r\n          if (key === 'eventType') return 'wedding';\r\n          return '';\r\n        },\r\n        setItem: jest.fn(),\r\n      },\r\n      writable: true,\r\n    });\r\n    render(<DashboardPage />);\r\n  expect(screen.getAllByText(/Dashboard/i).length).toBeGreaterThan(0);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\middleware.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\select-country.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\select-event-type-communion.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\select-event-type-confirmation.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\select-event-type-graduation.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\select-event-type.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\__tests__\\select-language.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\abbonamenti-fornitori\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\analytics\\track\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\atelier\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":51,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1668,1671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1668,1671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1699,1702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1699,1702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nexport const runtime = \"nodejs\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\n\r\n/**\r\n * GET /api/atelier\r\n * Recupera atelier per sposa/sposo con filtri opzionali\r\n * Query params:\r\n * - category: 'sposa' | 'sposo'\r\n * - region: regione italiana\r\n * - province: provincia\r\n * - city: cittÃ \r\n */\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const category = searchParams.get(\"category\"); // 'sposa' | 'sposo'\n    const region = searchParams.get(\"region\");\n    const province = searchParams.get(\"province\");\n    const city = searchParams.get(\"city\");\n    const country = searchParams.get(\"country\");\n\r\n    const db = getServiceClient();\r\n\r\n    let query = db\r\n      .from(\"atelier\")\r\n      .select(\"*\")\r\n      .order(\"name\", { ascending: true });\r\n\r\n    // Filtri\r\n    if (category) query = query.eq(\"category\", category);\r\n    if (region) query = query.eq(\"region\", region);\r\n    if (province) query = query.eq(\"province\", province);\r\n    if (city) query = query.ilike(\"city\", `%${city}%`);\r\n\r\n    let { data, error } = await query;\n    if (country) {\n      try {\n        ({ data, error } = await db\n          .from(\"atelier\")\n          .select(\"*\")\n          .match({\n            category: category || undefined,\n            region: region || undefined,\n            province: province || undefined,\n          })\n          .ilike(\"city\", city ? `%${city}%` : \"%%\")\n          .eq(\"country\", country)\n          .order(\"name\", { ascending: true }));\n      } catch (e: unknown) {\n        if (country !== \"it\") {\n          data = [] as any;\n          error = null as any;\n        }\n      }\n    }\n\r\n    if (error) {\r\n      console.error(\"Atelier fetch error:\", error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ atelier: data || [] });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"Atelier API error:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/atelier\r\n * Crea un nuovo atelier (richiede autenticazione)\r\n */\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const authHeader = req.headers.get(\"authorization\");\r\n    const jwt = authHeader?.split(\" \")[1];\r\n\r\n    if (!jwt) {\r\n      return NextResponse.json({ error: \"Autenticazione richiesta\" }, { status: 401 });\r\n    }\r\n\r\n    const db = getServiceClient();\r\n\r\n    // Verifica token\r\n    const { data: userData, error: authError } = await db.auth.getUser(jwt);\r\n    if (authError || !userData?.user) {\r\n      return NextResponse.json({ error: \"Non autenticato\" }, { status: 401 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const {\r\n      name,\r\n      category,\r\n      region,\r\n      province,\r\n      city,\r\n      address,\r\n      phone,\r\n      email,\r\n      website,\r\n      description,\r\n      price_range,\r\n      styles,\r\n      services,\r\n      capacity,\r\n    } = body;\r\n\r\n    // Validazione campi obbligatori\r\n    if (!name || !category || !region || !city) {\r\n      return NextResponse.json(\r\n        { error: \"Campi obbligatori: name, category, region, city\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (![\"sposa\", \"sposo\"].includes(category)) {\r\n      return NextResponse.json(\r\n        { error: \"category deve essere 'sposa' o 'sposo'\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const { data, error } = await db\r\n      .from(\"atelier\")\r\n      .insert({\r\n        name,\r\n        category,\r\n        region,\r\n        province,\r\n        city,\r\n        address,\r\n        phone,\r\n        email,\r\n        website,\r\n        description,\r\n        price_range,\r\n        styles: styles || [],\r\n        services: services || [],\r\n        capacity,\r\n        source: \"manual\",\r\n        verified: false,\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Atelier insert error:\", error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ atelier: data }, { status: 201 });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"Atelier POST error:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected error\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\auth\\register\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\baptism\\seed\\[eventId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\baptism\\seed\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\budget-ideas\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\budget-items\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\categories\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\chat\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":79,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3002,3005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3002,3005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\n\n// GET /api/chat -> returns availability status without exposing secrets\nexport async function GET() {\n  const enabled = Boolean(process.env.OPENAI_API_KEY);\n  return NextResponse.json({ enabled });\n}\n\n// POST /api/chat -> proxies a chat completion to OpenAI\nexport async function POST(req: NextRequest) {\n  try {\n    const OPENAI_API_KEY = process.env.OPENAI_API_KEY;\n    if (!OPENAI_API_KEY) {\n      return NextResponse.json(\n        { error: \"Servizio non disponibile: API Key OpenAI mancante.\", reply: \"\" },\n        { status: 503 }\n      );\n    }\n\n    const body = await req.json().catch(() => ({}));\n    const messages = Array.isArray(body?.messages) ? body.messages : [];\n    const requestedModel = typeof body?.model === \"string\" && body.model.trim().length > 0\n      ? body.model.trim()\n      : (process.env.OPENAI_MODEL?.trim() || \"gpt-4o-mini\");\n    const fallbackModels = (process.env.OPENAI_FALLBACK_MODELS || \"gpt-4o-mini\")\n      .split(\",\")\n      .map((m) => m.trim())\n      .filter(Boolean);\n    const uniqueModels = Array.from(new Set([requestedModel, ...fallbackModels]));\n    const temperature = typeof body?.temperature === \"number\" ? body.temperature : 0.7;\n\n    if (!Array.isArray(messages) || messages.length === 0) {\n      return NextResponse.json(\n        { error: \"Richiesta non valida: 'messages' mancante o vuoto.\", reply: \"\" },\n        { status: 400 }\n      );\n    }\n\n    // Try primary model, then fallbacks on quota/rate-limit/model errors\n    const tried: Array<{ model: string; status?: number; error?: string }> = [];\n    for (const model of uniqueModels) {\n      const res = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${OPENAI_API_KEY}`,\n        },\n        body: JSON.stringify({ model, messages, temperature }),\n      });\n\n      const data = await res.json().catch(() => ({}));\n\n      if (res.ok) {\n        const reply = data?.choices?.[0]?.message?.content || \"(Nessuna risposta)\";\n        return NextResponse.json({ reply, model, tried });\n      }\n\n      const message = data?.error?.message || \"Errore dal provider AI.\";\n      tried.push({ model, status: res.status, error: message });\n\n      // Fallback on typical quota/rate limit/model-not-found errors\n      const shouldFallback = [402, 403, 404, 409, 422, 429, 500, 503].includes(res.status)\n        || /quota|rate limit|model|insufficient/i.test(message || \"\");\n      if (!shouldFallback) {\n        return NextResponse.json(\n          { error: message, reply: \"\", tried },\n          { status: res.status }\n        );\n      }\n      // else continue to next model\n    }\n\n    // All models failed\n    const last = tried[tried.length - 1];\n    return NextResponse.json(\n      { error: last?.error || \"Tutti i modelli hanno fallito.\", reply: \"\", tried },\n      { status: last?.status || 503 }\n    );\n  } catch (err: any) {\n    return NextResponse.json(\n      { error: \"Errore interno inatteso.\", reply: \"\" },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\checklist-modules\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\churches\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1512,1515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1512,1515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3887,3890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3887,3890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nexport const runtime = \"nodejs\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\nimport { getFallbackChurches } from \"@/data/fallbackContent\";\n\r\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const region = searchParams.get(\"region\");\n    const province = searchParams.get(\"province\");\n    const churchType = searchParams.get(\"type\");\n    const country = searchParams.get(\"country\");\n\r\n    const db = getServiceClient();\r\n    \r\n    let query = db\n      .from(\"churches\")\n      .select(\"*\")\n      .order(\"verified\", { ascending: false })\n      .order(\"name\", { ascending: true });\n\r\n    if (region) {\r\n      query = query.eq(\"region\", region);\r\n    }\r\n    if (province) {\r\n      query = query.eq(\"province\", province);\r\n    }\r\n    if (churchType) {\r\n      query = query.eq(\"church_type\", churchType);\r\n    }\r\n\r\n    let data, error;\n    if (country) {\n      ({ data, error } = await query.eq(\"country\", country));\n      if (error && /column .*country.* does not exist/i.test(error.message)) {\n        ({ data, error } = await db\n          .from(\"churches\")\n          .select(\"*\")\n          .order(\"verified\", { ascending: false })\n          .order(\"name\", { ascending: true })\n          .match({ region: region || undefined, province: province || undefined, church_type: churchType || undefined }));\n        if (country && country !== \"it\") {\n          data = [];\n          error = null as any;\n        }\n      }\n    } else {\n      ({ data, error } = await query);\n    }\n\r\n    const normalizedCountry = country?.toLowerCase() ?? \"\";\n\n    if (error) {\n      console.error(\"CHURCHES GET error:\", error);\n      const fallback = getFallbackChurches(normalizedCountry, {\n        region,\n        province,\n        churchType,\n      });\n      if (fallback.length > 0) {\n        return NextResponse.json({ churches: fallback });\n      }\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    if (!data || data.length === 0) {\n      const fallback = getFallbackChurches(normalizedCountry, {\n        region,\n        province,\n        churchType,\n      });\n      if (fallback.length > 0) {\n        return NextResponse.json({ churches: fallback });\n      }\n    }\n\n    return NextResponse.json({ churches: data || [] });\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"CHURCHES GET uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const authHeader = req.headers.get(\"authorization\");\r\n    const jwt = authHeader?.split(\" \")[1];\r\n\r\n    if (!jwt) {\r\n      return NextResponse.json({ error: \"Autenticazione richiesta\" }, { status: 401 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const db = getServiceClient();\r\n    \r\n    const { data: userData, error: authError } = await db.auth.getUser(jwt);\r\n    if (authError || !userData?.user) {\r\n      return NextResponse.json({ error: \"Non autenticato\" }, { status: 401 });\r\n    }\r\n\r\n    const userId = userData.user.id;\r\n\r\n    // Try insert with optional country; if the column doesn't exist, retry without it\n    let insertError;\n    ({ error: insertError } = await db.from(\"churches\").insert({\n      name: body.name,\n      region: body.region,\n      province: body.province,\n      city: body.city,\n      address: body.address,\n      phone: body.phone,\n      email: body.email,\n      website: body.website,\n      description: body.description,\n      church_type: body.church_type,\n      capacity: body.capacity,\n      requires_baptism: body.requires_baptism,\n      requires_marriage_course: body.requires_marriage_course,\n      verified: false,\n      user_id: userId,\n      ...(body.country ? { country: body.country } : {}),\n    } as any));\n    if (insertError && /column .*country.* does not exist/i.test(insertError.message)) {\n      ({ error: insertError } = await db.from(\"churches\").insert({\n        name: body.name,\n        region: body.region,\n        province: body.province,\n        city: body.city,\n        address: body.address,\n        phone: body.phone,\n        email: body.email,\n        website: body.website,\n        description: body.description,\n        church_type: body.church_type,\n        capacity: body.capacity,\n        requires_baptism: body.requires_baptism,\n        requires_marriage_course: body.requires_marriage_course,\n        verified: false,\n        user_id: userId,\n      }));\n    }\n\r\n    if (insertError) {\r\n      console.error(\"CHURCHES POST error:\", insertError);\r\n      return NextResponse.json({ error: insertError.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ ok: true });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"CHURCHES POST uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\communion\\seed\\[eventId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\confirmation\\seed\\[eventId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\cron\\check-appointments\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\cron\\check-subscriptions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\eighteenth\\seed\\[eventId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\event-core\\new\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\event\\create\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2099,2102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2099,2102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\n\nexport const runtime = \"nodejs\";\n\ntype CreateBody = {\n  name?: string;\n  currency?: string;\n  total_budget?: number;\n  wedding_card?: {\n    bride_name?: string;\n    groom_name?: string;\n    wedding_date?: string; // YYYY-MM-DD\n  } | null;\n};\n\nexport async function POST(req: NextRequest) {\n  const db = getServiceClient();\n\n  const authHeader = req.headers.get(\"authorization\") || req.headers.get(\"Authorization\");\n  const jwt = authHeader?.split(\" \")[1];\n  if (!jwt) return NextResponse.json({ error: \"Missing JWT\" }, { status: 401 });\n\n  const { data: userData, error: authError } = await db.auth.getUser(jwt);\n  if (authError || !userData?.user?.id) return NextResponse.json({ error: \"Invalid JWT\" }, { status: 401 });\n\n  // If user already has an event, return it (idempotent create)\n  const { data: existing } = await db\n    .from(\"events\")\n    .select(\"id, name, currency, total_budget\")\n    .eq(\"owner_id\", userData.user.id)\n    .order(\"inserted_at\", { ascending: true })\n    .limit(1)\n    .maybeSingle();\n  if (existing) {\n    return NextResponse.json({ ok: true, event: existing });\n  }\n\n  const body = (await req.json().catch(() => ({}))) as CreateBody;\n  const payload = {\n    owner_id: userData.user.id,\n    name: body.name || \"Il nostro matrimonio\",\n    currency: body.currency || \"EUR\",\n    total_budget: body.total_budget ?? 0,\n  };\n\n  const { data: inserted, error } = await db.from(\"events\").insert(payload).select(\"id, name, currency, total_budget\").single();\n  if (error || !inserted) return NextResponse.json({ error: error?.message || \"Create failed\" }, { status: 500 });\n\n  // Optionally create wedding card\n  if (body.wedding_card && (body.wedding_card.bride_name || body.wedding_card.groom_name || body.wedding_card.wedding_date)) {\n    const wc = {\n      event_id: inserted.id,\n      bride_name: body.wedding_card.bride_name || null,\n      groom_name: body.wedding_card.groom_name || null,\n      wedding_date: body.wedding_card.wedding_date || null,\n    } as any;\n    await db.from(\"wedding_cards\").insert(wc).select(\"event_id\").maybeSingle();\n  }\n\n  return NextResponse.json({ ok: true, event: inserted });\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\event\\ensure-default\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\event\\new\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\event\\resolve\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\event\\update-budget\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\event\\update\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1301,1304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1301,1304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2037,2040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2037,2040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\n\nexport const runtime = \"nodejs\";\n\ntype UpdateBody = {\n  name?: string | null;\n  currency?: string | null;\n  total_budget?: number | null;\n  wedding_card?: {\n    bride_name?: string | null;\n    groom_name?: string | null;\n    wedding_date?: string | null; // YYYY-MM-DD\n  } | null;\n};\n\nexport async function PATCH(req: NextRequest) {\n  const db = getServiceClient();\n\n  const authHeader = req.headers.get(\"authorization\") || req.headers.get(\"Authorization\");\n  const jwt = authHeader?.split(\" \")[1];\n  if (!jwt) return NextResponse.json({ error: \"Missing JWT\" }, { status: 401 });\n\n  const { data: userData, error: authError } = await db.auth.getUser(jwt);\n  if (authError || !userData?.user?.id) return NextResponse.json({ error: \"Invalid JWT\" }, { status: 401 });\n\n  const body = (await req.json().catch(() => ({}))) as UpdateBody;\n\n  // Find user's event\n  const { data: ev } = await db\n    .from(\"events\")\n    .select(\"id, name, currency, total_budget\")\n    .eq(\"owner_id\", userData.user.id)\n    .order(\"inserted_at\", { ascending: true })\n    .limit(1)\n    .maybeSingle();\n  if (!ev) return NextResponse.json({ error: \"No event\" }, { status: 404 });\n\n  const updates: Record<string, any> = {};\n  if (body.name !== undefined) updates.name = body.name;\n  if (body.currency !== undefined) updates.currency = body.currency;\n  if (body.total_budget !== undefined) updates.total_budget = body.total_budget;\n  if (Object.keys(updates).length > 0) {\n    const { error: upErr } = await db.from(\"events\").update(updates).eq(\"id\", ev.id);\n    if (upErr) return NextResponse.json({ error: upErr.message }, { status: 500 });\n  }\n\n  if (body.wedding_card) {\n    // Upsert wedding card by event_id\n    const wc = {\n      event_id: ev.id,\n      bride_name: body.wedding_card.bride_name ?? undefined,\n      groom_name: body.wedding_card.groom_name ?? undefined,\n      wedding_date: body.wedding_card.wedding_date ?? undefined,\n    } as any;\n    // Check if exists\n    const { data: exists } = await db.from(\"wedding_cards\").select(\"event_id\").eq(\"event_id\", ev.id).maybeSingle();\n    if (exists) {\n      const { error: wcErr } = await db.from(\"wedding_cards\").update(wc).eq(\"event_id\", ev.id);\n      if (wcErr) return NextResponse.json({ error: wcErr.message }, { status: 500 });\n    } else {\n      const { error: wcErr } = await db.from(\"wedding_cards\").insert(wc);\n      if (wcErr) return NextResponse.json({ error: wcErr.message }, { status: 500 });\n    }\n  }\n\n  return NextResponse.json({ ok: true });\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\generate-wedding-pdf\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1063,1066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1063,1066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nexport const runtime = \"nodejs\";\r\nimport { getServiceClient } from '@/lib/supabaseServer';\r\n\r\n// Per generare il PDF useremo una libreria esterna da chiamare lato client\r\n// Questo endpoint restituisce i dati necessari per la generazione\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const supabase = getServiceClient();\r\n    const body = await request.json();\r\n\r\n    // Get current user's event\r\n    const { data: eventData } = await supabase\r\n      .from('events')\r\n      .select('id')\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (!eventData) {\r\n      return NextResponse.json({ error: 'No event found' }, { status: 404 });\r\n    }\r\n\r\n    // In futuro qui potremmo generare il PDF server-side con una libreria come PDFKit\r\n    // Per ora restituiamo i dati per la generazione client-side\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      message: 'PDF generation not implemented yet. Will be added in next iteration.',\r\n      data: body \r\n    });\r\n\r\n  } catch (err: any) {\r\n    console.error('Unexpected error:', err);\r\n    return NextResponse.json({ error: err.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\graduation\\seed\\[eventId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\health\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\idea-di-budget\\apply\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1157,1160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1157,1160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2151,2154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2151,2154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const runtime = \"nodejs\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\n\n// POST /api/idea-di-budget/apply\n// Body: { country?: string, rows?: Array<{ category?: string; subcategory?: string; spendType?: string; idea_amount?: number; amount?: number; name?: string; }> }\n// Effect: replaces user's budget_items for the given event and country with provided rows (amount > 0).\n// If rows are not provided, it pulls planned expenses saved from Idea di Budget (status='planned' AND from_dashboard=true).\nexport async function POST(req: NextRequest) {\n  const authHeader = req.headers.get(\"authorization\");\n  const jwt = authHeader?.split(\" \")[1];\n  if (!jwt) return NextResponse.json({ error: \"Not authenticated\" }, { status: 401 });\n\n  const db = getServiceClient();\n  const { data: userData, error } = await db.auth.getUser(jwt);\n  if (error || !userData?.user) return NextResponse.json({ error: \"Not authenticated\" }, { status: 401 });\n\n  const body = await req.json();\n  const country = (body?.country || req.nextUrl.searchParams.get(\"country\") || \"it\").toLowerCase();\n  let rows: any[] = Array.isArray(body?.rows) ? body.rows : Array.isArray(body) ? body : [];\n\n  // Find user's event\n  const { data: ev, error: evErr } = await db\n    .from(\"events\")\n    .select(\"id\")\n    .eq(\"owner_id\", userData.user.id)\n    .order(\"inserted_at\", { ascending: true })\n    .limit(1)\n    .single();\n  if (evErr || !ev?.id) return NextResponse.json({ error: \"No event found\" }, { status: 404 });\n\n  // If no rows provided, pull planned expenses from Idea di Budget\n  if (rows.length === 0) {\n    const { data: planned, error: qErr } = await db\n      .from(\"expenses\")\n      .select(`\n        committed_amount,\n        spend_type,\n        subcategory:subcategories!inner(\n          name,\n          category:categories!inner(name, event_id)\n        )\n      `)\n      .eq(\"subcategory.category.event_id\", ev.id)\n      .eq(\"status\", \"planned\")\n      .eq(\"from_dashboard\", true);\n    if (qErr) return NextResponse.json({ error: qErr.message }, { status: 500 });\n    rows = (planned || []).map((e: any) => ({\n      category: e.subcategory?.category?.name,\n      subcategory: e.subcategory?.name,\n      idea_amount: e.committed_amount,\n      spendType: e.spend_type || \"common\",\n    }));\n  }\n\n  // Normalize items\n  const items = rows\n    .map((r) => {\n      const amount = Number(r.idea_amount ?? r.amount ?? 0) || 0;\n      const category = r.category || \"\";\n      const sub = r.subcategory || \"\";\n      const st = (r.spendType || r.spend_type || \"common\") as string;\n      const name = r.name || [category, sub].filter(Boolean).join(\" - \") || \"Voce di budget\";\n      return { name, amount, spend_type: st };\n    })\n    .filter((it) => it.amount > 0);\n\n  // Replace current budget_items for this event+country created from ideas (we simply wipe all and reinsert for country)\n  // If your schema needs a discriminator, consider adding a \"source\" column; here we filter by country and event only.\n  const del = await db.from(\"budget_items\").delete().eq(\"event_id\", ev.id).eq(\"country_code\", country);\n  if (del.error) return NextResponse.json({ error: del.error.message }, { status: 500 });\n\n  if (items.length === 0) return NextResponse.json({ success: true, inserted: 0 });\n\n  const payload = items.map((it) => ({\n    event_id: ev.id,\n    country_code: country,\n    name: it.name,\n    amount: it.amount,\n    spend_type: it.spend_type,\n  }));\n\n  const { error: insErr, data } = await db.from(\"budget_items\").insert(payload).select();\n  if (insErr) return NextResponse.json({ error: insErr.message }, { status: 500 });\n  return NextResponse.json({ success: true, inserted: data?.length || 0 });\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\idea-di-budget\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\locations\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1718,1721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1718,1721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4070,4073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4070,4073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nexport const runtime = \"nodejs\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\nimport { getFallbackLocations } from \"@/data/fallbackContent\";\n\r\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const region = searchParams.get(\"region\");\n    const province = searchParams.get(\"province\");\n    const locationType = searchParams.get(\"type\");\n    const country = searchParams.get(\"country\");\n\n    const db = getServiceClient();\n    \n    let query = db\n      .from(\"locations\")\n      .select(\"*\")\n      .order(\"verified\", { ascending: false })\n      .order(\"name\", { ascending: true });\n\n    if (region) {\n      query = query.eq(\"region\", region);\n    }\n    if (province) {\n      query = query.eq(\"province\", province);\n    }\n    if (locationType) {\n      query = query.eq(\"location_type\", locationType);\n    }\n    // Try to filter by country if provided and column exists\n    let data, error;\n    if (country) {\n      ({ data, error } = await query.eq(\"country\", country));\n      if (error && /column .*country.* does not exist/i.test(error.message)) {\n        // Retry without country column\n        ({ data, error } = await db\n          .from(\"locations\")\n          .select(\"*\")\n          .order(\"verified\", { ascending: false })\n          .order(\"name\", { ascending: true })\n          .match({ region: region || undefined, province: province || undefined, location_type: locationType || undefined }));\n        // If schema lacks country, and user requested non-IT, avoid showing IT data by returning empty\n        if (country && country !== \"it\") {\n          data = [];\n          error = null as any;\n        }\n      }\n    } else {\n      ({ data, error } = await query);\n    }\n\n    const normalizedCountry = country?.toLowerCase() ?? \"\";\n\n    if (error) {\n      console.error(\"LOCATIONS GET error:\", error);\n      const fallback = getFallbackLocations(normalizedCountry, {\n        region,\n        province,\n        locationType,\n      });\n      if (fallback.length > 0) {\n        return NextResponse.json({ locations: fallback });\n      }\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    if (!data || data.length === 0) {\n      const fallback = getFallbackLocations(normalizedCountry, {\n        region,\n        province,\n        locationType,\n      });\n      if (fallback.length > 0) {\n        return NextResponse.json({ locations: fallback });\n      }\n    }\n\n    return NextResponse.json({ locations: data || [] });\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"LOCATIONS GET uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const authHeader = req.headers.get(\"authorization\");\r\n    const jwt = authHeader?.split(\" \")[1];\r\n\r\n    if (!jwt) {\r\n      return NextResponse.json({ error: \"Autenticazione richiesta\" }, { status: 401 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const db = getServiceClient();\r\n    \r\n    const { data: userData, error: authError } = await db.auth.getUser(jwt);\r\n    if (authError || !userData?.user) {\r\n      return NextResponse.json({ error: \"Non autenticato\" }, { status: 401 });\r\n    }\r\n\r\n    const userId = userData.user.id;\r\n\r\n    // Try insert with optional country; if schema lacks it, retry without\n    let insertError;\n    ({ error: insertError } = await db.from(\"locations\").insert({\n      name: body.name,\n      region: body.region,\n      province: body.province,\n      city: body.city,\n      address: body.address,\n      phone: body.phone,\n      email: body.email,\n      website: body.website,\n      description: body.description,\n      price_range: body.price_range,\n      capacity_min: body.capacity_min,\n      capacity_max: body.capacity_max,\n      location_type: body.location_type,\n      verified: false,\n      user_id: userId,\n      ...(body.country ? { country: body.country } : {}),\n    } as any));\n    if (insertError && /column .*country.* does not exist/i.test(insertError.message)) {\n      ({ error: insertError } = await db.from(\"locations\").insert({\n        name: body.name,\n        region: body.region,\n        province: body.province,\n        city: body.city,\n        address: body.address,\n        phone: body.phone,\n        email: body.email,\n        website: body.website,\n        description: body.description,\n        price_range: body.price_range,\n        capacity_min: body.capacity_min,\n        capacity_max: body.capacity_max,\n        location_type: body.location_type,\n        verified: false,\n        user_id: userId,\n      }));\n    }\n\r\n    if (insertError) {\r\n      console.error(\"LOCATIONS POST error:\", insertError);\r\n      return NextResponse.json({ error: insertError.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ ok: true });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"LOCATIONS POST uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\musica-cerimonia\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":39,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1267,1270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1267,1270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1298,1301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1298,1301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nexport const runtime = \"nodejs\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\n    const { searchParams } = new URL(req.url);\n    const region = searchParams.get(\"region\");\n    const province = searchParams.get(\"province\");\n    const country = searchParams.get(\"country\");\n\r\n    const db = getServiceClient();\r\n\r\n    let query = db\n      .from(\"musica_cerimonia\")\n      .select(\"*\")\n      .eq(\"status\", \"approved\")\n      .order(\"name\");\n\r\n    if (region) {\r\n      query = query.eq(\"region\", region);\r\n    }\r\n\r\n    if (province) {\r\n      query = query.ilike(\"province\", `%${province}%`);\r\n    }\r\n\r\n    let { data, error } = await query;\n    if (!error && country) {\n      try {\n        ({ data, error } = await db\n          .from(\"musica_cerimonia\")\n          .select(\"*\")\n          .eq(\"status\", \"approved\")\n          .match({ region: region || undefined })\n          .ilike(\"province\", province ? `%${province}%` : \"%%\")\n          .eq(\"country\", country)\n          .order(\"name\"));\n      } catch (e: unknown) {\n        // If country column missing and requested non-IT, return empty\n        if (country !== \"it\") {\n          data = [] as any;\n          error = null as any;\n        }\n      }\n    }\n\r\n    if (error) {\r\n      console.error(\"Musica cerimonia GET error:\", error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ musicians: data || [] });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"Musica cerimonia GET uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    \r\n    const {\r\n      name,\r\n      region,\r\n      province,\r\n      city,\r\n      phone,\r\n      email,\r\n      website,\r\n      description,\r\n      price_range,\r\n      music_type,\r\n    } = body;\r\n\r\n    if (!name || !region || !province || !city) {\r\n      return NextResponse.json(\r\n        { error: \"Campi obbligatori mancanti: name, region, province, city\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const db = getServiceClient();\r\n\r\n    const { error } = await db.from(\"musica_cerimonia\").insert({\r\n      name,\r\n      region,\r\n      province,\r\n      city,\r\n      phone: phone || null,\r\n      email: email || null,\r\n      website: website || null,\r\n      description: description || null,\r\n      price_range: price_range || null,\r\n      music_type: music_type || null,\r\n      verified: false,\r\n      status: \"pending\",\r\n    });\r\n\r\n    if (error) {\r\n      console.error(\"Musica cerimonia POST error:\", error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ ok: true });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"Musica cerimonia POST uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\musica-ricevimento\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":39,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1199,1202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1199,1202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1230,1233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1230,1233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nexport const runtime = \"nodejs\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\n    const { searchParams } = new URL(req.url);\n    const region = searchParams.get(\"region\");\n    const province = searchParams.get(\"province\");\n    const country = searchParams.get(\"country\");\n\r\n    const db = getServiceClient();\r\n\r\n    let query = db\n      .from(\"musica_ricevimento\")\n      .select(\"*\")\n      .eq(\"status\", \"approved\")\n      .order(\"name\");\n\r\n    if (region) {\r\n      query = query.eq(\"region\", region);\r\n    }\r\n\r\n    if (province) {\r\n      query = query.ilike(\"province\", `%${province}%`);\r\n    }\r\n\r\n    let { data, error } = await query;\n    if (!error && country) {\n      try {\n        ({ data, error } = await db\n          .from(\"musica_ricevimento\")\n          .select(\"*\")\n          .eq(\"status\", \"approved\")\n          .match({ region: region || undefined })\n          .ilike(\"province\", province ? `%${province}%` : \"%%\")\n          .eq(\"country\", country)\n          .order(\"name\"));\n      } catch (e: unknown) {\n        if (country !== \"it\") {\n          data = [] as any;\n          error = null as any;\n        }\n      }\n    }\n\r\n    if (error) {\r\n      console.error(\"Musica ricevimento GET error:\", error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ musicians: data || [] });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"Musica ricevimento GET uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    \r\n    const {\r\n      name,\r\n      region,\r\n      province,\r\n      city,\r\n      phone,\r\n      email,\r\n      website,\r\n      description,\r\n      price_range,\r\n      music_type,\r\n    } = body;\r\n\r\n    if (!name || !region || !province || !city) {\r\n      return NextResponse.json(\r\n        { error: \"Campi obbligatori mancanti: name, region, province, city\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const db = getServiceClient();\r\n\r\n    const { error } = await db.from(\"musica_ricevimento\").insert({\r\n      name,\r\n      region,\r\n      province,\r\n      city,\r\n      phone: phone || null,\r\n      email: email || null,\r\n      website: website || null,\r\n      description: description || null,\r\n      price_range: price_range || null,\r\n      music_type: music_type || null,\r\n      verified: false,\r\n      status: \"pending\",\r\n    });\r\n\r\n    if (error) {\r\n      console.error(\"Musica ricevimento POST error:\", error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ ok: true });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"Musica ricevimento POST uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\appointments\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\appointments\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\baptism-dashboard\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\budget-table\\route.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5323,5326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5323,5326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5752,5755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5752,5755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6517,6520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6517,6520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\categories\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\communion-dashboard\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\confirmation-dashboard\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\core-categories\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\dashboard\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\eighteenth-dashboard\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\expenses\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\expenses\\route.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3004,3007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3004,3007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\favorites\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\gift-list\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\graduation-dashboard\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\guests\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\incomes\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\incomes\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\subscription-transactions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\supplier-profile\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\tables\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1685,1688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1685,1688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1952,1955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1952,1955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2218,2221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2218,2221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2258,2261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2258,2261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2705,2708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2705,2708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4464,4467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4464,4467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\nimport { requireUser } from \"@/lib/apiAuth\";\r\nimport { logger } from \"@/lib/logger\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\n// GET: Carica tavoli e invitati disponibili\r\nexport async function GET(req: NextRequest) {\r\n  const authHeader = req.headers.get(\"authorization\");\r\n  const jwt = authHeader?.split(\" \")[1];\r\n\r\n  if (!jwt) {\r\n    // Demo mode: restituisci dati vuoti\r\n    return NextResponse.json({\r\n      tables: [],\r\n      availableGuests: [],\r\n    });\r\n  }\r\n\r\n  const db = getServiceClient();\r\n  const { data: userData, error: userError } = await db.auth.getUser(jwt);\r\n  if (userError) {\r\n    return NextResponse.json({ error: \"Not authenticated\" }, { status: 401 });\r\n  }\r\n  const userId = userData.user.id;\r\n\r\n  // Ottieni event_id dell'utente\r\n  const { data: events } = await db\r\n    .from(\"events\")\r\n    .select(\"id\")\r\n    .or(`user_id.eq.${userId},partner_user_id.eq.${userId}`)\r\n    .limit(1);\r\n  \r\n  if (!events || events.length === 0) {\r\n    return NextResponse.json({\r\n      tables: [],\r\n      availableGuests: [],\r\n    });\r\n  }\r\n  const eventId = events[0].id;\r\n\r\n  // Carica tavoli con le assegnazioni\r\n  const { data: tablesData } = await db\r\n    .from(\"tables\")\r\n    .select(`\r\n      id,\r\n      table_number,\r\n      table_name,\r\n      table_type,\r\n      total_seats,\r\n      notes,\r\n      table_assignments (\r\n        id,\r\n        guest_id,\r\n        seat_number,\r\n        guests (\r\n          id,\r\n          name\r\n        )\r\n      )\r\n    `)\r\n    .eq(\"event_id\", eventId)\r\n    .order(\"table_number\");\r\n\r\n  const tables = (tablesData || []).map((t: any) => ({\r\n    id: t.id,\r\n    tableNumber: t.table_number,\r\n    tableName: t.table_name || `Tavolo ${t.table_number}`,\r\n    tableType: t.table_type,\r\n    totalSeats: t.total_seats,\r\n    notes: t.notes || \"\",\r\n    assignedGuests: (t.table_assignments || []).map((ta: any) => ({\r\n      id: ta.id,\r\n      guestId: ta.guest_id,\r\n      guestName: ta.guests?.name || \"Sconosciuto\",\r\n      seatNumber: ta.seat_number,\r\n    })),\r\n  }));\r\n\r\n  // Carica invitati confermati non ancora assegnati\r\n  const assignedGuestIds = tables.flatMap((t: any) => \r\n    t.assignedGuests.map((ag: any) => ag.guestId)\r\n  );\r\n\r\n  const { data: guestsData } = await db\r\n    .from(\"guests\")\r\n    .select(`\r\n      id,\r\n      name,\r\n      guest_type,\r\n      exclude_from_family_table,\r\n      family_group_id,\r\n      family_groups (\r\n        family_name\r\n      )\r\n    `)\r\n    .eq(\"event_id\", eventId)\r\n    .eq(\"attending\", true)\r\n    .not(\"id\", \"in\", `(${assignedGuestIds.join(\",\") || \"''\"})`);\r\n\r\n  const availableGuests = (guestsData || []).map((g: any) => ({\r\n    id: g.id,\r\n    name: g.name,\r\n    guestType: g.guest_type,\r\n    excludeFromFamilyTable: g.exclude_from_family_table === true,\r\n    familyGroupId: g.family_group_id,\r\n    familyName: g.family_groups?.family_name,\r\n  }));\r\n\r\n  return NextResponse.json({\r\n    tables,\r\n    availableGuests,\r\n  });\r\n}\r\n\r\n// POST: Salva tavoli e assegnazioni\r\nexport async function POST(req: NextRequest) {\r\n  const db = getServiceClient();\r\n  const { userId } = await requireUser(req);\r\n\r\n  // Ottieni event_id\r\n  const { data: events } = await db\r\n    .from(\"events\")\r\n    .select(\"id\")\r\n    .or(`user_id.eq.${userId},partner_user_id.eq.${userId}`)\r\n    .limit(1);\r\n\r\n  if (!events || events.length === 0) {\r\n    return NextResponse.json({ error: \"Event not found\" }, { status: 404 });\r\n  }\r\n  const eventId = events[0].id;\r\n\r\n  const { tables } = await req.json();\r\n\r\n  // Elimina tutti i tavoli esistenti per questo evento (CASCADE eliminerÃ  anche le assegnazioni)\r\n  await db.from(\"tables\").delete().eq(\"event_id\", eventId);\r\n\r\n  // Inserisci nuovi tavoli\r\n  for (const table of tables) {\r\n    const { data: newTable, error: tableError } = await db\r\n      .from(\"tables\")\r\n      .insert({\r\n        event_id: eventId,\r\n        table_number: table.tableNumber,\r\n        table_name: table.tableName,\r\n        table_type: table.tableType,\r\n        total_seats: table.totalSeats,\r\n        notes: table.notes,\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (tableError || !newTable) {\r\n      logger.error(\"Errore inserimento tavolo\", { error: tableError });\r\n      continue;\r\n    }\r\n\r\n    // Inserisci assegnazioni per questo tavolo\r\n    if (table.assignedGuests && table.assignedGuests.length > 0) {\r\n      const assignments = table.assignedGuests.map((ag: any) => ({\r\n        table_id: newTable.id,\r\n        guest_id: ag.guestId,\r\n        seat_number: ag.seatNumber,\r\n      }));\r\n\r\n      const { error: assignError } = await db\r\n        .from(\"table_assignments\")\r\n        .insert(assignments);\r\n\r\n      if (assignError) {\r\n        logger.error(\"Errore inserimento assegnazioni\", { error: assignError });\r\n      }\r\n    }\r\n  }\r\n\r\n  return NextResponse.json({ success: true });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\wedding\\budget-focus\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\wedding\\localized\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\my\\wedding\\presets\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\public\\[publicId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[592,595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[592,595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[631,634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[631,634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[657,660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[657,660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1326,1329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1326,1329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nexport const runtime = \"nodejs\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\n\n// Public event lookup by public_id.\n// Compatible with both existing schema (name/public_id) and the new core schema (title/is_public/public_id).\n// Next.js 15+ may pass params as a Promise in the route context\nexport async function GET(\n  _req: NextRequest,\n  context: { params: Promise<{ publicId: string }> } | { params: { publicId: string } }\n) {\n  // Normalize params whether it's a Promise or a plain object\n  const params = (context as any)?.params?.then ? await (context as any).params : (context as any).params;\n  const publicId = params?.publicId as string | undefined;\n  if (!publicId) {\n    return NextResponse.json({ error: \"Missing publicId\" }, { status: 400 });\n  }\n\n  const db = getServiceClient();\n\n  // Try to fetch the event by public_id. We avoid selecting non-existent columns explicitly.\n  const { data: events, error } = await db\n    .from(\"events\")\n    .select(\"*\")\n    .eq(\"public_id\", publicId)\n    .limit(1);\n\n  if (error) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n  if (!events || events.length === 0) {\n    return NextResponse.json({ error: \"Event not found\" }, { status: 404 });\n  }\n\n  const ev = events[0] as any;\n\n  // Build a minimal, schema-agnostic response.\n  const response = {\n    id: ev.id,\n    public_id: ev.public_id,\n    title: ev.title ?? ev.name ?? null,\n    is_public: typeof ev.is_public === \"boolean\" ? ev.is_public : true, // assume public when fetching by public_id if flag absent\n    created_at: ev.created_at ?? ev.inserted_at ?? null,\n    type_id: ev.type_id ?? null,\n  };\n\n  return NextResponse.json({ event: response }, { status: 200 });\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\retirement\\route.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[182,185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[182,185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[194,197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[194,197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[200,203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[200,203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[253,256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[253,256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\retirement\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\seed\\[eventId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[835,838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[835,838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nexport const runtime = \"nodejs\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\n\r\nexport async function POST(\r\n  _req: NextRequest,\r\n  { params }: { params: Promise<{ eventId: string }> }\r\n) {\r\n  try {\r\n    const db = getServiceClient();\r\n    const { eventId } = await params;\r\n\r\n    if (!eventId) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Missing eventId in route params\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const { error } = await db.rpc(\"seed_full_event\", { p_event: eventId });\r\n\r\n    if (error) {\r\n      console.error(\"Supabase RPC seed_full_event error:\", error);\r\n      return NextResponse.json({ ok: false, error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ ok: true });\r\n  } catch (e: any) {\r\n    console.error(\"Route /api/seed/[eventId] error:\", e);\r\n    return NextResponse.json({ ok: false, error: e.message ?? \"Server error\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\share\\[token]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[457,460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[457,460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[522,525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[522,525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1995,1998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1995,1998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nexport const runtime = \"nodejs\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\n\n// Share token resolver: returns event info when token is valid (not expired).\n// Depends on table `event_share_tokens` from the new core schema.\nexport async function GET(\n  _req: NextRequest,\n  context: { params: Promise<{ token: string }> } | { params: { token: string } }\n) {\n  const params = (context as any)?.params?.then ? await (context as any).params : (context as any).params;\n  const token = params?.token as string | undefined;\n  if (!token) {\n    return NextResponse.json({ error: \"Missing token\" }, { status: 400 });\n  }\n\n  const db = getServiceClient();\n\n  // Validate token (must exist and not be expired)\n  const { data: tokens, error: tokErr } = await db\n    .from(\"event_share_tokens\")\n    .select(\"id, event_id, expires_at\")\n    .eq(\"token\", token)\n    .gt(\"expires_at\", new Date().toISOString())\n    .limit(1);\n\n  if (tokErr) {\n    // Likely the table does not exist if schema not applied yet\n    const isMissing = /relation .* does not exist/i.test(tokErr.message || \"\");\n    if (isMissing) {\n      return NextResponse.json(\n        { error: \"Missing table event_share_tokens. Run supabase-core-events-schema.sql.\", code: \"SCHEMA_NOT_APPLIED\" },\n        { status: 501 }\n      );\n    }\n    return NextResponse.json({ error: tokErr.message }, { status: 500 });\n  }\n\n  if (!tokens || tokens.length === 0) {\n    return NextResponse.json({ error: \"Invalid or expired token\" }, { status: 404 });\n  }\n\n  const t = tokens[0];\n\n  // Fetch event minimal information\n  const { data: events, error: evErr } = await db\n    .from(\"events\")\n    .select(\"*\")\n    .eq(\"id\", t.event_id)\n    .limit(1);\n\n  if (evErr) {\n    return NextResponse.json({ error: evErr.message }, { status: 500 });\n  }\n  if (!events || events.length === 0) {\n    return NextResponse.json({ error: \"Event not found\" }, { status: 404 });\n  }\n\n  const ev = events[0] as any;\n  const payload = {\n    id: ev.id,\n    public_id: ev.public_id ?? null,\n    title: ev.title ?? ev.name ?? null,\n    is_public: typeof ev.is_public === \"boolean\" ? ev.is_public : null,\n    created_at: ev.created_at ?? ev.inserted_at ?? null,\n    type_id: ev.type_id ?? null,\n    share_expires_at: t.expires_at,\n  };\n\n  return NextResponse.json({ event: payload }, { status: 200 });\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\share\\new\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2447,2450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2447,2450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nexport const runtime = \"nodejs\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\n\ntype Body = {\n  event_id?: string;\n  public_id?: string;\n  expires_in_days?: number;\n  token?: string;\n};\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = (await req.json().catch(() => ({}))) as Body;\n\n    const db = getServiceClient();\n    const authHeader = req.headers.get(\"authorization\");\n    const jwt = authHeader?.split(\" \")[1];\n    if (!jwt) {\n      return NextResponse.json({ error: \"Non autenticato\" }, { status: 401 });\n    }\n    const { data: authData, error: authErr } = await db.auth.getUser(jwt);\n    if (authErr || !authData?.user) {\n      return NextResponse.json({ error: \"Token non valido\" }, { status: 401 });\n    }\n    const userId = authData.user.id as string;\n\n    // Resolve event id\n    let eventId = body.event_id || null;\n    if (!eventId && body.public_id) {\n      const { data: evs, error: e1 } = await db\n        .from(\"events\")\n        .select(\"id\")\n        .eq(\"public_id\", body.public_id)\n        .limit(1);\n      if (e1) return NextResponse.json({ error: e1.message }, { status: 500 });\n      eventId = evs?.[0]?.id ?? null;\n    }\n    if (!eventId) {\n      return NextResponse.json({ error: \"Specificare event_id o public_id\" }, { status: 400 });\n    }\n\n    // Authorization: user must be owner/editor of the event\n    const { data: mems, error: mErr } = await db\n      .from(\"event_members\")\n      .select(\"role\")\n      .eq(\"event_id\", eventId)\n      .eq(\"user_id\", userId)\n      .limit(1);\n    if (mErr) return NextResponse.json({ error: mErr.message }, { status: 500 });\n    const role = mems?.[0]?.role as string | undefined;\n    if (!role || (role !== \"owner\" && role !== \"editor\")) {\n      return NextResponse.json({ error: \"Non autorizzato\" }, { status: 403 });\n    }\n\n    // Create token (RPC ensures uniqueness and returns token + expiry)\n    const expires = typeof body.expires_in_days === \"number\" ? body.expires_in_days : 7;\n    const { data, error } = await db.rpc(\"create_share_token\", {\n      public_id: body.public_id ?? null,\n      expires_in_days: expires,\n      p_token: body.token ?? null,\n    });\n    if (error) return NextResponse.json({ error: error.message }, { status: 500 });\n\n    // Supabase returns either object or array depending on function; normalize\n    const row = Array.isArray(data) ? data[0] : (data as any);\n    return NextResponse.json({ token: row?.token, expires_at: row?.expires_at }, { status: 200 });\n  } catch (e: unknown) {\n    const error = e as Error;\n    console.error(\"SHARE/NEW â Uncaught:\", error);\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\stripe\\checkout\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\stripe\\webhook\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[989,992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[989,992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1982,1985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1982,1985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nexport const runtime = \"nodejs\";\nimport { getServiceClient } from \"@/lib/supabaseServer\";\nimport { sendSubscriptionActivated } from \"@/lib/emailService\";\nimport Stripe from \"stripe\";\n\n// Initialize Stripe using account default API version to avoid mismatches\nconst stripe = process.env.STRIPE_SECRET_KEY\n  ? new Stripe(process.env.STRIPE_SECRET_KEY)\n  : null;\n\nconst webhookSecret = process.env.STRIPE_WEBHOOK_SECRET || \"\";\n\nexport async function POST(req: NextRequest) {\n  try {\n    if (!stripe) {\n      return NextResponse.json({ error: \"Stripe not configured\" }, { status: 503 });\n    }\n\n    const body = await req.text();\n    const signature = req.headers.get(\"stripe-signature\");\n\n    if (!signature) {\n      return NextResponse.json({ error: \"Missing signature\" }, { status: 400 });\n    }\n\n    let event: Stripe.Event;\n\n    try {\n      event = stripe.webhooks.constructEvent(body, signature, webhookSecret);\n    } catch (err: any) {\n      console.error(\"Webhook signature verification failed:\", err.message);\n      return NextResponse.json({ error: \"Invalid signature\" }, { status: 400 });\n    }\n\n    const db = getServiceClient();\n\n    // Handle Stripe events\n    switch (event.type) {\n      case \"checkout.session.completed\": {\n        const session = event.data.object as Stripe.Checkout.Session;\n\n        const metadata = session.metadata;\n        if (!metadata) break;\n\n        const { tier, billing_period, supplier_id, location_id, church_id } = metadata as Record<string, string>;\n        const amount = (session.amount_total || 0) / 100;\n\n        // Calculate start and expiry dates\n        const startsAt = new Date();\n        const expiresAt = new Date();\n\n        if (billing_period === \"monthly\") {\n          expiresAt.setMonth(expiresAt.getMonth() + 1);\n        } else {\n          expiresAt.setFullYear(expiresAt.getFullYear() + 1);\n        }\n\n        // Create transaction\n        const transactionData: any = {\n          tier,\n          amount,\n          currency: \"EUR\",\n          billing_period,\n          payment_provider: \"stripe\",\n          payment_id: String(session.payment_intent || \"\"),\n          status: \"completed\",\n          starts_at: startsAt.toISOString(),\n          expires_at: expiresAt.toISOString(),\n        };\n\n        if (supplier_id) transactionData.supplier_id = supplier_id;\n        if (location_id) transactionData.location_id = location_id;\n        if (church_id) transactionData.church_id = church_id;\n\n        const { error: txError } = await db\n          .from(\"subscription_transactions\")\n          .insert(transactionData);\n\n        if (txError) {\n          console.error(\"Error creating transaction:\", txError);\n          break;\n        }\n\n        // Update related entity with new tier\n        let entityEmail = \"\";\n        let entityName = \"\";\n\n        if (supplier_id) {\n          const { data: supplier } = await db\n            .from(\"suppliers\")\n            .update({\n              subscription_tier: tier,\n              subscription_expires_at: expiresAt.toISOString(),\n            })\n            .eq(\"id\", supplier_id)\n            .select(\"email, name\")\n            .single();\n\n          if (supplier) {\n            entityEmail = supplier.email || \"\";\n            entityName = supplier.name || \"\";\n          }\n        } else if (location_id) {\n          const { data: location } = await db\n            .from(\"locations\")\n            .update({\n              subscription_tier: tier,\n              subscription_expires_at: expiresAt.toISOString(),\n            })\n            .eq(\"id\", location_id)\n            .select(\"email, name\")\n            .single();\n\n          if (location) {\n            entityEmail = location.email || \"\";\n            entityName = location.name || \"\";\n          }\n        } else if (church_id) {\n          const { data: church } = await db\n            .from(\"churches\")\n            .update({\n              subscription_tier: tier,\n              subscription_expires_at: expiresAt.toISOString(),\n            })\n            .eq(\"id\", church_id)\n            .select(\"email, name\")\n            .single();\n\n          if (church) {\n            entityEmail = church.email || \"\";\n            entityName = church.name || \"\";\n          }\n        }\n\n        // Send confirmation email\n        if (entityEmail && entityName) {\n          await sendSubscriptionActivated(\n            entityEmail,\n            entityName,\n            tier,\n            expiresAt,\n            billing_period\n          );\n        }\n\n        console.log(\"Subscription activated:\", { tier, billing_period, supplier_id, location_id, church_id });\n        break;\n      }\n\n      case \"payment_intent.payment_failed\": {\n        const paymentIntent = event.data.object as Stripe.PaymentIntent;\n        console.error(\"Payment failed:\", paymentIntent.id);\n\n        // Update transaction as failed\n        await db\n          .from(\"subscription_transactions\")\n          .update({ status: \"failed\" })\n          .eq(\"payment_id\", paymentIntent.id);\n        break;\n      }\n\n      default:\n        console.log(`Unhandled event type: ${event.type}`);\n    }\n\n    return NextResponse.json({ received: true });\n  } catch (e: unknown) {\n    const error = e as Error;\n    console.error(\"STRIPE WEBHOOK error:\", error);\n    return NextResponse.json({ error: error?.message || \"Webhook error\" }, { status: 500 });\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\subscription-featured\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\subscription-packages\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nexport const runtime = \"nodejs\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const db = getServiceClient();\r\n    \r\n    const { data: packages, error } = await db\r\n      .from(\"subscription_packages\")\r\n      .select(\"*\")\r\n      .eq(\"is_active\", true)\r\n      .order(\"display_order\");\r\n\r\n    if (error) {\r\n      console.error(\"PACKAGES GET error:\", error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ packages: packages || [] });\r\n  } catch (e: unknown) {\r\n    const error = e as Error;\r\n    console.error(\"PACKAGES GET uncaught:\", error);\r\n    return NextResponse.json({ error: error?.message || \"Unexpected\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\subscription-transactions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\suppliers\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\suppliers\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\sync\\osm\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":287,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8091,8094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8091,8094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9271,9274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9271,9274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const runtime = \"nodejs\";\r\n\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\n\r\n/**\r\n * OpenStreetMap (Overpass API) sync endpoint\r\n * GET /api/sync/osm?area=Provincia di Agrigento&type=church\r\n * \r\n * Syncs wedding venues and churches from OpenStreetMap to normalized schema\r\n */\r\n\r\nconst OVERPASS_API = \"https://overpass-api.de/api/interpreter\";\r\n\r\n// Type to OSM tag mapping\r\nconst OSM_QUERIES = {\r\n  church: `\r\n    [out:json][timeout:90];\r\n    area[\"name\"=\"{AREA}\"][\"admin_level\"~\"6|7|8\"]->.searchArea;\r\n    (\r\n      node[\"amenity\"=\"place_of_worship\"][\"religion\"=\"christian\"](area.searchArea);\r\n      way[\"amenity\"=\"place_of_worship\"][\"religion\"=\"christian\"](area.searchArea);\r\n      relation[\"amenity\"=\"place_of_worship\"][\"religion\"=\"christian\"](area.searchArea);\r\n    );\r\n    out center tags;\r\n  `,\r\n  \r\n  location: `\r\n    [out:json][timeout:90];\r\n    area[\"name\"=\"{AREA}\"][\"admin_level\"~\"6|7|8\"]->.searchArea;\r\n    (\r\n      node[\"tourism\"~\"hotel|guest_house\"][\"wedding\"=\"yes\"](area.searchArea);\r\n      way[\"tourism\"~\"hotel|guest_house\"][\"wedding\"=\"yes\"](area.searchArea);\r\n      node[\"amenity\"=\"events_venue\"](area.searchArea);\r\n      way[\"amenity\"=\"events_venue\"](area.searchArea);\r\n      node[\"building\"=\"castle\"](area.searchArea);\r\n      way[\"building\"=\"castle\"](area.searchArea);\r\n      node[\"historic\"~\"castle|manor|villa\"](area.searchArea);\r\n      way[\"historic\"~\"castle|manor|villa\"](area.searchArea);\r\n    );\r\n    out center tags;\r\n  `,\r\n};\r\n\r\ninterface OSMElement {\r\n  type: \"node\" | \"way\" | \"relation\";\r\n  id: number;\r\n  lat?: number;\r\n  lon?: number;\r\n  center?: { lat: number; lon: number };\r\n  tags: Record<string, string>;\r\n}\r\n\r\ninterface OSMResponse {\r\n  elements: OSMElement[];\r\n}\r\n\r\nasync function queryOverpass(query: string): Promise<OSMElement[]> {\r\n  const response = await fetch(OVERPASS_API, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n    },\r\n    body: `data=${encodeURIComponent(query)}`,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text();\r\n    throw new Error(`Overpass API error: ${response.status} - ${error}`);\r\n  }\r\n\r\n  const data: OSMResponse = await response.json();\r\n  return data.elements || [];\r\n}\r\n\r\nfunction extractCoordinates(element: OSMElement): { lat: number; lng: number } | null {\r\n  if (element.lat && element.lon) {\r\n    return { lat: element.lat, lng: element.lon };\r\n  }\r\n  \r\n  if (element.center) {\r\n    return { lat: element.center.lat, lng: element.center.lon };\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\nfunction extractName(tags: Record<string, string>): string {\r\n  return (\r\n    tags.name ||\r\n    tags[\"name:it\"] ||\r\n    tags[\"official_name\"] ||\r\n    tags[\"loc_name\"] ||\r\n    \"Unknown\"\r\n  );\r\n}\r\n\r\nfunction extractChurchType(tags: Record<string, string>): string {\r\n  const denomination = tags.denomination || \"\";\r\n  const building = tags.building || \"\";\r\n  \r\n  if (denomination.includes(\"catholic\")) return \"Chiesa Cattolica\";\r\n  if (building === \"cathedral\") return \"Cattedrale\";\r\n  if (building === \"basilica\") return \"Basilica\";\r\n  if (tags.tourism === \"attraction\") return \"Santuario\";\r\n  \r\n  return \"Chiesa\";\r\n}\r\n\r\nfunction extractAddress(tags: Record<string, string>): {\r\n  address: string;\r\n  city: string;\r\n  province: string;\r\n  postalCode?: string;\r\n} {\r\n  const street = tags[\"addr:street\"] || \"\";\r\n  const houseNumber = tags[\"addr:housenumber\"] || \"\";\r\n  const city = tags[\"addr:city\"] || tags[\"addr:town\"] || tags[\"addr:village\"] || \"Unknown\";\r\n  const province = tags[\"addr:province\"] || tags[\"addr:county\"] || \"Unknown\";\r\n  const postalCode = tags[\"addr:postcode\"];\r\n\r\n  const address = [street, houseNumber].filter(Boolean).join(\", \");\r\n\r\n  return { address, city, province, postalCode };\r\n}\r\n\r\nfunction extractContact(tags: Record<string, string>): {\r\n  phone?: string;\r\n  email?: string;\r\n  website?: string;\r\n} {\r\n  const phone = tags.phone || tags[\"contact:phone\"];\r\n  const email = tags.email || tags[\"contact:email\"];\r\n  const website = tags.website || tags[\"contact:website\"] || tags.url;\r\n\r\n  return { phone, email, website };\r\n}\r\n\r\nfunction extractDescription(element: OSMElement, type: string): string {\r\n  const tags = element.tags;\r\n  const parts: string[] = [];\r\n\r\n  if (type === \"church\") {\r\n    const churchType = extractChurchType(tags);\r\n    parts.push(churchType);\r\n\r\n    if (tags.denomination) {\r\n      parts.push(tags.denomination);\r\n    }\r\n\r\n    if (tags[\"heritage:operator\"]) {\r\n      parts.push(\"Bene tutelato\");\r\n    }\r\n\r\n    if (tags.wikipedia) {\r\n      parts.push(\"Documentata su Wikipedia\");\r\n    }\r\n  } else if (type === \"location\") {\r\n    if (tags.tourism === \"hotel\") {\r\n      parts.push(\"Hotel\");\r\n    } else if (tags.building === \"castle\") {\r\n      parts.push(\"Castello\");\r\n    } else if (tags.historic) {\r\n      parts.push(`Edificio storico (${tags.historic})`);\r\n    }\r\n\r\n    if (tags.stars) {\r\n      parts.push(`${tags.stars} stelle`);\r\n    }\r\n\r\n    if (tags.capacity) {\r\n      parts.push(`CapacitÃ : ${tags.capacity} persone`);\r\n    }\r\n  }\r\n\r\n  if (tags.description) {\r\n    parts.push(tags.description);\r\n  }\r\n\r\n  return parts.join(\" â¢ \");\r\n}\r\n\r\nasync function syncOSMData(\r\n  area: string,\r\n  type: string,\r\n  region: string\r\n): Promise<{ count: number; newCount: number }> {\r\n  const db = getServiceClient();\r\n\r\n  // Create sync job\r\n  const { data: job } = await db\r\n    .from(\"sync_jobs\")\r\n    .insert({\r\n      source: \"osm\",\r\n      type,\r\n      region,\r\n      status: \"running\",\r\n      started_at: new Date().toISOString(),\r\n    })\r\n    .select()\r\n    .single();\r\n\r\n  const jobId = job?.id;\r\n\r\n  try {\r\n    const queryTemplate = OSM_QUERIES[type as keyof typeof OSM_QUERIES];\r\n    if (!queryTemplate) {\r\n      throw new Error(`Unknown type: ${type}`);\r\n    }\r\n\r\n    // Replace area placeholder\r\n    const query = queryTemplate.replace(/{AREA}/g, area);\r\n\r\n    console.log(`Querying Overpass for ${type} in ${area}...`);\r\n    const elements = await queryOverpass(query);\r\n\r\n    let totalCount = 0;\r\n    let newCount = 0;\r\n\r\n    for (const element of elements) {\r\n      const coords = extractCoordinates(element);\r\n      if (!coords) {\r\n        console.warn(`Skipping element ${element.id}: no coordinates`);\r\n        continue;\r\n      }\r\n\r\n      const name = extractName(element.tags);\r\n      if (name === \"Unknown\") {\r\n        console.warn(`Skipping element ${element.id}: no name`);\r\n        continue;\r\n      }\r\n\r\n      const addressInfo = extractAddress(element.tags);\r\n      const contactInfo = extractContact(element.tags);\r\n      const description = extractDescription(element, type);\r\n\r\n      // Generate OSM ID\r\n      const osmId = `osm:${element.type}/${element.id}`;\r\n\r\n      // Upsert vendor\r\n      const { error } = await db.rpc(\"upsert_vendor\", {\r\n        p_name: name,\r\n        p_type: type,\r\n        p_source: \"osm\",\r\n        p_source_id: osmId,\r\n        p_phone: contactInfo.phone,\r\n        p_email: contactInfo.email,\r\n        p_website: contactInfo.website,\r\n        p_description: description || null,\r\n        p_metadata: {\r\n          osm_tags: element.tags,\r\n          osm_type: element.type,\r\n          osm_id: element.id,\r\n        },\r\n        p_osm_id: osmId,\r\n        p_lat: coords.lat,\r\n        p_lng: coords.lng,\r\n        p_address: addressInfo.address || null,\r\n        p_city: addressInfo.city,\r\n        p_province: addressInfo.province,\r\n        p_region: region,\r\n        p_postal_code: addressInfo.postalCode,\r\n      });\r\n\r\n      if (!error) {\r\n        totalCount++;\r\n        newCount++;\r\n      } else {\r\n        console.error(`Failed to upsert ${name}:`, error);\r\n      }\r\n\r\n      // Rate limiting: 100ms between requests\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n    }\r\n\r\n    // Update job as completed\r\n    await db\r\n      .from(\"sync_jobs\")\r\n      .update({\r\n        status: \"completed\",\r\n        results_count: totalCount,\r\n        completed_at: new Date().toISOString(),\r\n      })\r\n      .eq(\"id\", jobId);\r\n\r\n    return { count: totalCount, newCount };\r\n  } catch (error: any) {\r\n    // Update job as failed\r\n    await db\r\n      .from(\"sync_jobs\")\r\n      .update({\r\n        status: \"failed\",\r\n        error_message: error.message,\r\n        completed_at: new Date().toISOString(),\r\n      })\r\n      .eq(\"id\", jobId);\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const area = searchParams.get(\"area\");\r\n    const type = searchParams.get(\"type\");\r\n    const region = searchParams.get(\"region\");\r\n\r\n    if (!area || !type) {\r\n      return NextResponse.json(\r\n        { error: \"Missing required parameters: area, type\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Try to infer region from area if not provided\r\n    const inferredRegion = region || area.split(\" \").pop() || \"Unknown\";\r\n\r\n    const result = await syncOSMData(area, type, inferredRegion);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      area,\r\n      type,\r\n      region: inferredRegion,\r\n      count: result.count,\r\n      newCount: result.newCount,\r\n      message: `Synced ${result.count} vendors (${result.newCount} new) for ${type} in ${area}`,\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"OSM sync error:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"OSM sync failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\sync\\places\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\sync\\wikidata\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7559,7562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7559,7562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":254,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8441,8444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8441,8444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const runtime = \"nodejs\";\r\n\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\n\r\n/**\r\n * Wikidata SPARQL sync endpoint\r\n * GET /api/sync/wikidata?region=all&force=false\r\n * \r\n * Syncs historic venues (villas, castles, manors) from Wikidata to normalized schema\r\n */\r\n\r\nconst SPARQL_ENDPOINT = \"https://query.wikidata.org/sparql\";\r\n\r\n// SPARQL query to find historic wedding venues in Italy\r\nconst SPARQL_QUERY = `\r\nSELECT DISTINCT ?item ?itemLabel ?coord ?address ?website ?phone ?image ?description\r\nWHERE {\r\n  ?item wdt:P31/wdt:P279* wd:Q23413 .  # Instance of building or subclass\r\n  ?item wdt:P17 wd:Q38 .                 # Located in Italy\r\n  \r\n  # Must have coordinates\r\n  ?item wdt:P625 ?coord .\r\n  \r\n  # Filter for historic venues (villas, castles, palaces, manors)\r\n  VALUES ?venueType {\r\n    wd:Q3950          # villa\r\n    wd:Q23413         # castle\r\n    wd:Q16560         # palace\r\n    wd:Q879050        # manor house\r\n    wd:Q1343246       # historic house\r\n  }\r\n  ?item wdt:P31 ?venueType .\r\n  \r\n  # Optional fields\r\n  OPTIONAL { ?item wdt:P6375 ?address . }\r\n  OPTIONAL { ?item wdt:P856 ?website . }\r\n  OPTIONAL { ?item wdt:P1329 ?phone . }\r\n  OPTIONAL { ?item wdt:P18 ?image . }\r\n  OPTIONAL { ?item schema:description ?description . FILTER(LANG(?description) = \"it\") }\r\n  \r\n  # Get labels in Italian\r\n  SERVICE wikibase:label { bd:serviceParam wikibase:language \"it,en\" . }\r\n}\r\nLIMIT 500\r\n`;\r\n\r\ninterface WikidataResult {\r\n  item: { value: string };\r\n  itemLabel: { value: string };\r\n  coord: { value: string }; // \"Point(lng lat)\"\r\n  address?: { value: string };\r\n  website?: { value: string };\r\n  phone?: { value: string };\r\n  image?: { value: string };\r\n  description?: { value: string };\r\n}\r\n\r\ninterface WikidataResponse {\r\n  results: {\r\n    bindings: WikidataResult[];\r\n  };\r\n}\r\n\r\nasync function fetchWikidataVenues(): Promise<WikidataResult[]> {\r\n  const response = await fetch(SPARQL_ENDPOINT, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n      \"Accept\": \"application/json\",\r\n      \"User-Agent\": \"Il-Budget-degli-Sposi/1.0 (wedding planning app)\",\r\n    },\r\n    body: `query=${encodeURIComponent(SPARQL_QUERY)}`,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text();\r\n    throw new Error(`Wikidata SPARQL error: ${response.status} - ${error}`);\r\n  }\r\n\r\n  const data: WikidataResponse = await response.json();\r\n  return data.results.bindings;\r\n}\r\n\r\nfunction parseCoordinates(coordString: string): { lat: number; lng: number } | null {\r\n  // Format: \"Point(lng lat)\"\r\n  const match = coordString.match(/Point\\(([0-9.-]+)\\s+([0-9.-]+)\\)/);\r\n  if (!match) return null;\r\n\r\n  return {\r\n    lng: parseFloat(match[1]),\r\n    lat: parseFloat(match[2]),\r\n  };\r\n}\r\n\r\n// Reverse geocode to get region from coordinates\r\nfunction getRegionFromCoords(lat: number, lng: number): string {\r\n  // Simplified region mapping based on coordinates\r\n  // In production, use a proper reverse geocoding service\r\n  \r\n  if (lat >= 37.0 && lat <= 38.5 && lng >= 12.0 && lng <= 15.5) return \"Sicilia\";\r\n  if (lat >= 38.5 && lat <= 41.5 && lng >= 15.5 && lng <= 18.5) return \"Calabria\";\r\n  if (lat >= 39.5 && lat <= 42.0 && lng >= 15.0 && lng <= 19.0) return \"Puglia\";\r\n  if (lat >= 40.0 && lat <= 41.5 && lng >= 13.5 && lng <= 15.5) return \"Campania\";\r\n  if (lat >= 41.0 && lat <= 42.5 && lng >= 11.5 && lng <= 13.5) return \"Lazio\";\r\n  if (lat >= 39.0 && lat <= 41.5 && lng >= 8.0 && lng <= 10.0) return \"Sardegna\";\r\n  if (lat >= 42.5 && lat <= 44.5 && lng >= 10.0 && lng <= 12.5) return \"Toscana\";\r\n  if (lat >= 43.0 && lat <= 44.0 && lng >= 12.0 && lng <= 14.0) return \"Marche\";\r\n  if (lat >= 42.5 && lat <= 43.5 && lng >= 11.5 && lng <= 13.0) return \"Umbria\";\r\n  if (lat >= 41.5 && lat <= 43.0 && lng >= 13.0 && lng <= 14.5) return \"Abruzzo\";\r\n  if (lat >= 41.0 && lat <= 42.0 && lng >= 14.0 && lng <= 15.5) return \"Molise\";\r\n  if (lat >= 39.5 && lat <= 41.0 && lng >= 15.5 && lng <= 17.0) return \"Basilicata\";\r\n  if (lat >= 44.0 && lat <= 46.0 && lng >= 7.5 && lng <= 9.5) return \"Piemonte\";\r\n  if (lat >= 45.0 && lat <= 46.5 && lng >= 8.5 && lng <= 10.5) return \"Lombardia\";\r\n  if (lat >= 44.0 && lat <= 45.5 && lng >= 10.5 && lng <= 13.0) return \"Veneto\";\r\n  if (lat >= 44.0 && lat <= 45.5 && lng >= 9.5 && lng <= 12.5) return \"Emilia-Romagna\";\r\n  if (lat >= 45.5 && lat <= 47.0 && lng >= 12.0 && lng <= 14.0) return \"Friuli-Venezia Giulia\";\r\n  if (lat >= 46.0 && lat <= 47.5 && lng >= 10.5 && lng <= 12.5) return \"Trentino-Alto Adige\";\r\n  if (lat >= 44.0 && lat <= 45.0 && lng >= 7.5 && lng <= 10.0) return \"Liguria\";\r\n  if (lat >= 45.5 && lat <= 46.0 && lng >= 6.5 && lng <= 8.0) return \"Valle d'Aosta\";\r\n  \r\n  return \"Italia\"; // Fallback\r\n}\r\n\r\nasync function syncWikidataVenues(force: boolean = false): Promise<{ count: number; newCount: number }> {\r\n  const db = getServiceClient();\r\n  \r\n  // Check if already synced recently (last 30 days) unless force=true\r\n  if (!force) {\r\n    const { data: recentSync } = await db\r\n      .from(\"sync_jobs\")\r\n      .select(\"*\")\r\n      .eq(\"source\", \"wikidata\")\r\n      .eq(\"type\", \"location\")\r\n      .eq(\"status\", \"completed\")\r\n      .gte(\"completed_at\", new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString())\r\n      .single();\r\n\r\n    if (recentSync) {\r\n      return { count: recentSync.results_count, newCount: 0 };\r\n    }\r\n  }\r\n\r\n  // Create sync job\r\n  const { data: job } = await db\r\n    .from(\"sync_jobs\")\r\n    .insert({\r\n      source: \"wikidata\",\r\n      type: \"location\",\r\n      region: \"all\",\r\n      status: \"running\",\r\n      started_at: new Date().toISOString(),\r\n    })\r\n    .select()\r\n    .single();\r\n\r\n  const jobId = job?.id;\r\n\r\n  try {\r\n    const venues = await fetchWikidataVenues();\r\n    let totalCount = 0;\r\n    let newCount = 0;\r\n\r\n    for (const venue of venues) {\r\n      const coords = parseCoordinates(venue.coord.value);\r\n      if (!coords) continue;\r\n\r\n      const region = getRegionFromCoords(coords.lat, coords.lng);\r\n      const wikidataId = venue.item.value.split(\"/\").pop() || \"\";\r\n\r\n      // Upsert vendor using stored procedure\r\n      const { error } = await db.rpc(\"upsert_vendor\", {\r\n        p_name: venue.itemLabel.value,\r\n        p_type: \"location\",\r\n        p_source: \"wikidata\",\r\n        p_source_id: wikidataId,\r\n        p_phone: venue.phone?.value,\r\n        p_website: venue.website?.value,\r\n        p_rating: null,\r\n        p_rating_count: 0,\r\n        p_description: venue.description?.value,\r\n        p_price_range: null,\r\n        p_metadata: {\r\n          wikidata_url: venue.item.value,\r\n          image: venue.image?.value,\r\n          venue_type: \"historic\",\r\n        },\r\n        p_google_place_id: null,\r\n        p_lat: coords.lat,\r\n        p_lng: coords.lng,\r\n        p_address: venue.address?.value,\r\n        p_city: null,\r\n        p_province: null,\r\n        p_region: region,\r\n        p_postal_code: null,\r\n      });\r\n\r\n      if (!error) {\r\n        totalCount++;\r\n        newCount++;\r\n      } else {\r\n        console.error(`Failed to upsert venue ${venue.itemLabel.value}:`, error);\r\n      }\r\n\r\n      // Rate limiting: 100ms between requests\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n    }\r\n\r\n    // Update job as completed\r\n    await db\r\n      .from(\"sync_jobs\")\r\n      .update({\r\n        status: \"completed\",\r\n        results_count: totalCount,\r\n        completed_at: new Date().toISOString(),\r\n      })\r\n      .eq(\"id\", jobId);\r\n\r\n    return { count: totalCount, newCount };\r\n  } catch (error: any) {\r\n    console.error(\"Wikidata sync error:\", error);\r\n    \r\n    // Update job as failed\r\n    if (jobId) {\r\n      await db\r\n        .from(\"sync_jobs\")\r\n        .update({\r\n          status: \"failed\",\r\n          error_message: error.message,\r\n          completed_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", jobId);\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const force = searchParams.get(\"force\") === \"true\";\r\n\r\n    const result = await syncWikidataVenues(force);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      source: \"wikidata\",\r\n      type: \"location\",\r\n      count: result.count,\r\n      newCount: result.newCount,\r\n      message: `Synced ${result.count} historic venues from Wikidata (${result.newCount} new)`,\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Wikidata sync error:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"Wikidata sync failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\traditions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\vendors\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4410,4413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4410,4413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":194,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5294,5297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5294,5297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const runtime = \"nodejs\";\r\n\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { getServiceClient } from \"@/lib/supabaseServer\";\r\n\r\n/**\r\n * Vendor explorer API\r\n * GET /api/vendors?type=location&region=Sicilia&city=Palermo&minRating=4.0&verified=true\r\n * \r\n * Public endpoint for searching and filtering wedding vendors\r\n */\r\n\r\ninterface VendorFilters {\r\n  type?: string;\r\n  region?: string;\r\n  province?: string;\r\n  city?: string;\r\n  minRating?: number;\r\n  verified?: boolean;\r\n  priceRange?: string;\r\n  source?: string;\r\n  limit?: number;\r\n  offset?: number;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    \r\n    const filters: VendorFilters = {\r\n      type: searchParams.get(\"type\") || undefined,\r\n      region: searchParams.get(\"region\") || undefined,\r\n      province: searchParams.get(\"province\") || undefined,\r\n      city: searchParams.get(\"city\") || undefined,\r\n      minRating: searchParams.get(\"minRating\") \r\n        ? parseFloat(searchParams.get(\"minRating\")!) \r\n        : undefined,\r\n      verified: searchParams.get(\"verified\") === \"true\" ? true : undefined,\r\n      priceRange: searchParams.get(\"priceRange\") || undefined,\r\n      source: searchParams.get(\"source\") || undefined,\r\n      limit: searchParams.get(\"limit\") \r\n        ? parseInt(searchParams.get(\"limit\")!) \r\n        : 50,\r\n      offset: searchParams.get(\"offset\") \r\n        ? parseInt(searchParams.get(\"offset\")!) \r\n        : 0,\r\n    };\r\n\r\n    const db = getServiceClient();\r\n    \r\n    // Build query\r\n    let query = db\r\n      .from(\"vendors_with_places\")\r\n      .select(\"*\", { count: \"exact\" });\r\n\r\n    // Apply filters\r\n    if (filters.type) {\r\n      query = query.eq(\"type\", filters.type);\r\n    }\r\n    \r\n    if (filters.region) {\r\n      query = query.eq(\"region\", filters.region);\r\n    }\r\n    \r\n    if (filters.province) {\r\n      query = query.eq(\"province\", filters.province);\r\n    }\r\n    \r\n    if (filters.city) {\r\n      query = query.ilike(\"city\", `%${filters.city}%`);\r\n    }\r\n    \r\n    if (filters.minRating) {\r\n      query = query.gte(\"rating\", filters.minRating);\r\n    }\r\n    \r\n    if (filters.verified !== undefined) {\r\n      query = query.eq(\"verified\", filters.verified);\r\n    }\r\n    \r\n    if (filters.priceRange) {\r\n      query = query.eq(\"price_range\", filters.priceRange);\r\n    }\r\n    \r\n    if (filters.source) {\r\n      query = query.eq(\"source\", filters.source);\r\n    }\r\n\r\n    // Order by rating desc (verified first)\r\n    query = query\r\n      .order(\"verified\", { ascending: false })\r\n      .order(\"rating\", { ascending: false, nullsFirst: false })\r\n      .order(\"rating_count\", { ascending: false })\r\n      .range(filters.offset!, filters.offset! + filters.limit! - 1);\r\n\r\n    const { data, error, count } = await query;\r\n\r\n    if (error) {\r\n      console.error(\"Query error:\", error);\r\n      return NextResponse.json(\r\n        { error: \"Failed to fetch vendors\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Format response\r\n    const vendors = data?.map((vendor) => ({\r\n      id: vendor.id,\r\n      name: vendor.name,\r\n      type: vendor.type,\r\n      rating: vendor.rating,\r\n      ratingCount: vendor.rating_count,\r\n      priceRange: vendor.price_range,\r\n      verified: vendor.verified,\r\n      description: vendor.description,\r\n      contact: {\r\n        phone: vendor.phone,\r\n        email: vendor.email,\r\n        website: vendor.website,\r\n      },\r\n      location: vendor.lat && vendor.lng ? {\r\n        lat: vendor.lat,\r\n        lng: vendor.lng,\r\n        address: vendor.address,\r\n        city: vendor.city,\r\n        province: vendor.province,\r\n        region: vendor.region,\r\n        postalCode: vendor.postal_code,\r\n      } : null,\r\n      source: {\r\n        type: vendor.source,\r\n        id: vendor.source_id,\r\n        googlePlaceId: vendor.google_place_id,\r\n        osmId: vendor.osm_id,\r\n        wikidataQid: vendor.wikidata_qid,\r\n      },\r\n      metadata: vendor.metadata,\r\n      updatedAt: vendor.updated_at,\r\n      lastSyncedAt: vendor.last_synced_at,\r\n    }));\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: vendors,\r\n      pagination: {\r\n        total: count || 0,\r\n        limit: filters.limit,\r\n        offset: filters.offset,\r\n        hasMore: (filters.offset! + filters.limit!) < (count || 0),\r\n      },\r\n      filters: {\r\n        ...filters,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Vendor fetch error:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"Failed to fetch vendors\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Get vendor statistics\r\n * GET /api/vendors/stats?type=location\r\n */\r\nexport async function OPTIONS(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const type = searchParams.get(\"type\");\r\n\r\n    const db = getServiceClient();\r\n    \r\n    let query = db.from(\"top_vendors_by_region\").select(\"*\");\r\n    \r\n    if (type) {\r\n      query = query.eq(\"type\", type);\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      return NextResponse.json(\r\n        { error: \"Failed to fetch stats\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      stats: data,\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Stats fetch error:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"Failed to fetch stats\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\wedding-card\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1588,1591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1588,1591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2913,2916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2913,2916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nexport const runtime = \"nodejs\";\r\nimport { getServiceClient } from '@/lib/supabaseServer';\r\n\r\nexport async function GET() {\r\n  try {\r\n    const supabase = getServiceClient();\r\n    \r\n    // Get current user's event with wedding date\r\n    const { data: eventData } = await supabase\r\n      .from('events')\r\n      .select('id, wedding_date, bride_email, groom_email')\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (!eventData) {\r\n      return NextResponse.json({ config: null });\r\n    }\r\n\r\n    // Get wedding card configuration\r\n    const { data: config, error } = await supabase\r\n      .from('wedding_cards')\r\n      .select('*')\r\n      .eq('event_id', eventData.id)\r\n      .single();\r\n\r\n    if (error && error.code !== 'PGRST116') {\r\n      console.error('Error fetching wedding card:', error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    // Se esiste la configurazione, usala; altrimenti crea una configurazione base con la data dell'evento\r\n    const finalConfig = config || {\r\n      bride_name: '',\r\n      groom_name: '',\r\n      wedding_date: eventData.wedding_date || '',\r\n      church_name: '',\r\n      church_address: '',\r\n      location_name: '',\r\n      location_address: '',\r\n      iban: '',\r\n      bank_name: '',\r\n      ceremony_time: '',\r\n      reception_time: '',\r\n      font_family: 'Playfair Display',\r\n      color_scheme: 'classic',\r\n      template_style: 'elegant',\r\n      custom_message: ''\r\n    };\r\n\r\n    return NextResponse.json({ config: finalConfig });\r\n  } catch (err: any) {\r\n    console.error('Unexpected error:', err);\r\n    return NextResponse.json({ error: err.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const supabase = getServiceClient();\r\n    const body = await request.json();\r\n\r\n    // Get current user's event\r\n    const { data: eventData } = await supabase\r\n      .from('events')\r\n      .select('id')\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (!eventData) {\r\n      return NextResponse.json({ error: 'No event found' }, { status: 404 });\r\n    }\r\n\r\n      // Se la data matrimonio Ã¨ presente nel body, aggiorna anche l'evento\r\n      if (body.wedding_date) {\r\n        await supabase\r\n          .from('events')\r\n          .update({ wedding_date: body.wedding_date })\r\n          .eq('id', eventData.id);\r\n      }\r\n\r\n    // Upsert wedding card configuration\r\n    const { data, error } = await supabase\r\n      .from('wedding_cards')\r\n      .upsert({\r\n        event_id: eventData.id,\r\n        ...body\r\n      }, {\r\n        onConflict: 'event_id'\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('Error saving wedding card:', error);\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data });\r\n  } catch (err: any) {\r\n    console.error('Unexpected error:', err);\r\n    return NextResponse.json({ error: err.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\api\\wedding-planner\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\atelier\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\auth\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\beauty\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [region, province, load]","fix":{"range":[1633,1651],"text":"[region, province, load]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\budget\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\budget\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\catering\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [region, province, load]","fix":{"range":[1623,1641],"text":"[region, province, load]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cerimonia\\chiesa\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\chat-ia\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1832,1835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1832,1835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React from \"react\";\nimport AISuggestionsChat from \"@/components/AISuggestionsChat\";\nimport { getBrowserClient } from \"@/lib/supabaseBrowser\";\n\nconst supabase = getBrowserClient();\n\nexport default function ChatIAPage() {\n  const [userLang, setUserLang] = React.useState(\"it\");\n  const [userCountry, setUserCountry] = React.useState(\"it\");\n  const [userEventType, setUserEventType] = React.useState(\"wedding\");\n  const [showBudget, setShowBudget] = React.useState(false);\n  const [budget, setBudget] = React.useState<string>(\"\");\n  const [saving, setSaving] = React.useState(false);\n  const [message, setMessage] = React.useState<string>(\"\");\n\n  React.useEffect(() => {\n    try {\n      setUserLang(localStorage.getItem(\"language\") || \"it\");\n      setUserCountry(localStorage.getItem(\"country\") || \"it\");\n      setUserEventType(localStorage.getItem(\"eventType\") || \"wedding\");\n    } catch {}\n  }, []);\n\n  async function saveBudget() {\n    setSaving(true);\n    setMessage(\"\");\n    try {\n      const n = Number(budget.replace(/[^0-9.,]/g, '').replace(',', '.'));\n      if (!isFinite(n) || n < 0) {\n        setMessage(\"Inserisci un importo valido\");\n        setSaving(false);\n        return;\n      }\n      const { data: sessionData } = await supabase.auth.getSession();\n      const jwt = sessionData.session?.access_token;\n      const res = await fetch(\"/api/event/update-budget\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", ...(jwt ? { Authorization: `Bearer ${jwt}` } : {}) },\n        body: JSON.stringify({ total_budget: n })\n      });\n      if (!res.ok) {\n        const err = await res.json().catch(() => ({}));\n        throw new Error(err.error || `Errore salvataggio (${res.status})`);\n      }\n      setMessage(\"Budget salvato\");\n      setShowBudget(false);\n    } catch (e: any) {\n      setMessage(e.message || \"Errore imprevisto\");\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  return (\n    <section className=\"pt-6\">\n      <h1 className=\"font-serif text-3xl mb-4\">Chat con Assistente IA</h1>\n      <AISuggestionsChat userLang={userLang} userCountry={userCountry} userEventType={userEventType} />\n      <div className=\"max-w-xl mx-auto\">\n        <button className=\"mt-2 px-4 py-2 rounded-lg text-white\" style={{ background: \"var(--color-sage)\" }} onClick={() => setShowBudget(true)}>\n          Inserisci budget\n        </button>\n        {message && <div className=\"mt-3 text-sm text-gray-700\">{message}</div>}\n      </div>\n\n      {showBudget && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40\">\n          <div className=\"w-[90%] max-w-md bg-white rounded-2xl p-6 shadow-2xl\">\n            <h2 className=\"text-xl font-semibold mb-3\">Imposta budget totale</h2>\n            <input\n              type=\"text\"\n              className=\"w-full border rounded px-3 py-2 mb-4\"\n              placeholder=\"Es. 25000\"\n              value={budget}\n              onChange={(e) => setBudget(e.target.value)}\n            />\n            <div className=\"flex gap-2 justify-end\">\n              <button className=\"px-4 py-2 rounded border\" onClick={() => setShowBudget(false)} disabled={saving}>Annulla</button>\n              <button className=\"px-4 py-2 rounded text-white\" style={{ background: \"var(--color-sage)\" }} onClick={saveBudget} disabled={saving}>\n                {saving ? \"Salvo...\" : \"Salva\"}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </section>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\chat\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\chi-siamo\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\chiese\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadChurches'. Either include it or remove the dependency array.","line":83,"column":6,"nodeType":"ArrayExpression","endLine":83,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [loadChurches, selectedFilters, selectedType]","fix":{"range":[2154,2185],"text":"[loadChurches, selectedFilters, selectedType]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\come-funziona\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\coming-soon\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[198,201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[198,201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[278,281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[278,281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[318,321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[318,321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":61,"column":11,"nodeType":"JSXOpeningElement","endLine":61,"endColumn":119}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React from \"react\";\n\nfunction getLang(): \"it\"|\"es\"|\"en\"|\"fr\"|\"de\"|\"ru\"|\"zh\" {\n  if (typeof window === \"undefined\") return \"en\";\n  const ls = localStorage.getItem(\"language\") as any;\n  const cookie = document.cookie.match(/(?:^|; )language=([^;]+)/)?.[1] as any;\n  return (ls || cookie || \"en\") as any;\n}\n\nfunction tComingSoon(lang: string) {\n  switch (lang) {\n    case \"it\": return \"In arrivo\";\n    case \"es\": return \"PrÃ³ximamente\";\n    case \"fr\": return \"BientÃ´t disponible\";\n    case \"de\": return \"DemnÃ¤chst verfÃ¼gbar\";\n    case \"ru\": return \"Ð¡ÐºÐ¾ÑÐ¾\";\n    case \"zh\": return \"å³å°æ¨åº\";\n    default: return \"Coming Soon\";\n  }\n}\n\nconst LABELS: Record<string, {it:string; es:string; en:string}> = {\n  wedding: { it: \"Matrimonio\", es: \"Boda\", en: \"Wedding\" },\n  baptism: { it: \"Battesimo\", es: \"Bautizo\", en: \"Baptism\" },\n  \"turning-18\": { it: \"Diciottesimo\", es: \"18Âº CumpleaÃ±os\", en: \"18th Birthday\" },\n  \"anniversary-50\": { it: \"50Âº Anniversario\", es: \"50Âº Aniversario\", en: \"50th Anniversary\" },\n  \"turning-50\": { it: \"50 Anni\", es: \"50 AÃ±os\", en: \"50 Years\" },\n  retirement: { it: \"Pensione\", es: \"JubilaciÃ³n\", en: \"Retirement\" },\n  confirmation: { it: \"Cresima\", es: \"ConfirmaciÃ³n\", en: \"Confirmation\" },\n  graduation: { it: \"Laurea\", es: \"GraduaciÃ³n\", en: \"Graduation\" },\n};\n\nexport default function ComingSoonPage() {\n  const lang = getLang();\n  let eventType: string | null = null;\n  if (typeof window !== \"undefined\") {\n    const cookieEvt = document.cookie.match(/(?:^|; )eventType=([^;]+)/)?.[1];\n    const lsEvt = localStorage.getItem(\"eventType\");\n    eventType = cookieEvt || lsEvt || null;\n  }\n  const eventLabel = eventType ? (LABELS[eventType]?.[lang as \"it\"|\"es\"|\"en\"] || eventType) : \"\";\n\n  return (\n    <main className=\"min-h-screen flex items-center justify-center\" style={{\n      background:\n        \"radial-gradient(1000px 500px at 0% 100%, rgba(163,181,157,0.2), transparent),\" +\n        \"radial-gradient(800px 500px at 100% 0%, rgba(232,240,233,0.6), transparent),\" +\n        \"linear-gradient(180deg, #f8fbf8, #eef5ef)\",\n    }}>\n      <div className=\"max-w-xl w-full mx-4 p-10 rounded-3xl bg-white/85 backdrop-blur border border-gray-200 shadow-xl text-center\">\n        <h1 className=\"text-3xl font-serif font-bold mb-3\">{tComingSoon(lang)}</h1>\n        {eventLabel ? (\n          <p className=\"text-lg text-gray-700 mb-6\">{eventLabel}</p>\n        ) : null}\n        <p className=\"text-gray-600 mb-8\">\n          Questa sezione non Ã¨ ancora pronta per questo tipo di evento.\n          Nel frattempo puoi esplorare la nostra demo o creare un evento Matrimonio per usare tutte le funzionalitÃ .\n        </p>\n        <div className=\"flex gap-3 justify-center\">\n          <a href=\"/\" className=\"px-5 py-3 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 font-semibold\">Vai alla Home</a>\n          <button\n            onClick={() => {\n              localStorage.setItem(\"eventType\", \"wedding\");\n              document.cookie = `eventType=wedding; Path=/; Max-Age=15552000; SameSite=Lax`;\n              window.location.href = \"/dashboard\";\n            }}\n            className=\"px-5 py-3 rounded-lg text-white font-semibold\"\n            style={{ background: \"var(--color-sage)\" }}\n          >\n            Passa a Matrimonio\n          </button>\n        </div>\n      </div>\n    </main>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\contabilita\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\contatti\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cookie-policy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cose-matrimonio\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cresima\\budget\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1586,1589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1586,1589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1684,1687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1684,1687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2616,2619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2616,2619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":111,"column":60,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4100,4184],"text":"\n          Riepilogo delle spese approvate e confronto con l&apos;idea iniziale.\n        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4100,4184],"text":"\n          Riepilogo delle spese approvate e confronto con l&lsquo;idea iniziale.\n        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4100,4184],"text":"\n          Riepilogo delle spese approvate e confronto con l&#39;idea iniziale.\n        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4100,4184],"text":"\n          Riepilogo delle spese approvate e confronto con l&rsquo;idea iniziale.\n        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":139,"column":55,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5352,5453],"text":"\n            Nessuna spesa approvata. Vai alla sezione &quot;Spese\" per approvare le tue spese.\n          "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5352,5453],"text":"\n            Nessuna spesa approvata. Vai alla sezione &ldquo;Spese\" per approvare le tue spese.\n          "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5352,5453],"text":"\n            Nessuna spesa approvata. Vai alla sezione &#34;Spese\" per approvare le tue spese.\n          "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5352,5453],"text":"\n            Nessuna spesa approvata. Vai alla sezione &rdquo;Spese\" per approvare le tue spese.\n          "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":139,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5352,5453],"text":"\n            Nessuna spesa approvata. Vai alla sezione \"Spese&quot; per approvare le tue spese.\n          "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5352,5453],"text":"\n            Nessuna spesa approvata. Vai alla sezione \"Spese&ldquo; per approvare le tue spese.\n          "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5352,5453],"text":"\n            Nessuna spesa approvata. Vai alla sezione \"Spese&#34; per approvare le tue spese.\n          "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5352,5453],"text":"\n            Nessuna spesa approvata. Vai alla sezione \"Spese&rdquo; per approvare le tue spese.\n          "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":194,"column":93,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa &quot;Idea di Budget\" per pianificare e approva spese nella sezione \"Spese\"."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa &ldquo;Idea di Budget\" per pianificare e approva spese nella sezione \"Spese\"."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa &#34;Idea di Budget\" per pianificare e approva spese nella sezione \"Spese\"."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa &rdquo;Idea di Budget\" per pianificare e approva spese nella sezione \"Spese\"."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":194,"column":108,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget&quot; per pianificare e approva spese nella sezione \"Spese\"."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget&ldquo; per pianificare e approva spese nella sezione \"Spese\"."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget&#34; per pianificare e approva spese nella sezione \"Spese\"."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget&rdquo; per pianificare e approva spese nella sezione \"Spese\"."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":194,"column":156,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione &quot;Spese\"."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione &ldquo;Spese\"."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione &#34;Spese\"."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione &rdquo;Spese\"."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":194,"column":162,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione \"Spese&quot;."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione \"Spese&ldquo;."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione \"Spese&#34;."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8022,8125],"text":"Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione \"Spese&rdquo;."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport CresimaNav from \"@/components/cresima/CresimaNav\";\nimport { getUserLanguage, formatCurrency } from \"@/lib/locale\";\n\ntype Row = {\n  category: string;\n  subcategory: string;\n  budget: number;\n  committed: number;\n  paid: number;\n  residual: number;\n  fromDashboard: boolean;\n  difference: number;\n};\n\ntype Totals = { total: number };\n\nexport default function CresimaBudgetPage() {\n  const [rows, setRows] = useState<Row[]>([]);\n  const [totals, setTotals] = useState<Totals>({ total: 0 });\n  const [plannedItems, setPlannedItems] = useState<{ name: string; amount: number }[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const headers: HeadersInit = {};\n        try {\n          const { getBrowserClient } = await import(\"@/lib/supabaseBrowser\");\n          const supabase = getBrowserClient();\n          const { data } = await supabase.auth.getSession();\n          const jwt = data.session?.access_token;\n          if (jwt) headers.Authorization = `Bearer ${jwt}`;\n        } catch {}\n\n        const country = (typeof window !== \"undefined\" ? localStorage.getItem(\"country\") : \"it\") || \"it\";\n\n        const [expensesRes, plannedRes] = await Promise.all([\n          fetch(\"/api/my/expenses\", { headers }),\n          fetch(`/api/budget-items?country=${encodeURIComponent(country)}`, { headers }),\n        ]);\n\n        const expensesData = await expensesRes.json();\n        const approvedExpenses = (expensesData.expenses || []).filter((exp: any) => exp.status === \"approved\");\n\n        const budgetRows: Row[] = approvedExpenses.map((exp: any) => ({\n          category: exp.category || \"\",\n          subcategory: exp.subcategory || \"\",\n          budget: Number(exp.amount || 0),\n          committed: Number(exp.amount || 0),\n          paid: 0,\n          residual: Number(exp.amount || 0),\n          fromDashboard: exp.from_dashboard || false,\n          difference: 0,\n        }));\n\n        const userLang = getUserLanguage();\n        budgetRows.sort((a, b) => {\n          const catCompare = a.category.localeCompare(b.category, userLang);\n          if (catCompare !== 0) return catCompare;\n          return a.subcategory.localeCompare(b.subcategory, userLang);\n        });\n        setRows(budgetRows);\n\n        const total = budgetRows.reduce((sum, r) => sum + (Number(r.budget) || 0), 0);\n        setTotals({ total });\n\n        const plannedJson = await plannedRes.json();\n        const planned = Array.isArray(plannedJson?.items)\n          ? plannedJson.items.map((it: any) => ({\n              name: it.name || [it.category, it.subcategory].filter(Boolean).join(\" - \") || \"Voce\",\n              amount: Number(it.amount || 0) || 0,\n            }))\n          : [];\n        setPlannedItems(planned);\n      } catch {\n        setRows([]);\n        setTotals({ total: 0 });\n        setPlannedItems([]);\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, []);\n\n  const plannedTotal = useMemo(() => plannedItems.reduce((s, it) => s + (Number(it.amount)||0), 0), [plannedItems]);\n  const compareRows = useMemo(() => {\n    const planMap = new Map<string, number>();\n    for (const p of plannedItems) {\n      const key = p.name || \"Voce\";\n      planMap.set(key, (planMap.get(key) || 0) + (Number(p.amount) || 0));\n    }\n    const actualMap = new Map<string, number>();\n    for (const r of rows) {\n      const key = [r.category, r.subcategory].filter(Boolean).join(\" - \") || \"Voce\";\n      actualMap.set(key, (actualMap.get(key) || 0) + (Number(r.budget) || 0));\n    }\n    const userLang = getUserLanguage();\n    const keys = Array.from(new Set([...planMap.keys(), ...actualMap.keys()])).sort((a,b)=>a.localeCompare(b,userLang));\n    return keys.map((k) => ({ key: k, planned: planMap.get(k) || 0, actual: actualMap.get(k) || 0 }));\n  }, [plannedItems, rows]);\n\n  return (\n    <main>\n      <CresimaNav />\n\n      <section className=\"mb-6\">\n        <h2 className=\"text-xl font-semibold\">Budget Cresima</h2>\n        <p className=\"text-neutral-600 mt-1\">\n          Riepilogo delle spese approvate e confronto con l'idea iniziale.\n        </p>\n      </section>\n\n      <div className=\"mb-6 bg-white/80 rounded-2xl border border-gray-200 shadow-sm\">\n        <div className=\"px-6 py-4 flex items-center justify-between flex-wrap gap-4\">\n          <div>\n            <h3 className=\"text-lg font-semibold\">Totale effettivo</h3>\n            <div className=\"text-xl\">{formatEuro(totals.total)}</div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"overflow-hidden rounded-2xl border border-gray-200 bg-white/70 shadow-sm\">\n        <div className=\"grid grid-cols-8 gap-0 px-6 py-3 text-sm text-gray-700\">\n          <div>Categoria</div>\n          <div>Sottocategoria</div>\n          <div className=\"text-right\">Budget</div>\n          <div className=\"text-right\">Impegnato</div>\n          <div className=\"text-right\">Pagato</div>\n          <div className=\"text-right\">Residuo</div>\n          <div className=\"text-center\">Da preventivo</div>\n          <div className=\"text-right\">Differenza</div>\n        </div>\n        {loading ? (\n          <div className=\"p-6 text-gray-500 text-sm\">Caricamento...</div>\n        ) : rows.length === 0 ? (\n          <div className=\"p-10 text-center text-gray-500\">\n            Nessuna spesa approvata. Vai alla sezione \"Spese\" per approvare le tue spese.\n          </div>\n        ) : (\n          <ul>\n            {rows.map((r, idx) => (\n              <li\n                key={idx}\n                className=\"grid grid-cols-8 gap-0 px-6 py-3 text-sm border-t border-gray-50 hover:bg-gray-50/60\"\n              >\n                <div>{r.category}</div>\n                <div>{r.subcategory}</div>\n                <div className=\"text-right\">{formatEuro(r.budget)}</div>\n                <div className=\"text-right\">{formatEuro(r.committed)}</div>\n                <div className=\"text-right\">{formatEuro(r.paid)}</div>\n                <div className=\"text-right\">{formatEuro(r.residual)}</div>\n                <div className=\"text-center\">\n                  {r.fromDashboard ? (\n                    <span className=\"text-green-600 font-bold\">V</span>\n                  ) : (\n                    <span className=\"text-gray-300\">-</span>\n                  )}\n                </div>\n                <div className={`text-right font-medium ${\n                  r.difference > 0 ? \"text-red-600\" :\n                  r.difference < 0 ? \"text-green-600\" :\n                  \"text-gray-600\"\n                }`}>\n                  {r.difference > 0 ? \"+\" : \"\"}{formatEuro(Math.abs(r.difference))}\n                </div>\n              </li>\n            ))}\n          </ul>\n        )}\n      </div>\n\n      <div className=\"mt-8 bg-white/80 rounded-2xl border border-gray-200 shadow-sm\">\n        <div className=\"px-6 py-4 flex items-center justify-between flex-wrap gap-4\">\n          <h3 className=\"text-lg font-semibold\">Pianificato vs Effettivo</h3>\n          <div className=\"text-sm text-right\">\n            <div>Totale pianificato: {formatEuro(plannedTotal)}</div>\n            <div>Totale effettivo (approvato): {formatEuro(totals.total)}</div>\n            <div className={`${plannedTotal - totals.total > 0 ? 'text-red-600' : 'text-emerald-700'} font-medium`}>\n              Differenza: {formatEuro(Math.abs(plannedTotal - totals.total))} {plannedTotal - totals.total > 0 ? '(+ oltre il previsto)' : '(sotto il previsto)'}\n            </div>\n          </div>\n        </div>\n        <div className=\"h-px bg-gray-100\" />\n        <div className=\"px-6 py-3 grid grid-cols-12 text-sm text-gray-700\">\n          <div className=\"col-span-6\">Voce</div>\n          <div className=\"col-span-3 text-right\">Pianificato</div>\n          <div className=\"col-span-3 text-right\">Effettivo</div>\n        </div>\n        <div className=\"h-px bg-gray-100\" />\n        <ul>\n          {compareRows.length === 0 ? (\n            <li className=\"px-6 py-6 text-sm text-gray-500\">Nessun dato da confrontare. Usa \"Idea di Budget\" per pianificare e approva spese nella sezione \"Spese\".</li>\n          ) : (\n            compareRows.map((row) => (\n              <li key={row.key} className=\"grid grid-cols-12 px-6 py-3 text-sm border-t border-gray-50\">\n                <div className=\"col-span-6 truncate\" title={row.key}>{row.key}</div>\n                <div className=\"col-span-3 text-right\">{formatEuro(row.planned)}</div>\n                <div className={`col-span-3 text-right ${row.actual > row.planned ? 'text-red-600' : 'text-gray-800'}`}>{formatEuro(row.actual)}</div>\n              </li>\n            ))\n          )}\n        </ul>\n      </div>\n    </main>\n  );\n}\n\nfunction formatEuro(n: number) {\n  return formatCurrency(n, \"EUR\", { minimumFractionDigits: 0, maximumFractionDigits: 0 });\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cresima\\idea-di-budget\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cresima\\invitati\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cresima\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cresima\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\cresima\\timeline\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\documenti\\appuntamenti\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\documenti\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":211,"column":70,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8827,8828],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8827,8828],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8827,8828],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8827,8828],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":211,"column":82,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8839,8840],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8839,8840],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8839,8840],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8839,8840],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport PageInfoNote from \"@/components/PageInfoNote\";\r\nimport { formatDate } from \"@/lib/locale\";\r\n\r\ntype Document = {\r\n  id: string;\r\n  name: string;\r\n  category: string;\r\n  supplier: string;\r\n  fileUrl: string;\r\n  fileSize: number;\r\n  uploadedAt: string;\r\n  notes?: string;\r\n};\r\n\r\nconst DOCUMENT_CATEGORIES = [\r\n  \"Preventivo\",\r\n  \"Contratto\",\r\n  \"Fattura\",\r\n  \"Ricevuta\",\r\n  \"Documento generico\",\r\n  \"Certificato\",\r\n  \"Licenza\",\r\n];\r\n\r\nexport default function DocumentiPage() {\r\n  const [documents, setDocuments] = useState<Document[]>([]);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [filter, setFilter] = useState<string>(\"Tutti\");\r\n\r\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    setUploading(true);\r\n    \r\n    // Simulazione upload (in produzione: Supabase Storage)\r\n    setTimeout(() => {\r\n      const newDocs: Document[] = Array.from(files).map((file, idx) => ({\r\n        id: `doc-${Date.now()}-${idx}`,\r\n        name: file.name,\r\n        category: \"Documento generico\",\r\n        supplier: \"Da assegnare\",\r\n        fileUrl: URL.createObjectURL(file),\r\n        fileSize: file.size,\r\n        uploadedAt: new Date().toISOString(),\r\n      }));\r\n      \r\n      setDocuments([...newDocs, ...documents]);\r\n      setUploading(false);\r\n    }, 1500);\r\n  };\r\n\r\n  const deleteDocument = (id: string) => {\r\n    setDocuments(documents.filter(d => d.id !== id));\r\n  };\r\n\r\n  const categories = [\"Tutti\", ...DOCUMENT_CATEGORIES];\r\n  const filteredDocs = filter === \"Tutti\" \r\n    ? documents \r\n    : documents.filter(d => d.category === filter);\r\n\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes < 1024) return bytes + \" B\";\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + \" KB\";\r\n    return (bytes / (1024 * 1024)).toFixed(1) + \" MB\";\r\n  };\r\n\r\n  return (\r\n    <section className=\"space-y-6\">\r\n      <div className=\"bg-gradient-to-br from-[#FDFBF7] to-[#F5F1EB] rounded-2xl p-6 border border-gray-200\">\r\n        <h1 className=\"font-serif text-3xl font-bold text-gray-800 mb-2\">\r\n          ð Documenti & Preventivi\r\n        </h1>\r\n        <p className=\"text-gray-600\">\r\n          Carica e organizza tutti i documenti del matrimonio: preventivi, contratti, ricevute e altro.\r\n        </p>\r\n      </div>\r\n\r\n      <PageInfoNote\r\n        icon=\"ð\"\r\n        title=\"Archivio Digitale dei Tuoi Documenti\"\r\n        description=\"Centralizza tutti i documenti importanti in un unico posto sicuro. Carica preventivi ricevuti dai fornitori, contratti firmati, fatture, ricevute di pagamento e certificati. Ogni documento puÃ² essere categorizzato, associato a un fornitore e dotato di note.\"\r\n        tips={[\r\n          \"Carica i preventivi appena li ricevi per confrontarli facilmente\",\r\n          \"Associa ogni documento al fornitore corrispondente per una migliore organizzazione\",\r\n          \"Usa la categoria 'Contratto' per i documenti giÃ  firmati e confermati\",\r\n          \"Le ricevute e le fatture ti servono per la contabilitÃ  finale e le dichiarazioni fiscali\",\r\n          \"Filtra per categoria per trovare rapidamente ciÃ² che cerchi\",\r\n          \"Formati supportati: PDF, DOC, DOCX, JPG, PNG (fino a 10MB per file)\"\r\n        ]}\r\n        eventTypeSpecific={{\r\n          wedding: \"Per il matrimonio, organizza documenti per: location, catering, fotografi, fioristi, abiti, musica, chiese. Tieni tutto sotto controllo in un archivio digitale!\",\r\n          baptism: \"Per il battesimo, carica: certificato di battesimo, preventivi della location per il rinfresco, contratti del fotografo, fatture del catering.\",\r\n          birthday: \"Per il compleanno, conserva: contratto della location, preventivi del catering/ristorante, accordi con DJ/intrattenimento, fatture delle decorazioni.\",\r\n          graduation: \"Per la laurea, archivia: prenotazione ristorante/location, preventivi del catering per il buffet, contratto fotografo, fatture per stampa inviti e gadget.\"\r\n        }}\r\n      />\r\n\r\n      {/* Upload Area */}\r\n      <div className=\"bg-white rounded-xl p-6 border-2 border-dashed border-gray-300 hover:border-gray-400 transition-colors\">\r\n        <label className=\"block cursor-pointer\">\r\n          <input\r\n            type=\"file\"\r\n            multiple\r\n            accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\r\n            onChange={handleUpload}\r\n            className=\"hidden\"\r\n            disabled={uploading}\r\n          />\r\n          <div className=\"text-center\">\r\n            <div className=\"text-5xl mb-3\">ð</div>\r\n            <h3 className=\"font-bold text-lg text-gray-800 mb-2\">\r\n              {uploading ? \"Caricamento in corso...\" : \"Carica Documenti\"}\r\n            </h3>\r\n            <p className=\"text-sm text-gray-600 mb-4\">\r\n              Clicca per selezionare o trascina qui i file\r\n            </p>\r\n            <p className=\"text-xs text-gray-400\">\r\n              PDF, Word, Immagini â¢ Max 10 MB per file\r\n            </p>\r\n          </div>\r\n        </label>\r\n      </div>\r\n\r\n      {/* Filtri */}\r\n      <div className=\"flex gap-2 overflow-x-auto pb-2\">\r\n        {categories.map(cat => (\r\n          <button\r\n            key={cat}\r\n            onClick={() => setFilter(cat)}\r\n            className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${\r\n              filter === cat\r\n                ? \"text-white shadow-md\"\r\n                : \"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50\"\r\n            }`}\r\n            style={filter === cat ? { background: \"var(--color-sage)\" } : {}}\r\n          >\r\n            {cat}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Lista Documenti */}\r\n      {filteredDocs.length === 0 ? (\r\n        <div className=\"p-12 text-center bg-white rounded-xl border border-gray-200\">\r\n          <div className=\"text-6xl mb-4\">ð­</div>\r\n          <h3 className=\"text-xl font-bold text-gray-700 mb-2\">\r\n            {documents.length === 0 ? \"Nessun documento caricato\" : \"Nessun documento in questa categoria\"}\r\n          </h3>\r\n          <p className=\"text-gray-500\">\r\n            {documents.length === 0 \r\n              ? \"Inizia a caricare i tuoi preventivi e contratti\"\r\n              : \"Prova a cambiare filtro per vedere altri documenti\"}\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-3\">\r\n          {filteredDocs.map(doc => (\r\n            <div\r\n              key={doc.id}\r\n              className=\"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-md transition-shadow\"\r\n            >\r\n              <div className=\"flex items-start gap-4\">\r\n                <div className=\"w-12 h-12 rounded-lg flex items-center justify-center text-2xl flex-shrink-0\" style={{ background: \"var(--color-beige)\" }}>\r\n                  ð\r\n                </div>\r\n                \r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <h3 className=\"font-bold text-gray-800 truncate\">{doc.name}</h3>\r\n                      <div className=\"flex items-center gap-3 mt-1\">\r\n                        <span className=\"text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700\">\r\n                          {doc.category}\r\n                        </span>\r\n                        <span className=\"text-xs text-gray-500\">\r\n                          {doc.supplier}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"flex items-center gap-2\">\r\n                      <a\r\n                        href={doc.fileUrl}\r\n                        download\r\n                        className=\"p-2 hover:bg-gray-100 rounded-lg transition\"\r\n                        title=\"Scarica\"\r\n                      >\r\n                        â¬ï¸\r\n                      </a>\r\n                      <button\r\n                        onClick={() => deleteDocument(doc.id)}\r\n                        className=\"p-2 hover:bg-red-50 rounded-lg transition text-red-500\"\r\n                        title=\"Elimina\"\r\n                      >\r\n                        ðï¸\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex items-center gap-4 text-xs text-gray-500\">\r\n                    <span>{formatFileSize(doc.fileSize)}</span>\r\n                    <span>â¢</span>\r\n                    <span>{formatDate(new Date(doc.uploadedAt))}</span>\r\n                  </div>\r\n                  \r\n                  {doc.notes && (\r\n                    <p className=\"text-sm text-gray-600 mt-2 italic\">\"{doc.notes}\"</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Stats */}\r\n      {documents.length > 0 && (\r\n        <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border border-gray-200\">\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4 text-center\">\r\n            <div>\r\n              <div className=\"text-2xl font-bold\" style={{ color: \"var(--color-sage)\" }}>\r\n                {documents.length}\r\n              </div>\r\n              <div className=\"text-sm text-gray-600\">Documenti totali</div>\r\n            </div>\r\n            <div>\r\n              <div className=\"text-2xl font-bold\" style={{ color: \"var(--color-sage)\" }}>\r\n                {documents.filter(d => d.category === \"Preventivo\").length}\r\n              </div>\r\n              <div className=\"text-sm text-gray-600\">Preventivi</div>\r\n            </div>\r\n            <div>\r\n              <div className=\"text-2xl font-bold\" style={{ color: \"var(--color-sage)\" }}>\r\n                {documents.filter(d => d.category === \"Contratto\").length}\r\n              </div>\r\n              <div className=\"text-sm text-gray-600\">Contratti</div>\r\n            </div>\r\n            <div>\r\n              <div className=\"text-2xl font-bold\" style={{ color: \"var(--color-sage)\" }}>\r\n                {(documents.reduce((sum, d) => sum + d.fileSize, 0) / (1024 * 1024)).toFixed(1)} MB\r\n              </div>\r\n              <div className=\"text-sm text-gray-600\">Spazio usato</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\e\\[publicId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":25,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1009,1012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1009,1012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\n\ntype PublicEvent = {\n  id: string;\n  public_id: string | null;\n  title: string | null;\n  is_public: boolean | null;\n  created_at: string | null;\n  type_id: number | null;\n};\n\nasync function getPublicEvent(publicId: string) {\n  const res = await fetch(`/api/public/${encodeURIComponent(publicId)}`, {\n    // ensure fresh data\n    cache: \"no-store\",\n    headers: { \"Content-Type\": \"application/json\" },\n  });\n\n  if (!res.ok) {\n    // Try to extract error\n    let msg = `Error ${res.status}`;\n    try {\n      const j = await res.json();\n      if (j?.error) msg = j.error as string;\n    } catch (_) {}\n    throw new Error(msg);\n  }\n\n  const data = (await res.json()) as { event: PublicEvent };\n  return data.event;\n}\n\nexport default async function PublicEventPage({ params }: { params: { publicId: string } }) {\n  const { publicId } = params;\n  let event: PublicEvent | null = null;\n  let error: string | null = null;\n\n  try {\n    event = await getPublicEvent(publicId);\n  } catch (e: any) {\n    error = e?.message || \"Impossibile caricare l'evento\";\n  }\n\n  if (error) {\n    return (\n      <main className=\"container mx-auto px-4 py-10\">\n        <h1 className=\"text-2xl font-semibold mb-2\">Evento pubblico</h1>\n        <p className=\"text-red-600\">{error}</p>\n      </main>\n    );\n  }\n\n  if (!event) {\n    return (\n      <main className=\"container mx-auto px-4 py-10\">\n        <h1 className=\"text-2xl font-semibold mb-2\">Evento pubblico</h1>\n        <p>Caricamento...</p>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"container mx-auto px-4 py-10\">\n      <h1 className=\"text-3xl font-bold mb-4\">{event.title || \"Evento\"}</h1>\n      <div className=\"space-y-1 text-sm text-gray-700\">\n        <div>\n          <span className=\"font-medium\">Public ID:</span> {event.public_id || \"â\"}\n        </div>\n        <div>\n          <span className=\"font-medium\">VisibilitÃ :</span> {event.is_public ? \"Pubblico\" : \"Privato\"}\n        </div>\n        {event.created_at ? (\n          <div>\n            <span className=\"font-medium\">Creato il:</span> {new Date(event.created_at).toLocaleString()}\n          </div>\n        ) : null}\n        {typeof event.type_id === \"number\" ? (\n          <div>\n            <span className=\"font-medium\">Tipo evento ID:</span> {event.type_id}\n          </div>\n        ) : null}\n      </div>\n    </main>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\e\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\entrate\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\esplora-fornitori\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\fiorai\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [region, province, load]","fix":{"range":[1619,1637],"text":"[region, province, load]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\formazione-tavoli\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\fornitori-dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\fornitori\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\fornitori\\page.backup.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSuppliers'. Either include it or remove the dependency array.","line":98,"column":6,"nodeType":"ArrayExpression","endLine":98,"endColumn":58,"suggestions":[{"desc":"Update the dependencies array to be: [selectedRegion, selectedProvince, selectedCategory, loadSuppliers]","fix":{"range":[3131,3183],"text":"[selectedRegion, selectedProvince, selectedCategory, loadSuppliers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\nimport { getBrowserClient } from \"@/lib/supabaseBrowser\";\nimport ImageCarousel from \"@/components/ImageCarousel\";\nimport { getUserCountrySafe } from \"@/constants/geo\";\nimport { getPageImages } from \"@/lib/pageImages\";\nimport { useToast } from \"@/components/ToastProvider\";\n\r\nconst supabase = getBrowserClient();\r\n\r\n// Icone per categorie\r\nconst CATEGORY_ICONS: Record<string, string> = {\r\n  \"Abiti & Accessori (altri)\": \"ð\",\r\n  \"Cerimonia/Chiesa Location\": \"âª\",\r\n  \"Fiori & Decor\": \"ð\",\r\n  \"Foto & Video\": \"ð¸\",\r\n  \"Inviti & Stationery\": \"ð\",\r\n  \"Sposa\": \"ð°\",\r\n  \"Sposo\": \"ð¤µ\",\r\n  \"Ricevimento Location\": \"ðï¸\",\r\n  \"Musica & Intrattenimento\": \"ðµ\",\r\n  \"Trasporti\": \"ð\",\r\n  \"Bomboniere & Regali\": \"ð\",\r\n  \"OspitalitÃ  & Logistica\": \"ð¨\",\r\n  \"Burocrazia\": \"ð\",\r\n  \"Beauty & Benessere\": \"ð\",\r\n  \"Viaggio di nozze\": \"âï¸\",\r\n  \"Comunicazione & Media\": \"ð±\",\r\n  \"Extra & Contingenze\": \"â¨\",\r\n};\r\n\r\ntype Supplier = {\r\n  id: string;\r\n  name: string;\r\n  category: string;\r\n  subcategory: string;\r\n  region: string;\r\n  province: string;\r\n  city: string;\r\n  address: string;\r\n  phone: string;\r\n  email: string;\r\n  website: string;\r\n  description: string;\r\n  priceRange: string;\r\n  rating: number;\r\n  source: string; // matrimonio.com, zankyou.it, etc.\r\n};\r\n\r\n// Regioni italiane\r\nconst REGIONS = [\r\n  \"Abruzzo\", \"Basilicata\", \"Calabria\", \"Campania\", \"Emilia-Romagna\",\r\n  \"Friuli-Venezia Giulia\", \"Lazio\", \"Liguria\", \"Lombardia\", \"Marche\",\r\n  \"Molise\", \"Piemonte\", \"Puglia\", \"Sardegna\", \"Sicilia\", \"Toscana\",\r\n  \"Trentino-Alto Adige\", \"Umbria\", \"Valle d'Aosta\", \"Veneto\"\r\n];\r\n\r\n// Stesse categorie della dashboard\r\nconst CATEGORIES = [\r\n  \"Abiti & Accessori (altri)\", \"Cerimonia/Chiesa Location\", \"Fiori & Decor\", \"Foto & Video\",\r\n  \"Inviti & Stationery\", \"Sposa\", \"Sposo\", \"Ricevimento Location\",\r\n  \"Musica & Intrattenimento\", \"Trasporti\", \"Bomboniere & Regali\",\r\n  \"OspitalitÃ  & Logistica\", \"Burocrazia\", \"Beauty & Benessere\",\r\n  \"Viaggio di nozze\", \"Comunicazione & Media\", \"Extra & Contingenze\"\r\n];\r\n\r\nexport default function FornitoriPage() {\n  const country = getUserCountrySafe();\n  const { showToast } = useToast();\n  const [suppliers, setSuppliers] = useState<Supplier[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedRegion, setSelectedRegion] = useState<string>(\"\");\r\n  const [selectedProvince, setSelectedProvince] = useState<string>(\"\");\r\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"\");\r\n  const [searchQuery, setSearchQuery] = useState<string>(\"\");\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n  const [viewMode, setViewMode] = useState<\"grid\" | \"list\">(\"grid\");\r\n  const [message, setMessage] = useState<string | null>(null);\r\n\r\n  const [newSupplier, setNewSupplier] = useState<Partial<Supplier>>({\r\n    name: \"\",\r\n    category: CATEGORIES[0],\r\n    subcategory: \"\",\r\n    region: REGIONS[0],\r\n    province: \"\",\r\n    city: \"\",\r\n    address: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    website: \"\",\r\n    description: \"\",\r\n    priceRange: \"â¬â¬\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadSuppliers();\r\n  }, [selectedRegion, selectedProvince, selectedCategory]);\r\n\r\n  const loadSuppliers = async () => {\r\n    try {\r\n      const { data } = await supabase.auth.getSession();\r\n      const jwt = data.session?.access_token;\r\n\r\n      const headers: HeadersInit = {};\r\n      if (jwt) {\r\n        headers.Authorization = `Bearer ${jwt}`;\r\n      }\r\n\r\n      const params = new URLSearchParams();\r\n      if (selectedRegion) params.append(\"region\", selectedRegion);\r\n      if (selectedProvince) params.append(\"province\", selectedProvince);\r\n      if (selectedCategory) params.append(\"category\", selectedCategory);\r\n      if (searchQuery) params.append(\"search\", searchQuery);\r\n\r\n      const r = await fetch(`/api/suppliers?${params.toString()}`, { headers });\r\n      const j = await r.json();\r\n\r\n      setSuppliers(j.suppliers || []);\r\n    } catch (err) {\r\n      console.error(\"Errore caricamento:\", err);\r\n      setSuppliers([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const submitNewSupplier = async () => {\r\n    try {\r\n      const { data } = await supabase.auth.getSession();\r\n      const jwt = data.session?.access_token;\r\n\r\n      if (!jwt) {\r\n        setMessage(\"â Devi essere autenticato per proporre un fornitore. Clicca su 'Registrati' in alto.\");\r\n        return;\r\n      }\r\n\r\n      const r = await fetch(\"/api/suppliers\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${jwt}`,\r\n        },\r\n        body: JSON.stringify(newSupplier),\r\n      });\r\n\r\n      if (r.ok) {\r\n        setMessage(\"â Fornitore proposto con successo! SarÃ  revisionato dal nostro team.\");\r\n        setShowAddForm(false);\r\n        setNewSupplier({\r\n          name: \"\",\r\n          category: CATEGORIES[0],\r\n          subcategory: \"\",\r\n          region: REGIONS[0],\r\n          province: \"\",\r\n          city: \"\",\r\n          address: \"\",\r\n          phone: \"\",\r\n          email: \"\",\r\n          website: \"\",\r\n          description: \"\",\r\n          priceRange: \"â¬â¬\",\r\n        });\r\n        setTimeout(() => setMessage(null), 5000);\r\n      } else {\r\n        const j = await r.json();\r\n        setMessage(`â Errore: ${j.error || \"Impossibile inviare\"}`);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Errore:\", err);\r\n      setMessage(\"â Errore di rete\");\r\n    }\r\n  };\r\n\r\n  const filteredSuppliers = suppliers.filter((s) => {\r\n    if (searchQuery && !s.name.toLowerCase().includes(searchQuery.toLowerCase())) {\r\n      return false;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  return (\r\n    <section className=\"pt-6\">\r\n      <h2 className=\"font-serif text-3xl mb-2\">ð¢ Fornitori</h2>\r\n      <p className=\"text-gray-600 mb-6 text-sm sm:text-base leading-relaxed\">\r\n        Esplora il database di fornitori per il tuo matrimonio: location, fotografi, fioristi, catering e molto altro. \r\n        Filtra per regione, provincia e categoria. Puoi anche aggiungere fornitori personalizzati.\r\n      </p>\r\n\r\n      {/* Carosello immagini */}\r\n      <ImageCarousel images={getPageImages(\"fornitori\", country)} height=\"280px\" />\n\r\n      {message && (\r\n        <div className=\"mb-4 p-4 rounded-lg bg-blue-50 border border-blue-200 text-sm\">\r\n          {message}\r\n        </div>\r\n      )}\r\n\r\n      {/* Filtri */}\r\n      <div className=\"mb-6 p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm\">\r\n        <h3 className=\"font-semibold mb-4\">Filtra fornitori</h3>\r\n        <div className=\"grid grid-cols-4 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Regione</label>\r\n            <select\r\n              className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n              value={selectedRegion}\r\n              onChange={(e) => {\r\n                setSelectedRegion(e.target.value);\r\n                setSelectedProvince(\"\");\r\n              }}\r\n            >\r\n              <option value=\"\">Tutte le regioni</option>\r\n              {REGIONS.map((r) => (\r\n                <option key={r} value={r}>\r\n                  {r}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Provincia</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n              value={selectedProvince}\r\n              onChange={(e) => setSelectedProvince(e.target.value)}\r\n              placeholder=\"Es. Milano\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Categoria</label>\r\n            <select\r\n              className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n              value={selectedCategory}\r\n              onChange={(e) => setSelectedCategory(e.target.value)}\r\n            >\r\n              <option value=\"\">Tutte le categorie</option>\r\n              {CATEGORIES.map((c) => (\r\n                <option key={c} value={c}>\r\n                  {c}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Cerca</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              placeholder=\"Nome fornitore...\"\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"mt-4 flex gap-2\">\r\n          <button\r\n            onClick={loadSuppliers}\r\n            className=\"bg-[#A3B59D] text-white rounded-lg px-4 py-2 hover:bg-[#8a9d84]\"\r\n          >\r\n            Cerca\r\n          </button>\r\n          <button\r\n            onClick={() => {\r\n              setSelectedRegion(\"\");\r\n              setSelectedProvince(\"\");\r\n              setSelectedCategory(\"\");\r\n              setSearchQuery(\"\");\r\n            }}\r\n            className=\"border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50\"\r\n          >\r\n            Resetta filtri\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Bottone proponi fornitore */}\r\n      <div className=\"mb-6\">\r\n        <button\r\n          onClick={() => setShowAddForm(!showAddForm)}\r\n          className=\"border border-[#A3B59D] text-[#A3B59D] rounded-lg px-4 py-2 hover:bg-[#A3B59D] hover:text-white\"\r\n        >\r\n          {showAddForm ? \"Annulla\" : \"ð¡ Proponi un nuovo fornitore\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Form proponi fornitore */}\r\n      {showAddForm && (\r\n        <div className=\"mb-6 p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm\">\r\n          <h3 className=\"font-semibold mb-4\">Proponi un nuovo fornitore</h3>\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Nome fornitore *</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newSupplier.name}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, name: e.target.value })}\r\n                placeholder=\"Nome completo\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Categoria *</label>\r\n              <select\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newSupplier.category}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, category: e.target.value })}\r\n              >\r\n                {CATEGORIES.map((c) => (\r\n                  <option key={c} value={c}>\r\n                    {c}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Regione *</label>\r\n              <select\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newSupplier.region}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, region: e.target.value })}\r\n              >\r\n                {REGIONS.map((r) => (\r\n                  <option key={r} value={r}>\r\n                    {r}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Provincia</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newSupplier.province}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, province: e.target.value })}\r\n                placeholder=\"Es. Milano\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">CittÃ </label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newSupplier.city}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, city: e.target.value })}\r\n                placeholder=\"Es. Milano\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Telefono</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newSupplier.phone}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, phone: e.target.value })}\r\n                placeholder=\"+39 ...\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email</label>\r\n              <input\r\n                type=\"email\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newSupplier.email}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, email: e.target.value })}\r\n                placeholder=\"email@example.com\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Sito web</label>\r\n              <input\r\n                type=\"url\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newSupplier.website}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, website: e.target.value })}\r\n                placeholder=\"https://...\"\r\n              />\r\n            </div>\r\n            <div className=\"col-span-2\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Descrizione</label>\r\n              <textarea\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                rows={3}\r\n                value={newSupplier.description}\r\n                onChange={(e) => setNewSupplier({ ...newSupplier, description: e.target.value })}\r\n                placeholder=\"Breve descrizione del fornitore...\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"mt-4\">\r\n            <button\r\n              onClick={submitNewSupplier}\r\n              className=\"bg-[#A3B59D] text-white rounded-lg px-6 py-2 hover:bg-[#8a9d84]\"\r\n            >\r\n              Invia proposta\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Toggle Vista */}\r\n      <div className=\"mb-6 flex justify-between items-center\">\r\n        <p className=\"text-sm text-gray-600\">\r\n          {filteredSuppliers.length} {filteredSuppliers.length === 1 ? \"fornitore trovato\" : \"fornitori trovati\"}\r\n        </p>\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            onClick={() => setViewMode(\"grid\")}\r\n            className={`px-4 py-2 rounded-lg font-medium transition-colors ${\r\n              viewMode === \"grid\"\r\n                ? \"bg-[#A3B59D] text-white\"\r\n                : \"border border-gray-300 text-gray-700 hover:bg-gray-50\"\r\n            }`}\r\n          >\r\n            ð² Griglia\r\n          </button>\r\n          <button\r\n            onClick={() => setViewMode(\"list\")}\r\n            className={`px-4 py-2 rounded-lg font-medium transition-colors ${\r\n              viewMode === \"list\"\r\n                ? \"bg-[#A3B59D] text-white\"\r\n                : \"border border-gray-300 text-gray-700 hover:bg-gray-50\"\r\n            }`}\r\n          >\r\n            ð Lista\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Lista/Griglia Fornitori */}\r\n      {loading ? (\r\n        <p className=\"text-gray-500\">Caricamento...</p>\r\n      ) : filteredSuppliers.length === 0 ? (\r\n        <div className=\"p-10 text-center text-gray-400 rounded-2xl border border-gray-200 bg-white/70\">\r\n          <div className=\"text-5xl mb-4\">ð</div>\r\n          <p className=\"text-lg font-medium\">Nessun fornitore trovato</p>\r\n          <p className=\"text-sm mt-2\">Prova a modificare i filtri o proponi un nuovo fornitore</p>\r\n        </div>\r\n      ) : viewMode === \"grid\" ? (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {filteredSuppliers.map((supplier) => (\r\n            <div\r\n              key={supplier.id}\r\n              className=\"p-6 rounded-2xl border-2 border-gray-200 bg-white shadow-soft hover:shadow-soft-lg hover:scale-105 transition-all cursor-pointer\"\r\n            >\r\n              {/* Icona Categoria */}\r\n              <div className=\"flex items-start justify-between mb-4\">\r\n                <div className=\"w-14 h-14 rounded-full bg-gradient-to-br from-[#EAD9D4] to-[#A6B5A0] flex items-center justify-center text-3xl\">\r\n                  {CATEGORY_ICONS[supplier.category] || \"ð¢\"}\r\n                </div>\r\n                {supplier.rating > 0 && (\r\n                  <div className=\"flex items-center gap-1 text-sm\">\r\n                    <span className=\"text-yellow-500\">â­</span>\r\n                    <span className=\"font-bold text-gray-800\">{supplier.rating.toFixed(1)}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Nome e Categoria */}\r\n              <h3 className=\"font-bold text-lg text-gray-900 mb-2 line-clamp-2\">\r\n                {supplier.name}\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600 mb-3 flex items-center gap-1\">\r\n                <span>{CATEGORY_ICONS[supplier.category] || \"ð¢\"}</span>\r\n                <span>{supplier.category}</span>\r\n              </p>\r\n\r\n              {/* LocalitÃ  */}\r\n              <p className=\"text-sm text-gray-700 mb-3 flex items-center gap-1\">\r\n                <span>ð</span>\r\n                <span>{supplier.city}, {supplier.province}</span>\r\n              </p>\r\n\r\n              {/* Prezzo */}\r\n              <div className=\"mb-4\">\r\n                <span className=\"inline-block bg-[#A6B5A0] text-white px-3 py-1 rounded-full text-sm font-bold\">\r\n                  {supplier.priceRange}\r\n                </span>\r\n              </div>\r\n\r\n              {/* Descrizione */}\r\n              {supplier.description && (\r\n                <p className=\"text-sm text-gray-600 mb-4 line-clamp-2\">\r\n                  {supplier.description}\r\n                </p>\r\n              )}\r\n\r\n              {/* Azioni */}\r\n              <div className=\"flex flex-col gap-2 mt-auto\">\r\n                {supplier.website && (\r\n                  <a\r\n                    href={supplier.website}\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"text-center bg-white border-2 border-[#A6B5A0] text-[#A6B5A0] px-4 py-2 rounded-lg font-medium hover:bg-[#A6B5A0] hover:text-white transition-colors text-sm\"\r\n                  >\r\n                    ð Visita sito\r\n                  </a>\r\n                )}\r\n                <button\r\n                  onClick={() => {\r\n                    showToast(`${supplier.name} aggiunto ai preferiti!`, \"success\");\r\n                  }}\r\n                  className=\"text-center bg-[#A6B5A0] text-white px-4 py-2 rounded-lg font-medium hover:bg-[#8a9d84] transition-colors text-sm\"\r\n                >\r\n                  â¤ï¸ Aggiungi al mio evento\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {filteredSuppliers.map((supplier) => (\r\n            <div key={supplier.id} className=\"p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm hover:shadow-md transition-shadow\">\r\n              <div className=\"flex justify-between items-start\">\r\n                <div className=\"flex gap-4 flex-1\">\r\n                  {/* Icona */}\r\n                  <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-[#EAD9D4] to-[#A6B5A0] flex items-center justify-center text-2xl flex-shrink-0\">\r\n                    {CATEGORY_ICONS[supplier.category] || \"ð¢\"}\r\n                  </div>\r\n\r\n                  <div className=\"flex-1\">\r\n                    <h3 className=\"font-semibold text-lg text-gray-800\">{supplier.name}</h3>\r\n                    <div className=\"text-sm text-gray-600 mt-1\">\r\n                      {supplier.category} â¢ {supplier.city}, {supplier.province} ({supplier.region})\r\n                    </div>\r\n                    {supplier.description && (\r\n                      <p className=\"text-sm text-gray-700 mt-2\">{supplier.description}</p>\r\n                    )}\r\n                    <div className=\"flex gap-4 mt-3 text-xs text-gray-500\">\r\n                      {supplier.phone && <span>ð {supplier.phone}</span>}\r\n                      {supplier.email && <span>âï¸ {supplier.email}</span>}\r\n                      {supplier.website && (\r\n                        <a href={supplier.website} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 hover:underline\">\r\n                          ð Sito web\r\n                        </a>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-right flex flex-col gap-2\">\r\n                  <div className=\"text-sm font-medium text-gray-700\">{supplier.priceRange}</div>\r\n                  {supplier.rating > 0 && (\r\n                    <div className=\"text-xs text-yellow-600\">\r\n                      â­ {supplier.rating.toFixed(1)}\r\n                    </div>\r\n                  )}\r\n                  <button\r\n                    onClick={() => {\r\n                      showToast(`${supplier.name} aggiunto ai preferiti!`, \"success\");\r\n                    }}\r\n                    className=\"mt-2 bg-[#A6B5A0] text-white px-3 py-1.5 rounded-lg text-xs font-medium hover:bg-[#8a9d84] transition-colors\"\r\n                  >\r\n                    â¤ï¸ Aggiungi\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\fornitori\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\fotografi\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [region, province, load]","fix":{"range":[1632,1650],"text":"[region, province, load]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\gioiellerie\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [region, province, load]","fix":{"range":[1624,1642],"text":"[region, province, load]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\idea-di-budget\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\invitati\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\invitati\\tavoli\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1110,1113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1110,1113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1382,1385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1382,1385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":149,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":149,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5153,5156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5153,5156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":184,"column":58,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[7225,7305],"text":"Clicca su &quot;Auto-assegna per Famiglia\" per generare una proposta di disposizione."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[7225,7305],"text":"Clicca su &ldquo;Auto-assegna per Famiglia\" per generare una proposta di disposizione."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[7225,7305],"text":"Clicca su &#34;Auto-assegna per Famiglia\" per generare una proposta di disposizione."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[7225,7305],"text":"Clicca su &rdquo;Auto-assegna per Famiglia\" per generare una proposta di disposizione."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":184,"column":84,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[7225,7305],"text":"Clicca su \"Auto-assegna per Famiglia&quot; per generare una proposta di disposizione."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[7225,7305],"text":"Clicca su \"Auto-assegna per Famiglia&ldquo; per generare una proposta di disposizione."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[7225,7305],"text":"Clicca su \"Auto-assegna per Famiglia&#34; per generare una proposta di disposizione."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[7225,7305],"text":"Clicca su \"Auto-assegna per Famiglia&rdquo; per generare una proposta di disposizione."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"ï»¿\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\n\ntype AssignedGuest = { guestId: string; seatNumber: number; guestName?: string };\ntype Table = {\n  id?: string;\n  tableNumber?: number;\n  tableName?: string;\n  tableType?: string;\n  totalSeats: number;\n  notes?: string;\n  assignedGuests: AssignedGuest[];\n};\n\ntype AvailableGuest = {\n  id: string;\n  name: string;\n  guestType: \"bride\" | \"groom\" | \"common\";\n  familyGroupId?: string | null;\n  familyName?: string | null;\n  excludeFromFamilyTable?: boolean;\n};\n\nexport default function TavoliPage() {\n  const [tables, setTables] = useState<Table[]>([]);\n  const [availableGuests, setAvailableGuests] = useState<AvailableGuest[]>([]);\n  const [seatsPerTable, setSeatsPerTable] = useState<number>(8);\n  const [message, setMessage] = useState<string | null>(null);\n  const [saving, setSaving] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(\"/api/my/tables\");\n        const json = await res.json();\n        setTables((json.tables || []).map((t: any) => ({\n          id: t.id,\n          tableNumber: t.tableNumber,\n          tableName: t.tableName,\n          tableType: t.tableType,\n          totalSeats: Number(t.totalSeats || 0),\n          notes: t.notes,\n          assignedGuests: (t.assignedGuests || []).map((ag: any) => ({\n            guestId: ag.guestId,\n            seatNumber: ag.seatNumber,\n            guestName: ag.guestName,\n          })),\n        })));\n        setAvailableGuests(json.availableGuests || []);\n      } catch (e) {\n        console.error(e);\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, []);\n\n  if (loading) {\n    return <div className=\"pt-6\">Caricamento tavoli...</div>;\n  }\n\n  const totalTables = tables.length;\n  const totalSeats = tables.reduce((s, t) => s + (t.totalSeats || 0), 0);\n  const assignedSeats = tables.reduce((s, t) => s + (t.assignedGuests?.length || 0), 0);\n  const availableSeats = totalSeats - assignedSeats;\n\n  function autoAssignByFamily() {\n    if (!availableGuests || availableGuests.length === 0) {\n      setMessage(\"Nessun invitato disponibile da assegnare.\");\n      return;\n    }\n\n    // Separate included (family table) and excluded (cousins/others)\n    const inc = availableGuests.filter(g => !g.excludeFromFamilyTable);\n    const exc = availableGuests.filter(g => g.excludeFromFamilyTable);\n\n    // Group included by family\n    const byFamily = new Map<string, { name: string; members: AvailableGuest[] }>();\n    for (const g of inc) {\n      const key = g.familyGroupId || `no-family`;\n      const fam = byFamily.get(key) || { name: g.familyName || \"Senza famiglia\", members: [] };\n      fam.members.push(g);\n      byFamily.set(key, fam);\n    }\n\n    const newTables: Table[] = [];\n    let tableCounter = 1;\n\n    // Helper to create chunked tables\n    function createTablesForGroup(label: string, members: AvailableGuest[], type: string) {\n      for (let i = 0; i < members.length; i += seatsPerTable) {\n        const slice = members.slice(i, i + seatsPerTable);\n        const tableName = type === \"family\" && members.length <= seatsPerTable\n          ? `Tavolo ${label}`\n          : `${type === \"family\" ? `Tavolo ${label}` : `Tavolo Cugini`} ${Math.floor(i / seatsPerTable) + 1}`;\n        const assigned: AssignedGuest[] = slice.map((g, idx) => ({ guestId: g.id, seatNumber: idx + 1, guestName: g.name }));\n        newTables.push({\n          tableNumber: tableCounter++,\n          tableName,\n          tableType: type,\n          totalSeats: seatsPerTable,\n          notes: \"\",\n          assignedGuests: assigned,\n        });\n      }\n    }\n\n    // Families (included)\n    for (const [key, fam] of byFamily.entries()) {\n      if (key === 'no-family') continue; // handle later\n      if (fam.members.length === 0) continue;\n      createTablesForGroup(`Famiglia ${fam.name}`, fam.members, \"family\");\n    }\n\n    // Guests without family but included â group into generic tables\n    const noFamilyIncluded = byFamily.get('no-family')?.members || [];\n    if (noFamilyIncluded.length > 0) {\n      createTablesForGroup(\"Amici\", noFamilyIncluded, \"friends\");\n    }\n\n    // Excluded across families â Cugini tables\n    if (exc.length > 0) {\n      // Keep a stable order by familyName and name\n      const sortedExc = [...exc].sort((a, b) => (a.familyName || '').localeCompare(b.familyName || '') || a.name.localeCompare(b.name));\n      createTablesForGroup(\"Cugini\", sortedExc, \"cousins\");\n    }\n\n    setTables(newTables);\n    setMessage(`Generati ${newTables.length} tavoli da ${availableGuests.length} invitati disponibili.`);\n  }\n\n  async function saveTables() {\n    setSaving(true);\n    setMessage(null);\n    try {\n      const res = await fetch('/api/my/tables', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ tables }),\n      });\n      if (!res.ok) {\n        const j = await res.json();\n        setMessage(`Errore salvataggio: ${j.error || 'Impossibile salvare'}`);\n      } else {\n        setMessage('â Tavoli salvati!');\n      }\n    } catch (e: any) {\n      setMessage('Errore di rete nel salvataggio');\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  return (\n    <section className=\"pt-6\">\n      <div className=\"flex items-start justify-between mb-4\">\n        <h1 className=\"font-serif text-3xl\">Disposizione Tavoli</h1>\n        <div className=\"flex gap-2\">\n          <a href=\"/invitati\" className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full border text-sm bg-white border-gray-300 hover:bg-gray-50\">Torna a Invitati</a>\n          <button onClick={autoAssignByFamily} className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full text-white text-sm\" style={{ background: 'var(--color-sage)' }}>Auto-assegna per Famiglia</button>\n        </div>\n      </div>\n\n      <div className=\"mb-6 p-5 sm:p-6 rounded-2xl border border-gray-200 bg-white shadow-sm\">\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm sm:text-base\">\n          <div className=\"p-4 bg-gray-50 rounded-lg border\">Tavoli Totali: <strong>{totalTables}</strong></div>\n          <div className=\"p-4 bg-gray-50 rounded-lg border\">Posti Totali: <strong>{totalSeats}</strong></div>\n          <div className=\"p-4 bg-gray-50 rounded-lg border\">Posti Assegnati: <strong>{assignedSeats}</strong></div>\n          <div className=\"p-4 bg-gray-50 rounded-lg border\">Posti Liberi: <strong>{availableSeats}</strong></div>\n        </div>\n        <div className=\"mt-4 flex items-center gap-3 text-sm\">\n          <label className=\"font-semibold\">Posti per tavolo</label>\n          <input type=\"number\" min={4} max={14} value={seatsPerTable} onChange={(e) => setSeatsPerTable(Number(e.target.value || 8))} className=\"border rounded px-2 py-1 w-20\" />\n          <span className=\"text-gray-500\">(consigliato 8-10)</span>\n        </div>\n        {message && <div className=\"mt-3 text-sm p-2 rounded border bg-gray-50\">{message}</div>}\n      </div>\n\n      {/* Preview simple list */}\n      <div className=\"p-6 rounded-lg border border-gray-200 bg-white/70\">\n        {tables.length === 0 ? (\n          <p className=\"text-sm text-gray-600\">Clicca su \"Auto-assegna per Famiglia\" per generare una proposta di disposizione.</p>\n        ) : (\n          <div className=\"space-y-3\">\n            {tables.map((t, idx) => (\n              <div key={idx} className=\"border rounded p-3\">\n                <div className=\"font-semibold\">{t.tableName || `Tavolo ${t.tableNumber}`}</div>\n                <div className=\"text-xs text-gray-500 mb-2\">Tipo: {t.tableType || 'n/d'} â¢ Posti: {t.totalSeats} â¢ Assegnati: {t.assignedGuests.length}</div>\n                <ul className=\"text-sm list-disc pl-5\">\n                  {t.assignedGuests.map((ag) => (\n                    <li key={ag.guestId}>{ag.guestName || ag.guestId}</li>\n                  ))}\n                </ul>\n              </div>\n            ))}\n            <div className=\"flex justify-end\">\n              <button onClick={saveTables} disabled={saving} className=\"px-4 py-2 rounded text-white\" style={{ background: 'var(--color-sage)' }}>{saving ? 'Salvataggio...' : 'Salva disposizione'}</button>\n            </div>\n          </div>\n        )}\n      </div>\n    </section>\n  );\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\laurea\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\lista-nozze\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\location\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\musica-cerimonia\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMusicians'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [selectedRegion, selectedProvince, loadMusicians]","fix":{"range":[1650,1684],"text":"[selectedRegion, selectedProvince, loadMusicians]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport Breadcrumb from \"@/components/Breadcrumb\";\nimport ImageCarousel from \"@/components/ImageCarousel\";\nimport { getUserCountrySafe } from \"@/constants/geo\";\nimport { getPageImages } from \"@/lib/pageImages\";\n\r\ntype MusicaCerimonia = {\r\n  id: string;\r\n  name: string;\r\n  region: string;\r\n  province: string;\r\n  city: string;\r\n  phone?: string;\r\n  email?: string;\r\n  website?: string;\r\n  description?: string;\r\n  price_range?: string;\r\n  music_type?: string; // es: \"Coro, Organo, Arpa, Violino, Band\"\r\n  verified: boolean;\r\n  status: \"pending\" | \"approved\" | \"rejected\";\r\n};\r\n\r\nconst ITALIAN_REGIONS = [\r\n  \"Abruzzo\", \"Basilicata\", \"Calabria\", \"Campania\", \"Emilia-Romagna\",\r\n  \"Friuli-Venezia Giulia\", \"Lazio\", \"Liguria\", \"Lombardia\", \"Marche\",\r\n  \"Molise\", \"Piemonte\", \"Puglia\", \"Sardegna\", \"Sicilia\", \"Toscana\",\r\n  \"Trentino-Alto Adige\", \"Umbria\", \"Valle d'Aosta\", \"Veneto\"\r\n];\r\n\r\nexport default function MusicaCerimoniaPage() {\n  const [musicians, setMusicians] = useState<MusicaCerimonia[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedRegion, setSelectedRegion] = useState(\"\");\n  const [selectedProvince, setSelectedProvince] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n  const country = getUserCountrySafe();\n  \r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    region: \"\",\r\n    province: \"\",\r\n    city: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    website: \"\",\r\n    description: \"\",\r\n    price_range: \"\",\r\n    music_type: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadMusicians();\r\n  }, [selectedRegion, selectedProvince]);\r\n\r\n  async function loadMusicians() {\r\n    try {\r\n      setLoading(true);\r\n      const params = new URLSearchParams();\n      if (selectedRegion) params.append(\"region\", selectedRegion);\n      if (selectedProvince) params.append(\"province\", selectedProvince);\n      try {\n        const cookieCountry = document.cookie.match(/(?:^|; )country=([^;]+)/)?.[1];\n        const lsCountry = localStorage.getItem(\"country\");\n        const country = cookieCountry || lsCountry;\n        if (country) params.append(\"country\", country);\n      } catch {}\n\r\n      const res = await fetch(`/api/musica-cerimonia?${params.toString()}`);\r\n      const data = await res.json();\r\n      setMusicians(data.musicians || []);\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n\r\n    try {\r\n      const res = await fetch(\"/api/musica-cerimonia\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      if (res.ok) {\r\n        alert(\"Musica cerimonia inviata! SarÃ  verificata prima della pubblicazione.\");\r\n        setFormData({\r\n          name: \"\",\r\n          region: \"\",\r\n          province: \"\",\r\n          city: \"\",\r\n          phone: \"\",\r\n          email: \"\",\r\n          website: \"\",\r\n          description: \"\",\r\n          price_range: \"\",\r\n          music_type: \"\",\r\n        });\r\n        setShowAddForm(false);\r\n        loadMusicians();\r\n      } else {\r\n        alert(\"Errore nell'invio\");\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Errore di rete\");\r\n    }\r\n  }\r\n\r\n  const approvedMusicians = musicians.filter(m => m.status === \"approved\");\r\n\r\n  return (\r\n    <section className=\"pt-6\">\r\n      {/* Breadcrumb */}\r\n      <Breadcrumb\r\n        items={[\r\n          { label: \"ð  Home\", href: \"/\" },\r\n          { label: \"Fornitori\", href: \"/fornitori\" },\r\n          { label: \"Musica Cerimonia\" },\r\n        ]}\r\n      />\r\n\r\n      {/* Header con bottone Torna a Fornitori */}\r\n      <div className=\"flex items-start justify-between mb-4\">\r\n        <div className=\"flex-1\">\r\n          <h2 className=\"font-serif text-3xl mb-2\">Musica Cerimonia</h2>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Trova musicisti e gruppi verificati per la cerimonia nuziale. Puoi proporre nuovi artisti che verranno verificati prima della pubblicazione.\r\n          </p>\r\n        </div>\r\n        <Link\r\n          href=\"/fornitori\"\r\n          className=\"ml-4 px-4 py-2 bg-white border-2 border-[#A3B59D] text-[#A3B59D] rounded-lg hover:bg-[#A3B59D] hover:text-white transition-colors font-semibold text-sm whitespace-nowrap\"\r\n        >\r\n          â Tutti i Fornitori\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Carosello immagini */}\r\n      <ImageCarousel images={getPageImages(\"musica-cerimonia\", country)} height=\"280px\" />\n\r\n      {/* Filtri */}\r\n      <div className=\"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Regione</label>\r\n          <select\r\n            className=\"w-full border border-gray-300 rounded-lg px-3 py-2\"\r\n            value={selectedRegion}\r\n            onChange={(e) => {\r\n              setSelectedRegion(e.target.value);\r\n              setSelectedProvince(\"\");\r\n            }}\r\n          >\r\n            <option value=\"\">Tutte le regioni</option>\r\n            {ITALIAN_REGIONS.map(r => (\r\n              <option key={r} value={r}>{r}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Provincia</label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"w-full border border-gray-300 rounded-lg px-3 py-2\"\r\n            placeholder=\"Es: Roma\"\r\n            value={selectedProvince}\r\n            onChange={(e) => setSelectedProvince(e.target.value)}\r\n          />\r\n        </div>\r\n        <div className=\"flex items-end\">\r\n          <button\r\n            onClick={() => setShowAddForm(!showAddForm)}\r\n            className=\"w-full bg-[#A3B59D] text-white rounded-lg px-4 py-2 hover:bg-[#8a9d84]\"\r\n          >\r\n            {showAddForm ? \"Annulla\" : \"+ Proponi musicista/gruppo\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Form aggiunta */}\r\n      {showAddForm && (\r\n        <div className=\"mb-6 p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm\">\r\n          <h3 className=\"font-semibold mb-4\">Proponi musicista/gruppo</h3>\r\n          <form onSubmit={handleSubmit}>\r\n            <div className=\"grid grid-cols-2 gap-4 mb-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Nome artista/gruppo *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Regione *</label>\r\n                <select\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.region}\r\n                  onChange={(e) => setFormData({ ...formData, region: e.target.value })}\r\n                >\r\n                  <option value=\"\">Seleziona...</option>\r\n                  {ITALIAN_REGIONS.map(r => (\r\n                    <option key={r} value={r}>{r}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Provincia *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.province}\r\n                  onChange={(e) => setFormData({ ...formData, province: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">CittÃ  *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.city}\r\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Telefono</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.phone}\r\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email</label>\r\n                <input\r\n                  type=\"email\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.email}\r\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Sito web</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"https://...\"\r\n                  value={formData.website}\r\n                  onChange={(e) => setFormData({ ...formData, website: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Fascia di prezzo</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"Es: â¬â¬\"\r\n                  value={formData.price_range}\r\n                  onChange={(e) => setFormData({ ...formData, price_range: e.target.value })}\r\n                />\r\n              </div>\r\n              <div className=\"col-span-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Tipo di musica</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"Es: Coro, Organo, Arpa, Violino, Band\"\r\n                  value={formData.music_type}\r\n                  onChange={(e) => setFormData({ ...formData, music_type: e.target.value })}\r\n                />\r\n              </div>\r\n              <div className=\"col-span-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Descrizione</label>\r\n                <textarea\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  rows={3}\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                />\r\n              </div>\r\n            </div>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"bg-[#A3B59D] text-white rounded-lg px-6 py-2 hover:bg-[#8a9d84]\"\r\n            >\r\n              Invia per approvazione\r\n            </button>\r\n          </form>\r\n        </div>\r\n      )}\r\n\r\n      {/* Risultati */}\r\n      {loading ? (\r\n        <div className=\"text-gray-500\">Caricamento...</div>\r\n      ) : approvedMusicians.length === 0 ? (\r\n        <div className=\"p-10 text-center text-gray-400 rounded-2xl border border-gray-200 bg-white/70\">\r\n          Nessun musicista trovato per i filtri selezionati\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          {approvedMusicians.map((musician) => (\r\n            <div\r\n              key={musician.id}\r\n              className=\"p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm hover:shadow-md transition-shadow\"\r\n            >\r\n              <div className=\"flex items-start justify-between mb-3\">\r\n                <h3 className=\"font-semibold text-lg\">{musician.name}</h3>\r\n                {musician.verified && (\r\n                  <span className=\"bg-green-100 text-green-700 text-xs px-2 py-1 rounded\">â Verificato</span>\r\n                )}\r\n              </div>\r\n              <div className=\"text-sm text-gray-600 space-y-1 mb-3\">\r\n                <div>ð {musician.city}, {musician.province} ({musician.region})</div>\r\n                {musician.phone && <div>ð {musician.phone}</div>}\r\n                {musician.email && <div>ð§ {musician.email}</div>}\r\n                {musician.website && (\r\n                  <div>\r\n                    ð <a href={musician.website} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-[#A3B59D] hover:underline\">\r\n                      {musician.website}\r\n                    </a>\r\n                  </div>\r\n                )}\r\n                {musician.price_range && <div>ð° {musician.price_range}</div>}\r\n                {musician.music_type && <div>ðµ {musician.music_type}</div>}\r\n              </div>\r\n              {musician.description && (\r\n                <p className=\"text-sm text-gray-700 mt-2\">{musician.description}</p>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\musica-ricevimento\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMusicians'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [selectedRegion, selectedProvince, loadMusicians]","fix":{"range":[1661,1695],"text":"[selectedRegion, selectedProvince, loadMusicians]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport ImageCarousel from \"@/components/ImageCarousel\";\nimport { getUserCountrySafe } from \"@/constants/geo\";\nimport { getPageImages } from \"@/lib/pageImages\";\nimport Breadcrumb from \"@/components/Breadcrumb\";\n\r\ntype MusicaRicevimento = {\r\n  id: string;\r\n  name: string;\r\n  region: string;\r\n  province: string;\r\n  city: string;\r\n  phone?: string;\r\n  email?: string;\r\n  website?: string;\r\n  description?: string;\r\n  price_range?: string;\r\n  music_type?: string; // es: \"DJ, Band live, Orchestra, Duo acustico\"\r\n  verified: boolean;\r\n  status: \"pending\" | \"approved\" | \"rejected\";\r\n};\r\n\r\nconst ITALIAN_REGIONS = [\r\n  \"Abruzzo\", \"Basilicata\", \"Calabria\", \"Campania\", \"Emilia-Romagna\",\r\n  \"Friuli-Venezia Giulia\", \"Lazio\", \"Liguria\", \"Lombardia\", \"Marche\",\r\n  \"Molise\", \"Piemonte\", \"Puglia\", \"Sardegna\", \"Sicilia\", \"Toscana\",\r\n  \"Trentino-Alto Adige\", \"Umbria\", \"Valle d'Aosta\", \"Veneto\"\r\n];\r\n\r\nexport default function MusicaRicevimentoPage() {\n  const [musicians, setMusicians] = useState<MusicaRicevimento[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedRegion, setSelectedRegion] = useState(\"\");\n  const [selectedProvince, setSelectedProvince] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n  const country = getUserCountrySafe();\n  \r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    region: \"\",\r\n    province: \"\",\r\n    city: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    website: \"\",\r\n    description: \"\",\r\n    price_range: \"\",\r\n    music_type: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadMusicians();\r\n  }, [selectedRegion, selectedProvince]);\r\n\r\n  async function loadMusicians() {\r\n    try {\r\n      setLoading(true);\r\n      const params = new URLSearchParams();\n      if (selectedRegion) params.append(\"region\", selectedRegion);\n      if (selectedProvince) params.append(\"province\", selectedProvince);\n      try {\n        const cookieCountry = document.cookie.match(/(?:^|; )country=([^;]+)/)?.[1];\n        const lsCountry = localStorage.getItem(\"country\");\n        const country = cookieCountry || lsCountry;\n        if (country) params.append(\"country\", country);\n      } catch {}\n\r\n      const res = await fetch(`/api/musica-ricevimento?${params.toString()}`);\r\n      const data = await res.json();\r\n      setMusicians(data.musicians || []);\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n\r\n    try {\r\n      const res = await fetch(\"/api/musica-ricevimento\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      if (res.ok) {\r\n        alert(\"Musica ricevimento inviata! SarÃ  verificata prima della pubblicazione.\");\r\n        setFormData({\r\n          name: \"\",\r\n          region: \"\",\r\n          province: \"\",\r\n          city: \"\",\r\n          phone: \"\",\r\n          email: \"\",\r\n          website: \"\",\r\n          description: \"\",\r\n          price_range: \"\",\r\n          music_type: \"\",\r\n        });\r\n        setShowAddForm(false);\r\n        loadMusicians();\r\n      } else {\r\n        alert(\"Errore nell'invio\");\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Errore di rete\");\r\n    }\r\n  }\r\n\r\n  const approvedMusicians = musicians.filter(m => m.status === \"approved\");\r\n\r\n  return (\r\n    <section className=\"pt-6\">\r\n      {/* Breadcrumb */}\r\n      <Breadcrumb\r\n        items={[\r\n          { label: \"ð  Home\", href: \"/\" },\r\n          { label: \"Fornitori\", href: \"/fornitori\" },\r\n          { label: \"Musica Ricevimento\" },\r\n        ]}\r\n      />\r\n\r\n      {/* Header con bottone Torna a Fornitori */}\r\n      <div className=\"flex items-start justify-between mb-4\">\r\n        <div className=\"flex-1\">\r\n          <h2 className=\"font-serif text-3xl mb-2\">Musica Ricevimento</h2>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Trova DJ, band e intrattenimento musicale verificato per il ricevimento. Puoi proporre nuovi artisti che verranno verificati prima della pubblicazione.\r\n          </p>\r\n        </div>\r\n        <Link\r\n          href=\"/fornitori\"\r\n          className=\"ml-4 px-4 py-2 bg-white border-2 border-[#A3B59D] text-[#A3B59D] rounded-lg hover:bg-[#A3B59D] hover:text-white transition-colors font-semibold text-sm whitespace-nowrap\"\r\n        >\r\n          â Tutti i Fornitori\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Carosello immagini */}\r\n      <ImageCarousel images={getPageImages(\"musica-ricevimento\", country)} height=\"280px\" />\n\r\n      {/* Filtri */}\r\n      <div className=\"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Regione</label>\r\n          <select\r\n            className=\"w-full border border-gray-300 rounded-lg px-3 py-2\"\r\n            value={selectedRegion}\r\n            onChange={(e) => {\r\n              setSelectedRegion(e.target.value);\r\n              setSelectedProvince(\"\");\r\n            }}\r\n          >\r\n            <option value=\"\">Tutte le regioni</option>\r\n            {ITALIAN_REGIONS.map(r => (\r\n              <option key={r} value={r}>{r}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Provincia</label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"w-full border border-gray-300 rounded-lg px-3 py-2\"\r\n            placeholder=\"Es: Napoli\"\r\n            value={selectedProvince}\r\n            onChange={(e) => setSelectedProvince(e.target.value)}\r\n          />\r\n        </div>\r\n        <div className=\"flex items-end\">\r\n          <button\r\n            onClick={() => setShowAddForm(!showAddForm)}\r\n            className=\"w-full bg-[#A3B59D] text-white rounded-lg px-4 py-2 hover:bg-[#8a9d84]\"\r\n          >\r\n            {showAddForm ? \"Annulla\" : \"+ Proponi DJ/band\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Form aggiunta */}\r\n      {showAddForm && (\r\n        <div className=\"mb-6 p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm\">\r\n          <h3 className=\"font-semibold mb-4\">Proponi DJ/band per ricevimento</h3>\r\n          <form onSubmit={handleSubmit}>\r\n            <div className=\"grid grid-cols-2 gap-4 mb-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Nome artista/gruppo *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Regione *</label>\r\n                <select\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.region}\r\n                  onChange={(e) => setFormData({ ...formData, region: e.target.value })}\r\n                >\r\n                  <option value=\"\">Seleziona...</option>\r\n                  {ITALIAN_REGIONS.map(r => (\r\n                    <option key={r} value={r}>{r}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Provincia *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.province}\r\n                  onChange={(e) => setFormData({ ...formData, province: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">CittÃ  *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.city}\r\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Telefono</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.phone}\r\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email</label>\r\n                <input\r\n                  type=\"email\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.email}\r\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Sito web</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"https://...\"\r\n                  value={formData.website}\r\n                  onChange={(e) => setFormData({ ...formData, website: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Fascia di prezzo</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"Es: â¬â¬â¬\"\r\n                  value={formData.price_range}\r\n                  onChange={(e) => setFormData({ ...formData, price_range: e.target.value })}\r\n                />\r\n              </div>\r\n              <div className=\"col-span-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Tipo di musica</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"Es: DJ, Band live, Orchestra, Duo acustico\"\r\n                  value={formData.music_type}\r\n                  onChange={(e) => setFormData({ ...formData, music_type: e.target.value })}\r\n                />\r\n              </div>\r\n              <div className=\"col-span-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Descrizione</label>\r\n                <textarea\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  rows={3}\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                />\r\n              </div>\r\n            </div>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"bg-[#A3B59D] text-white rounded-lg px-6 py-2 hover:bg-[#8a9d84]\"\r\n            >\r\n              Invia per approvazione\r\n            </button>\r\n          </form>\r\n        </div>\r\n      )}\r\n\r\n      {/* Risultati */}\r\n      {loading ? (\r\n        <div className=\"text-gray-500\">Caricamento...</div>\r\n      ) : approvedMusicians.length === 0 ? (\r\n        <div className=\"p-10 text-center text-gray-400 rounded-2xl border border-gray-200 bg-white/70\">\r\n          Nessun DJ/band trovato per i filtri selezionati\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          {approvedMusicians.map((musician) => (\r\n            <div\r\n              key={musician.id}\r\n              className=\"p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm hover:shadow-md transition-shadow\"\r\n            >\r\n              <div className=\"flex items-start justify-between mb-3\">\r\n                <h3 className=\"font-semibold text-lg\">{musician.name}</h3>\r\n                {musician.verified && (\r\n                  <span className=\"bg-green-100 text-green-700 text-xs px-2 py-1 rounded\">â Verificato</span>\r\n                )}\r\n              </div>\r\n              <div className=\"text-sm text-gray-600 space-y-1 mb-3\">\r\n                <div>ð {musician.city}, {musician.province} ({musician.region})</div>\r\n                {musician.phone && <div>ð {musician.phone}</div>}\r\n                {musician.email && <div>ð§ {musician.email}</div>}\r\n                {musician.website && (\r\n                  <div>\r\n                    ð <a href={musician.website} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-[#A3B59D] hover:underline\">\r\n                      {musician.website}\r\n                    </a>\r\n                  </div>\r\n                )}\r\n                {musician.price_range && <div>ð° {musician.price_range}</div>}\r\n                {musician.music_type && <div>ðµ {musician.music_type}</div>}\r\n              </div>\r\n              {musician.description && (\r\n                <p className=\"text-sm text-gray-700 mt-2\">{musician.description}</p>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\opengraph-image.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\pacchetti-fornitori\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3979,3982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3979,3982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState, Suspense } from \"react\";\nimport Link from \"next/link\";\nimport { getBrowserClient } from \"@/lib/supabaseBrowser\";\nimport { useSearchParams } from \"next/navigation\";\nimport { formatCurrency } from \"@/lib/locale\";\n\ntype Package = {\n  id: string;\n  tier: string;\n  name_it: string;\n  description_it: string;\n  price_monthly: number;\n  price_yearly: number;\n  features: string[];\n  display_order: number;\n};\n\nfunction PacchettiContent() {\n  const searchParams = useSearchParams();\n  const [packages, setPackages] = useState<Package[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [billingPeriod, setBillingPeriod] = useState<\"monthly\" | \"yearly\">(\"monthly\");\n  const [processingPayment, setProcessingPayment] = useState<string | null>(null);\n\n  useEffect(() => {\n    loadPackages();\n\n    const paymentStatus = searchParams.get(\"payment\");\n    if (paymentStatus === \"success\") {\n      alert(\"Pagamento completato con successo! Il tuo abbonamento Ã¨ ora attivo.\");\n    } else if (paymentStatus === \"cancelled\") {\n      alert(\"Pagamento annullato. Puoi riprovare quando vuoi.\");\n    }\n  }, [searchParams]);\n\n  async function loadPackages() {\n    try {\n      setLoading(true);\n      const res = await fetch(\"/api/subscription-packages\");\n      const data = await res.json();\n      setPackages(data.packages || []);\n    } catch (e) {\n      console.error(e);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  function getPrice(pkg: Package) {\n    const amount = billingPeriod === \"monthly\" ? pkg.price_monthly : pkg.price_yearly;\n    return formatCurrency(amount, \"EUR\", { minimumFractionDigits: 0, maximumFractionDigits: 0 });\n  }\n\n  function getTierColor(tier: string) {\n    switch (tier) {\n      case \"free\":\n        return \"border-gray-300 bg-gray-50\";\n      case \"base\":\n        return \"border-blue-300 bg-blue-50\";\n      case \"premium\":\n        return \"border-[#A3B59D] bg-green-50\";\n      case \"premium_plus\":\n        return \"border-amber-400 bg-amber-50\";\n      default:\n        return \"border-gray-300 bg-white\";\n    }\n  }\n\n  function getTierBadge(tier: string) {\n    switch (tier) {\n      case \"premium\":\n        return \"POPOLARE\";\n      case \"premium_plus\":\n        return \"BEST VALUE\";\n      default:\n        return null;\n    }\n  }\n\n  async function handlePurchase(pkg: Package) {\n    if (pkg.tier === \"free\") {\n      alert(\"Il piano gratuito Ã¨ sempre disponibile!\");\n      return;\n    }\n\n    setProcessingPayment(pkg.tier);\n\n    try {\n      // Verifica autenticazione\n      const { data: sessionData } = await getBrowserClient().auth.getSession();\n      const jwt = sessionData.session?.access_token;\n\n      if (!jwt) {\n        alert(\"Devi effettuare il login per acquistare un abbonamento.\");\n        window.location.href = \"/auth\";\n        return;\n      }\n\n      // Ottieni profilo fornitore\n      const headers: HeadersInit = { Authorization: `Bearer ${jwt}` };\n      const resProfile = await fetch(\"/api/my/supplier-profile\", { headers });\n      const dataProfile = await resProfile.json();\n\n      if (!dataProfile.profile) {\n        alert(\"Devi prima creare un profilo fornitore. Vai a /fornitori e proponi la tua attivitÃ .\");\n        return;\n      }\n\n      // Crea sessione Stripe Checkout\n      const resCheckout = await fetch(\"/api/stripe/checkout\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${jwt}`,\n        },\n        body: JSON.stringify({\n          tier: pkg.tier,\n          billing_period: billingPeriod,\n          supplier_id: dataProfile.profile.id,\n        }),\n      });\n\n      const dataCheckout = await resCheckout.json();\n\n      if (!resCheckout.ok) {\n        throw new Error(dataCheckout.error || \"Errore creazione checkout\");\n      }\n\n      if (dataCheckout.url) {\n        window.location.href = dataCheckout.url;\n      } else {\n        throw new Error(\"URL checkout non disponibile\");\n      }\n    } catch (e: any) {\n      console.error(\"Purchase error:\", e);\n      alert(`Errore: ${e.message}`);\n      setProcessingPayment(null);\n    }\n  }\n\n  return (\n    <section className=\"pt-6 pb-12\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Toggle fatturazione */}\n        <div className=\"flex items-center justify-center gap-3 mb-8\">\n          <button\n            onClick={() => setBillingPeriod(\"monthly\")}\n            className={`px-4 py-2 rounded-full border ${billingPeriod === \"monthly\" ? \"bg-[#A3B59D] text-white\" : \"bg-white\"}`}\n          >\n            Mensile\n          </button>\n          <button\n            onClick={() => setBillingPeriod(\"yearly\")}\n            className={`px-4 py-2 rounded-full border ${billingPeriod === \"yearly\" ? \"bg-[#A3B59D] text-white\" : \"bg-white\"}`}\n          >\n            Annuale\n          </button>\n        </div>\n\n        {loading ? (\n          <div className=\"text-center\">Caricamento...</div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            {packages.sort((a, b) => a.display_order - b.display_order).map((pkg) => (\n              <div key={pkg.id} className={`p-6 rounded-xl border ${getTierColor(pkg.tier)}`}>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <h3 className=\"text-xl font-serif font-bold\">{pkg.name_it}</h3>\n                  {getTierBadge(pkg.tier) && (\n                    <span className=\"text-xs px-2 py-1 rounded-full border bg-white\">{getTierBadge(pkg.tier)}</span>\n                  )}\n                </div>\n                <p className=\"text-gray-600 text-sm mb-4\">{pkg.description_it}</p>\n                <div className=\"text-3xl font-bold mb-4\">{getPrice(pkg)}</div>\n                <ul className=\"text-sm text-gray-700 space-y-1 mb-4\">\n                  {pkg.features?.map((f, i) => (\n                    <li key={i}>â¢ {f}</li>\n                  ))}\n                </ul>\n                <button\n                  disabled={processingPayment === pkg.tier}\n                  onClick={() => handlePurchase(pkg)}\n                  className=\"w-full px-4 py-2 rounded-lg border bg-white hover:bg-gray-50\"\n                >\n                  {processingPayment === pkg.tier ? \"Elaborazione...\" : \"Acquista\"}\n                </button>\n              </div>\n            ))}\n          </div>\n        )}\n\n        <div className=\"mt-12 text-center text-sm text-gray-500\">\n          <Link href=\"/fornitori\">Scopri come funziona</Link>\n        </div>\n      </div>\n    </section>\n  );\n}\n\nexport default function PacchettiFornitoriPage() {\n  return (\n    <Suspense fallback={<div className=\"pt-6 text-center\">Caricamento...</div>}>\n      <PacchettiContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\pensione\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\preferiti\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\privacy-policy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\responsive-showcase\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\ricevimento\\location\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\ricevimento\\location\\page.tsx:31:21\n  29 | function useRegionOptions() {\n  30 |   const [country, setCountry] = useState<string>(\"it\");\n> 31 |   useEffect(() => { setCountry(getUserCountrySafe()); }, []);\n     |                     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  32 |   const regions = (GEO[country]?.regions || GEO.it.regions).map(r => r.name);\n  33 |   return { country, regions };\n  34 | }","line":31,"column":21,"nodeType":null,"endLine":31,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadLocations'. Either include it or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [selectedRegion, selectedProvince, selectedType, loadLocations]","fix":{"range":[1980,2028],"text":"[selectedRegion, selectedProvince, selectedType, loadLocations]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3979,3982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3979,3982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport clsx from \"clsx\";\r\nimport ImageCarousel from \"@/components/ImageCarousel\";\nimport { getPageImages } from \"@/lib/pageImages\";\nimport { GEO, getUserCountrySafe } from \"@/constants/geo\";\nimport { useProvinceList } from \"@/lib/geoClient\";\nimport { getProvinceLabel, getRegionLabel } from \"@/lib/geoLabels\";\n\r\ntype Location = {\r\n  id: string;\r\n  name: string;\r\n  region: string;\r\n  province: string;\r\n  city: string;\r\n  address?: string;\r\n  phone?: string;\r\n  email?: string;\r\n  website?: string;\r\n  description?: string;\r\n  price_range?: string;\r\n  capacity_min?: number;\r\n  capacity_max?: number;\r\n  location_type?: string;\r\n  verified: boolean;\r\n};\r\n\r\nfunction useRegionOptions() {\n  const [country, setCountry] = useState<string>(\"it\");\n  useEffect(() => { setCountry(getUserCountrySafe()); }, []);\n  const regions = (GEO[country]?.regions || GEO.it.regions).map(r => r.name);\n  return { country, regions };\n}\n\r\nconst LOCATION_TYPES = [\r\n  \"Villa\",\r\n  \"Castello\",\r\n  \"Agriturismo\",\r\n  \"Masseria\",\r\n  \"Ristorante\",\r\n  \"Hotel\",\r\n  \"Resort\",\r\n  \"Tenuta\",\r\n  \"Giardino\",\r\n  \"Spiaggia\",\r\n  \"Altro\"\r\n];\r\n\r\nexport default function LocationRicevimentoPage() {\r\n  const [locations, setLocations] = useState<Location[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedRegion, setSelectedRegion] = useState(\"\");\r\n  const [selectedProvince, setSelectedProvince] = useState(\"\");\r\n  const [selectedType, setSelectedType] = useState(\"\");\r\n  const [showAddForm, setShowAddForm] = useState(false);\n  const { country, regions } = useRegionOptions();\n  \r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    region: \"\",\r\n    province: \"\",\r\n    city: \"\",\r\n    address: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    website: \"\",\r\n    description: \"\",\r\n    price_range: \"\",\r\n    capacity_min: \"\",\r\n    capacity_max: \"\",\r\n    location_type: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadLocations();\r\n  }, [selectedRegion, selectedProvince, selectedType]);\r\n\r\n  async function loadLocations() {\r\n    try {\r\n      setLoading(true);\r\n      const params = new URLSearchParams();\r\n      if (selectedRegion) params.append(\"region\", selectedRegion);\r\n      if (selectedProvince) params.append(\"province\", selectedProvince);\n      if (selectedType) params.append(\"type\", selectedType);\n      try { if (country) params.append(\"country\", country); } catch {}\n\n      const res = await fetch(`/api/locations?${params.toString()}`);\n      const data = await res.json();\r\n      setLocations(data.locations || []);\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    \r\n    const jwt = localStorage.getItem(\"sb_jwt\");\r\n    if (!jwt) {\r\n      alert(\"Devi essere autenticato per aggiungere una location\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(\"/api/locations\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${jwt}`,\n        },\n        body: JSON.stringify({\n          ...formData,\n          country,\n          capacity_min: formData.capacity_min ? parseInt(formData.capacity_min) : null,\n          capacity_max: formData.capacity_max ? parseInt(formData.capacity_max) : null,\n        }),\n      });\n\r\n      if (!res.ok) {\r\n        throw new Error(\"Errore durante l'aggiunta\");\r\n      }\r\n\r\n      alert(\"Location aggiunta con successo! SarÃ  visibile dopo la verifica dello staff.\");\r\n      setShowAddForm(false);\r\n      setFormData({\r\n        name: \"\",\r\n        region: \"\",\r\n        province: \"\",\r\n        city: \"\",\r\n        address: \"\",\r\n        phone: \"\",\r\n        email: \"\",\r\n        website: \"\",\r\n        description: \"\",\r\n        price_range: \"\",\r\n        capacity_min: \"\",\r\n        capacity_max: \"\",\r\n        location_type: \"\",\r\n      });\r\n      loadLocations();\r\n    } catch (e: any) {\r\n      alert(e.message || \"Errore durante l'aggiunta\");\r\n    }\r\n  }\r\n\r\n  const { provinces } = useProvinceList(country, selectedRegion, () =>\n    Array.from(new Set(locations.filter(l => l.region === selectedRegion).map(l => l.province))).sort()\n  );\n\r\n  const filteredLocations = locations;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-[#A3B59D] via-white to-[#A3B59D] p-8\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Carosello immagini */}\r\n        <ImageCarousel images={getPageImages(\"location\", country)} height=\"280px\" />\n        \r\n        <div className=\"flex justify-between items-center mb-8\">\r\n          <h1 className=\"text-4xl font-bold text-gray-800\">Ricevimento Â· Location</h1>\r\n          <button\r\n            onClick={() => setShowAddForm(!showAddForm)}\r\n            className=\"px-6 py-3 bg-[#A3B59D] text-white rounded-lg hover:bg-[#8fa085] transition-colors font-semibold\"\r\n          >\r\n            {showAddForm ? \"Annulla\" : \"+ Aggiungi Location\"}\r\n          </button>\r\n        </div>\r\n\r\n        {showAddForm && (\r\n          <div className=\"bg-white rounded-lg shadow-lg p-6 mb-8\">\r\n            <h2 className=\"text-2xl font-bold mb-4\">Aggiungi Nuova Location</h2>\r\n            <form onSubmit={handleSubmit} className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Nome *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Tipo Location *</label>\r\n                <select\r\n                  required\r\n                  value={formData.location_type}\r\n                  onChange={(e) => setFormData({ ...formData, location_type: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                >\r\n                  <option value=\"\">Seleziona...</option>\r\n                  {LOCATION_TYPES.map(t => (\r\n                    <option key={t} value={t.toLowerCase()}>{t}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">{getRegionLabel(country)} *</label>\n                <select\r\n                  required\r\n                  value={formData.region}\r\n                  onChange={(e) => setFormData({ ...formData, region: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                >\r\n                  <option value=\"\">Seleziona...</option>\r\n                  {regions.map(r => (\r\n                    <option key={r} value={r}>{r}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div>\n                <label className=\"block text-sm font-semibold mb-1\">{getProvinceLabel(country)} *</label>\n                {provinces.length ? (\n                  <select\n                    required\n                    value={formData.province}\n                    onChange={(e) => setFormData({ ...formData, province: e.target.value })}\n                    className=\"w-full border rounded px-3 py-2\"\n                  >\n                    <option value=\"\">Seleziona...</option>\n                    {provinces.map((p) => (\n                      <option key={p} value={p}>{p}</option>\n                    ))}\n                  </select>\n                ) : (\n                  <input\n                    type=\"text\"\n                    required\n                    placeholder=\"es. Roma, Milano, Napoli\"\n                    value={formData.province}\n                    onChange={(e) => setFormData({ ...formData, province: e.target.value })}\n                    className=\"w-full border rounded px-3 py-2\"\n                  />\n                )}\n              </div>\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">CittÃ  *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.city}\r\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Indirizzo</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.address}\r\n                  onChange={(e) => setFormData({ ...formData, address: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Telefono</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  value={formData.phone}\r\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Email</label>\r\n                <input\r\n                  type=\"email\"\r\n                  value={formData.email}\r\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Sito Web</label>\r\n                <input\r\n                  type=\"url\"\r\n                  value={formData.website}\r\n                  onChange={(e) => setFormData({ ...formData, website: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Fascia di Prezzo</label>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"es. â¬â¬â¬, 50-100â¬ a persona\"\r\n                  value={formData.price_range}\r\n                  onChange={(e) => setFormData({ ...formData, price_range: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">CapacitÃ  Minima (persone)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  value={formData.capacity_min}\r\n                  onChange={(e) => setFormData({ ...formData, capacity_min: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">CapacitÃ  Massima (persone)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  value={formData.capacity_max}\r\n                  onChange={(e) => setFormData({ ...formData, capacity_max: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"col-span-2\">\r\n                <label className=\"block text-sm font-semibold mb-1\">Descrizione</label>\r\n                <textarea\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                  className=\"w-full border rounded px-3 py-2 h-24\"\r\n                  placeholder=\"Descrivi la location, i servizi offerti, particolaritÃ ...\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"col-span-2\">\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"w-full bg-[#A3B59D] text-white py-3 rounded-lg hover:bg-[#8fa085] font-semibold\"\r\n                >\r\n                  Aggiungi Location\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        )}\r\n\r\n        {/* Filtri */}\r\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-8\">\r\n          <h2 className=\"text-xl font-bold mb-4\">Filtri</h2>\r\n          <div className=\"grid grid-cols-3 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-semibold mb-2\">{getRegionLabel(country)}</label>\n              <select\r\n                value={selectedRegion}\r\n                onChange={(e) => {\r\n                  setSelectedRegion(e.target.value);\r\n                  setSelectedProvince(\"\");\r\n                }}\r\n                className=\"w-full border rounded px-3 py-2\"\r\n              >\r\n                <option value=\"\">Tutte</option>\r\n                {regions.map(r => (\r\n                  <option key={r} value={r}>{r}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-semibold mb-2\">{getProvinceLabel(country)}</label>\n              <select\r\n                value={selectedProvince}\r\n                onChange={(e) => setSelectedProvince(e.target.value)}\r\n                disabled={!selectedRegion}\r\n                className=\"w-full border rounded px-3 py-2 disabled:bg-gray-100\"\r\n              >\r\n                <option value=\"\">Tutte</option>\r\n                {provinces.map(p => (\r\n                  <option key={p} value={p}>{p}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-semibold mb-2\">Tipo Location</label>\r\n              <select\r\n                value={selectedType}\r\n                onChange={(e) => setSelectedType(e.target.value)}\r\n                className=\"w-full border rounded px-3 py-2\"\r\n              >\r\n                <option value=\"\">Tutti</option>\r\n                {LOCATION_TYPES.map(t => (\r\n                  <option key={t} value={t.toLowerCase()}>{t}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Lista Location */}\r\n        {loading ? (\r\n          <div className=\"text-center py-12\">Caricamento...</div>\r\n        ) : filteredLocations.length === 0 ? (\r\n          <div className=\"text-center py-12 text-gray-500\">\r\n            Nessuna location trovata. Prova a cambiare i filtri o aggiungi la prima!\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            {filteredLocations.map((location) => (\r\n              <div\r\n                key={location.id}\r\n                className={clsx(\r\n                  \"bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow\",\r\n                  location.verified && \"border-2 border-green-500\"\r\n                )}\r\n              >\r\n                <div className=\"flex justify-between items-start mb-3\">\r\n                  <h3 className=\"text-xl font-bold text-gray-800\">{location.name}</h3>\r\n                  {location.verified && (\r\n                    <span className=\"bg-green-500 text-white text-xs px-2 py-1 rounded\">\r\n                      Verificato\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n                {location.location_type && (\r\n                  <p className=\"text-sm text-gray-600 mb-2\">\r\n                    <span className=\"font-semibold\">Tipo:</span> {location.location_type.charAt(0).toUpperCase() + location.location_type.slice(1)}\r\n                  </p>\r\n                )}\r\n\r\n                <p className=\"text-sm text-gray-600 mb-2\">\r\n                  <span className=\"font-semibold\">ð</span> {location.city}, {location.province} ({location.region})\r\n                </p>\r\n\r\n                {location.address && (\r\n                  <p className=\"text-sm text-gray-600 mb-2\">{location.address}</p>\r\n                )}\r\n\r\n                {(location.capacity_min || location.capacity_max) && (\r\n                  <p className=\"text-sm text-gray-600 mb-2\">\r\n                    <span className=\"font-semibold\">ð¥ CapacitÃ :</span>{\" \"}\r\n                    {location.capacity_min && location.capacity_max\r\n                      ? `${location.capacity_min}-${location.capacity_max} persone`\r\n                      : location.capacity_min\r\n                      ? `da ${location.capacity_min} persone`\r\n                      : `fino a ${location.capacity_max} persone`}\r\n                  </p>\r\n                )}\r\n\r\n                {location.price_range && (\r\n                  <p className=\"text-sm text-gray-600 mb-2\">\r\n                    <span className=\"font-semibold\">ð°</span> {location.price_range}\r\n                  </p>\r\n                )}\r\n\r\n                {location.description && (\r\n                  <p className=\"text-sm text-gray-700 mb-3 italic\">{location.description}</p>\r\n                )}\r\n\r\n                <div className=\"border-t pt-3 space-y-1\">\r\n                  {location.phone && (\r\n                    <p className=\"text-sm\">\r\n                      <span className=\"font-semibold\">ð</span>{\" \"}\r\n                      <a href={`tel:${location.phone}`} className=\"text-blue-600 hover:underline\">\r\n                        {location.phone}\r\n                      </a>\r\n                    </p>\r\n                  )}\r\n                  {location.email && (\r\n                    <p className=\"text-sm\">\r\n                      <span className=\"font-semibold\">âï¸</span>{\" \"}\r\n                      <a href={`mailto:${location.email}`} className=\"text-blue-600 hover:underline\">\r\n                        {location.email}\r\n                      </a>\r\n                    </p>\r\n                  )}\r\n                  {location.website && (\r\n                    <p className=\"text-sm\">\r\n                      <span className=\"font-semibold\">ð</span>{\" \"}\r\n                      <a\r\n                        href={location.website}\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"text-blue-600 hover:underline\"\r\n                      >\r\n                        Sito Web\r\n                      </a>\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\robots.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\save-the-date\\RemotionRoot.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[394,397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[394,397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\nimport { Composition } from 'remotion';\nimport { Player } from '@remotion/player';\nimport React from 'react';\nimport SaveTheDateVideo, { SaveTheDateVideoProps } from './SaveTheDateVideo';\n\n// Remotion root used by the Remotion renderer/CLI\n// Ensure TS sees the component as a compatible type for Remotion (React 19 vs Remotion v4 typings)\ntype AnyComponent = React.ComponentType<any>;\n \nconst VideoComponent = SaveTheDateVideo as unknown as AnyComponent;\n\nconst DEFAULT_PROPS: SaveTheDateVideoProps = {\n  names: 'Nome Sposi',\n  date: '28 Ottobre 2025',\n  location: 'Location Evento',\n  lang: 'it',\n};\n\nexport const RemotionRoot: React.FC = () => (\n  <Composition\n    id=\"SaveTheDateVideo\"\n    component={VideoComponent}\n    durationInFrames={180}\n    fps={30}\n    width={1280}\n    height={720}\n    defaultProps={DEFAULT_PROPS}\n  />\n);\n\n// Default export: Next.js preview using Remotion Player (provides composition context)\nconst RemotionPreview: React.FC<SaveTheDateVideoProps> = (props) => (\n  <Player\n    component={VideoComponent}\n    inputProps={props}\n    durationInFrames={180}\n    fps={30}\n    compositionWidth={1280}\n    compositionHeight={720}\n    controls\n    loop\n  />\n);\n\nexport default RemotionPreview;\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\save-the-date\\SaveTheDateVideo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\save-the-date\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SaveTheDateVideo' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":53,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport ImageCarousel from \"@/components/ImageCarousel\";\nimport { getUserCountrySafe } from \"@/constants/geo\";\nimport { getPageImages } from \"@/lib/pageImages\";\nimport SaveTheDateVideoPreview from \"@/components/SaveTheDateVideoPreview\";\nimport { SaveTheDateVideo } from \"@/components/SaveTheDateVideo\";\n\ninterface WeddingCardConfig {\n  bride_name: string;\n  groom_name: string;\n  wedding_date: string;\n  church_name: string;\n  church_address: string;\n  location_name: string;\n  location_address: string;\n  iban: string;\n  bank_name: string;\n  ceremony_time: string;\n  reception_time: string;\n  font_family: string;\n  color_scheme: string;\n  template_style: string;\n  custom_message: string;\n}\n\nconst fontOptions = [\n  { value: \"Playfair Display\", label: \"Playfair Display (Elegante)\" },\n  { value: \"Great Vibes\", label: \"Great Vibes (Corsivo)\" },\n  { value: \"Cormorant Garamond\", label: \"Cormorant Garamond (Classico)\" },\n  { value: \"Dancing Script\", label: \"Dancing Script (Romantico)\" },\n  { value: \"Cinzel\", label: \"Cinzel (Formale)\" },\n  { value: \"Italiana\", label: \"Italiana (Moderno)\" },\n];\n\nconst colorSchemes = [\n  { value: \"classic\", label: \"Classico (Oro e Avorio)\" },\n  { value: \"modern\", label: \"Moderno (Nero e Bianco)\" },\n  { value: \"rustic\", label: \"Rustico (Verde Salvia)\" },\n  { value: \"romantic\", label: \"Romantico (Rosa e Pesca)\" },\n  { value: \"luxury\", label: \"Luxury (Blu Navy e Oro)\" },\n];\n\nconst templateStyles = [\n  { value: \"elegant\", label: \"Elegante\" },\n  { value: \"minimal\", label: \"Minimalista\" },\n  { value: \"floral\", label: \"Floreale\" },\n  { value: \"vintage\", label: \"Vintage\" },\n];\n\nexport default function PartecipazionePage() {\n  const router = useRouter();\n  const country = getUserCountrySafe();\n  const [loading, setLoading] = useState(false);\n  const [generating, setGenerating] = useState(false);\n  const [config, setConfig] = useState<WeddingCardConfig>({\n    bride_name: \"\",\n    groom_name: \"\",\n    wedding_date: \"\",\n    church_name: \"\",\n    church_address: \"\",\n    location_name: \"\",\n    location_address: \"\",\n    iban: \"\",\n    bank_name: \"\",\n    ceremony_time: \"\",\n    reception_time: \"\",\n    font_family: \"Playfair Display\",\n    color_scheme: \"classic\",\n    template_style: \"elegant\",\n    custom_message: \"\",\n  });\n\n  useEffect(() => {\n    loadConfig();\n  }, []);\n\n  async function loadConfig() {\n    setLoading(true);\n    try {\n      const res = await fetch(\"/api/wedding-card\");\n      if (res.ok) {\n        const data = await res.json();\n        if (data.config) setConfig(data.config);\n      }\n    } catch (e) {\n      console.error(\"Errore caricamento configurazione:\", e);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleSave() {\n    setLoading(true);\n    try {\n      const res = await fetch(\"/api/wedding-card\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(config),\n      });\n      if (res.ok) alert(\"Configurazione salvata con successo!\");\n      else alert(\"Errore nel salvataggio\");\n    } catch (e) {\n      console.error(\"Errore salvataggio:\", e);\n      alert(\"Errore nel salvataggio\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleGeneratePDF() {\n    setGenerating(true);\n    try {\n      const res = await fetch(\"/api/generate-wedding-pdf\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(config),\n      });\n      if (res.ok) {\n        const blob = await res.blob();\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = `partecipazione-${config.bride_name}-${config.groom_name}.pdf`;\n        document.body.appendChild(a);\n        a.click();\n        window.URL.revokeObjectURL(url);\n        document.body.removeChild(a);\n      } else {\n        alert(\"Errore nella generazione del PDF\");\n      }\n    } catch (e) {\n      console.error(\"Errore generazione PDF:\", e);\n      alert(\"Errore nella generazione del PDF\");\n    } finally {\n      setGenerating(false);\n    }\n  }\n\n  async function handleGenerateVideo() {\n    setGenerating(true);\n    try {\n      alert(\n        \"Funzione video in sviluppo: sarÃ  possibile scaricare un video Save the Date personalizzato!\",\n      );\n    } finally {\n      setGenerating(false);\n    }\n  }\n\n  const videoProps = {\n    bride: config.bride_name,\n    groom: config.groom_name,\n    date: config.wedding_date,\n    location: config.location_name,\n    message: config.custom_message,\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8\">\n        <h1 className=\"text-3xl font-bold mb-6 text-[#A3B59D]\">ð£ Crea il tuo Save the Date</h1>\n\n        <ImageCarousel images={getPageImages(\"save-the-date\", country)} height=\"280px\" />\n\n        <div className=\"space-y-6\">\n          {/* Informazioni Sposi */}\n          <div className=\"border-b pb-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">ð°ð¤µ Informazioni Sposi</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Nome Sposa</label>\n                <input\n                  type=\"text\"\n                  value={config.bride_name}\n                  onChange={(e) => setConfig({ ...config, bride_name: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                  placeholder=\"Maria\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Nome Sposo</label>\n                <input\n                  type=\"text\"\n                  value={config.groom_name}\n                  onChange={(e) => setConfig({ ...config, groom_name: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                  placeholder=\"Giovanni\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Data Matrimonio</label>\n                <input\n                  type=\"date\"\n                  value={config.wedding_date}\n                  onChange={(e) => setConfig({ ...config, wedding_date: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Cerimonia */}\n          <div className=\"border-b pb-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">âª Cerimonia</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Nome Chiesa</label>\n                <input\n                  type=\"text\"\n                  value={config.church_name}\n                  onChange={(e) => setConfig({ ...config, church_name: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                  placeholder=\"Chiesa di Santa Maria\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Indirizzo Chiesa</label>\n                <input\n                  type=\"text\"\n                  value={config.church_address}\n                  onChange={(e) => setConfig({ ...config, church_address: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                  placeholder=\"Via Roma, 1 - Milano\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Orario Cerimonia</label>\n                <input\n                  type=\"time\"\n                  value={config.ceremony_time}\n                  onChange={(e) => setConfig({ ...config, ceremony_time: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Location / Ricevimento */}\n          <div className=\"border-b pb-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">ðï¸ Location / Ricevimento</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Nome Location</label>\n                <input\n                  type=\"text\"\n                  value={config.location_name}\n                  onChange={(e) => setConfig({ ...config, location_name: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                  placeholder=\"Villa delle Rose\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Indirizzo Location</label>\n                <input\n                  type=\"text\"\n                  value={config.location_address}\n                  onChange={(e) => setConfig({ ...config, location_address: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                  placeholder=\"Via delle Magnolie, 10 - Roma\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Orario Ricevimento</label>\n                <input\n                  type=\"time\"\n                  value={config.reception_time}\n                  onChange={(e) => setConfig({ ...config, reception_time: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Bonifico (Opzionale) */}\n          <div className=\"border-b pb-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">ð³ Informazioni Bonifico (Facoltativo)</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">IBAN</label>\n                <input\n                  type=\"text\"\n                  value={config.iban}\n                  onChange={(e) => setConfig({ ...config, iban: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                  placeholder=\"IT60 X054 2811 1010 0000 0123 456\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Banca</label>\n                <input\n                  type=\"text\"\n                  value={config.bank_name}\n                  onChange={(e) => setConfig({ ...config, bank_name: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                  placeholder=\"Intesa Sanpaolo\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Design */}\n          <div className=\"border-b pb-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">ð¨ Personalizzazione</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Font Nomi</label>\n                <select\n                  value={config.font_family}\n                  onChange={(e) => setConfig({ ...config, font_family: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                >\n                  {fontOptions.map((f) => (\n                    <option key={f.value} value={f.value}>\n                      {f.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Schema Colori</label>\n                <select\n                  value={config.color_scheme}\n                  onChange={(e) => setConfig({ ...config, color_scheme: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                >\n                  {colorSchemes.map((c) => (\n                    <option key={c.value} value={c.value}>\n                      {c.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Stile Template</label>\n                <select\n                  value={config.template_style}\n                  onChange={(e) => setConfig({ ...config, template_style: e.target.value })}\n                  className=\"w-full border rounded px-3 py-2\"\n                >\n                  {templateStyles.map((t) => (\n                    <option key={t.value} value={t.value}>\n                      {t.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n          </div>\n\n          {/* Messaggio Personalizzato */}\n          <div>\n            <h2 className=\"text-xl font-semibold mb-4\">ð Messaggio Personalizzato</h2>\n            <textarea\n              value={config.custom_message}\n              onChange={(e) => setConfig({ ...config, custom_message: e.target.value })}\n              className=\"w-full border rounded px-3 py-2 h-24\"\n              placeholder=\"Saremo felici di condividere con voi il giorno piÃ¹ importante della nostra vita...\"\n            />\n          </div>\n\n          {/* Azioni */}\n          <div className=\"flex gap-4 pt-6\">\n            <button\n              onClick={handleSave}\n              disabled={loading}\n              className=\"flex-1 bg-[#A3B59D] text-white py-3 px-6 rounded font-semibold hover:bg-[#8da182] disabled:opacity-50\"\n            >\n              {loading ? \"Salvataggio...\" : \"ð¾ Salva Configurazione\"}\n            </button>\n            <button\n              onClick={handleGeneratePDF}\n              disabled={generating || !config.bride_name || !config.groom_name}\n              className=\"flex-1 bg-blue-600 text-white py-3 px-6 rounded font-semibold hover:bg-blue-700 disabled:opacity-50\"\n            >\n              {generating ? \"Generazione...\" : \"ð Genera PDF\"}\n            </button>\n            <button\n              onClick={handleGenerateVideo}\n              disabled={generating || !config.bride_name || !config.groom_name}\n              className=\"flex-1 bg-pink-600 text-white py-3 px-6 rounded font-semibold hover:bg-pink-700 disabled:opacity-50\"\n            >\n              {generating ? \"Generazione...\" : \"ð¬ Genera Video\"}\n            </button>\n          </div>\n\n          {/* Preview Video Save the Date */}\n          <div className=\"mt-10\">\n            <h2 className=\"text-xl font-semibold mb-4 text-[#A3B59D]\">Anteprima Video Save the Date</h2>\n            <SaveTheDateVideoPreview {...videoProps} />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\select-country\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\select-event-type\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\select-event\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\select-language\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'router'. Either include it or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [router]","fix":{"range":[716,718],"text":"[router]"}}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: This value cannot be modified\n\nModifying a variable defined outside a component or hook is not allowed. Consider using an effect.\n\nC:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\select-language\\page.tsx:27:5\n  25 |     setSelected(code);\n  26 |     localStorage.setItem(\"language\", code);\n> 27 |     document.cookie = `language=${code}; Path=/; Max-Age=15552000; SameSite=Lax`;\n     |     ^^^^^^^^ value cannot be modified\n  28 |     router.push(\"/select-country\");\n  29 |   }\n  30 |","line":27,"column":5,"nodeType":null,"endLine":27,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { useRouter } from \"next/navigation\";\nimport { LANGS } from \"@/lib/loadConfigs\";\n\nexport default function SelectLanguagePage() {\n  const t = useTranslations();\n  const router = useRouter();\n  useEffect(() => {\n    try {\n      const cookieLang = document.cookie.match(/(?:^|; )language=([^;]+)/)?.[1];\n      const lsLang = localStorage.getItem(\"language\");\n      if (cookieLang || lsLang) {\n        if (!cookieLang && lsLang) {\n          document.cookie = `language=${lsLang}; Path=/; Max-Age=15552000; SameSite=Lax`;\n        }\n        router.replace(\"/select-country\");\n      }\n    } catch {}\n  }, []);\n  const [selected, setSelected] = useState<string>(\"\");\n\n  function handleSelect(code: string) {\n    setSelected(code);\n    localStorage.setItem(\"language\", code);\n    document.cookie = `language=${code}; Path=/; Max-Age=15552000; SameSite=Lax`;\n    router.push(\"/select-country\");\n  }\n\n  return (\n    <main\n      className=\"min-h-screen flex items-center justify-center\"\n      style={{\n        background:\n          \"radial-gradient(1200px 600px at 10% 10%, rgba(163,181,157,0.25), transparent),\" +\n          \"radial-gradient(900px 500px at 90% 20%, rgba(230,242,224,0.5), transparent),\" +\n          \"linear-gradient(180deg, #f7faf7, #eef5ee)\",\n        backgroundImage: \"url(/backgrounds/select-language.svg)\",\n        backgroundRepeat: \"no-repeat\",\n        backgroundSize: \"cover\",\n      }}\n    >\n      <div className=\"max-w-xl w-full mx-4 p-8 rounded-3xl bg-white/80 backdrop-blur border border-gray-200 shadow-xl\">\n        <h1 className=\"text-3xl font-serif font-bold text-center mb-6\">\n          <span aria-hidden=\"true\" className=\"mr-2\">ð</span>\n          {t(\"onboarding.selectLanguageTitle\", { fallback: \"Scegli la lingua\" })}\n        </h1>\n        <p className=\"text-center text-gray-600 mb-6\">\n          {t(\"onboarding.selectLanguageDesc\", { fallback: \"Seleziona la lingua che preferisci per continuare\" })}\n        </p>\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n          {LANGS.map((lang) => (\n            <button\n              key={lang.slug}\n              className={`px-6 py-4 rounded-xl font-semibold text-base shadow-sm border-2 border-[#A3B59D] bg-white hover:bg-[#A3B59D] hover:text-white transition-all ${selected === lang.slug ? \"bg-[#A3B59D] text-white\" : \"\"}`}\n              onClick={() => handleSelect(lang.slug)}\n              aria-label={lang.label || lang.slug.toUpperCase()}\n            >\n              <span aria-hidden=\"true\" className=\"mr-2 text-lg\">\n                {lang.emoji || \"ð\"}\n              </span>\n              {lang.label || lang.slug.toUpperCase()}\n            </button>\n          ))}\n        </div>\n      </div>\n    </main>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\sitemap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\spese\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":517,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":517,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16211,16214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16211,16214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport ImageCarousel from \"@/components/ImageCarousel\";\nimport PageInfoNote from \"@/components/PageInfoNote\";\nimport { useToast } from \"@/components/ToastProvider\";\nimport { getUserCountrySafe } from \"@/constants/geo\";\nimport { formatCurrency, formatDate } from \"@/lib/locale\";\nimport { getPageImages } from \"@/lib/pageImages\";\nimport { getBrowserClient } from \"@/lib/supabaseBrowser\";\nimport { useTranslations } from \"next-intl\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst supabase = getBrowserClient();\r\n\r\ntype Expense = {\r\n  id?: string;\r\n  category: string;\r\n  subcategory: string;\r\n  supplier: string;\r\n  description: string;\r\n  amount: number;\r\n  spendType: \"common\" | \"bride\" | \"groom\";\r\n  status: \"pending\" | \"approved\" | \"rejected\";\r\n  date: string;\r\n  notes: string;\r\n  fromDashboard: boolean; // indica se era nel preventivo\r\n};\r\n\r\n// Stesse categorie della dashboard\r\nconst CATEGORIES_MAP: Record<string, string[]> = {\r\n  \"Abiti & Accessori (altri)\": [\r\n    \"Abiti ospiti / Genitori\",\r\n    \"Accessori damigelle\",\r\n    \"Accessori testimoni\",\r\n    \"Fedi nuziali\",\r\n    \"Anello fidanzamento\",\r\n    \"Accessori vari\",\r\n  ],\r\n  \"Cerimonia/Chiesa Location\": [\r\n    \"Chiesa / Comune\",\r\n    \"Musiche\",\r\n    \"Libretti Messa\",\r\n    \"Fiori cerimonia\",\r\n    \"Wedding bag\",\r\n    \"Ventagli\",\r\n    \"Pulizia chiesa\",\r\n    \"Cesto doni\",\r\n    \"Documenti e pratiche\",\r\n    \"Offerte / Diritti\",\r\n    \"Colombe uscita\",\r\n    \"Riso/Petali\",\r\n    \"Bottiglia per brindisi\",\r\n    \"Bicchieri per brindisi\",\r\n    \"Forfait cerimonia\",\r\n  ],\r\n  \"Fuochi d'artificio\": [\r\n    \"Fuochi d'artificio tradizionali\",\r\n    \"Fontane luminose\",\r\n    \"Spettacolo pirotecnico\",\r\n    \"Bengala per ospiti\",\r\n    \"Lancio palloncini luminosi\",\r\n    \"Forfait fuochi d'artificio\",\r\n  ],\r\n  \"Fiori & Decor\": [\r\n    \"Bouquet\",\r\n    \"BoutonniÃ¨re\",\r\n    \"Centrotavola\",\r\n    \"Allestimenti\",\r\n    \"Candele\",\r\n    \"Tableau\",\r\n    \"Segnaposto\",\r\n    \"Noleggi (vasi / strutture)\",\r\n    \"Forfait fioraio\",\r\n  ],\r\n  \"Foto & Video\": [\r\n    \"Servizio fotografico\",\r\n    \"Video\",\r\n    \"Drone\",\r\n    \"Album\",\r\n    \"Stampe\",\r\n    \"Secondo fotografo\",\r\n    \"Forfait fotografo\",\r\n  ],\r\n  \"Inviti & Stationery\": [\r\n    \"Partecipazioni\",\r\n    \"Menu\",\r\n    \"Segnaposto\",\r\n    \"Libretti Messa\",\r\n    \"Timbri / ClichÃ©\",\r\n    \"Francobolli / Spedizioni\",\r\n    \"Calligrafia\",\r\n    \"Cartoncini / Tag\",\r\n    \"QR Code / Stampa\",\r\n  ],\r\n  \"Sposa\": [\r\n    \"Abito sposa\",\r\n    \"Scarpe sposa\",\r\n    \"Accessori (velo, gioielli, ecc.)\",\r\n    \"Intimo / sottogonna\",\r\n    \"Parrucchiera\",\r\n    \"Make-up\",\r\n    \"Prove\",\r\n    \"e)\",\r\n    \"Altro sposa\",\r\n  ],\r\n  \"Sposo\": [\r\n    \"Abito sposo\",\r\n    \"Scarpe sposo\",\r\n    \"Accessori (cravatta, gemelli, ecc.)\",\r\n    \"Barbiere / Grooming\",\r\n    \"Prove\",\r\n    \"Altro sposo\",\r\n  ],\r\n  \"Ricevimento Location\": [\r\n    \"Affitto sala\",\r\n    \"Catering / Banqueting\",\r\n    \"Torta nuziale\",\r\n    \"Vini & Bevande\",\r\n    \"Open bar\",\r\n    \"Mise en place\",\r\n    \"Noleggio tovagliato / piatti\",\r\n    \"Forfait location\",\r\n    \"Forfait catering (prezzo a persona)\",\r\n  ],\r\n  \"Musica & Intrattenimento\": [\r\n    \"DJ / Band\",\r\n    \"Audio / Luci\",\r\n    \"Animazione\",\r\n    \"Diritti SIAE\",\r\n    \"Guestbook phone / Postazioni\",\r\n    \"Forfait musica & intrattenimento\",\r\n  ],\r\n  \"Musica Cerimonia\": [\r\n    \"Coro\",\r\n    \"Organo\",\r\n    \"Arpa\",\r\n    \"Violino\",\r\n    \"Violoncello\",\r\n    \"Gruppo strumenti\",\r\n    \"Forfait musica cerimonia\",\r\n  ],\r\n  \"Musica Ricevimento\": [\r\n    \"DJ\",\r\n    \"Band live\",\r\n    \"Orchestra\",\r\n    \"Duo acustico\",\r\n    \"Pianista\",\r\n    \"Forfait musica ricevimento\",\r\n  ],\r\n  \"Trasporti\": [\r\n    \"Auto sposi\",\r\n    \"Navette ospiti\",\r\n    \"Carburante / Pedaggi\",\r\n  ],\r\n  \"Bomboniere & Regali\": [\r\n    \"Bomboniere\",\r\n    \"Confetti\",\r\n    \"Packaging / Scatole\",\r\n    \"Allestimento tavolo bomboniere\",\r\n    \"Regalo testimoni\",\r\n    \"Regalo damigelle\",\r\n    \"Regalo pagetti\",\r\n    \"Realizzazione bomboniere\",\r\n  ],\r\n  \"OspitalitÃ  & Logistica\": [\r\n    \"Alloggi ospiti\",\r\n    \"Welcome bag / Kit\",\r\n    \"Cartellonistica / Segnaletica\",\r\n  ],\r\n  \"Burocrazia\": [\r\n    \"Pubblicazioni\",\r\n    \"Certificati\",\r\n    \"Traduzioni / Apostille\",\r\n  ],\r\n  \"Addio al Nubilato\": [\r\n    \"Location addio al nubilato\",\r\n    \"Ristorante / Cena\",\r\n    \"AttivitÃ  / Esperienze\",\r\n    \"Gadget / T-shirt\",\r\n    \"Decorazioni / Palloncini\",\r\n    \"Trasporti\",\r\n    \"Alloggio\",\r\n    \"Forfait addio al nubilato\",\r\n  ],\r\n  \"Addio al Celibato\": [\r\n    \"Location addio al celibato\",\r\n    \"Ristorante / Cena\",\r\n    \"AttivitÃ  / Esperienze\",\r\n    \"Gadget / T-shirt\",\r\n    \"Decorazioni / Palloncini\",\r\n    \"Trasporti\",\r\n    \"Alloggio\",\r\n    \"Forfait addio al celibato\",\r\n  ],\r\n  \"Beauty & Benessere\": [\r\n    \"Estetista\",\r\n    \"SPA / Massaggi\",\r\n    \"Solarium\",\r\n  ],\r\n  \"Viaggio di nozze\": [\r\n    \"Quota viaggio\",\r\n    \"Assicurazioni\",\r\n    \"Visti / Documenti\",\r\n    \"Passaporto\",\r\n    \"Extra\",\r\n    \"Lista nozze\",\r\n  ],\r\n  \"Wedding Planner\": [\r\n    \"Consulenza\",\r\n    \"Full planning\",\r\n    \"Partial planning\",\r\n    \"Coordinamento giorno del matrimonio\",\r\n    \"Forfait wedding planner\",\r\n  ],\r\n  \"Comunicazione & Media\": [\r\n    \"Sito web / QR\",\r\n    \"Social media\",\r\n    \"Grafica / Design\",\r\n  ],\r\n  \"Extra & Contingenze\": [\r\n    \"Imprevisti\",\r\n    \"Spese varie\",\r\n  ],\r\n};\r\n\r\nconst ALL_CATEGORIES = Object.keys(CATEGORIES_MAP);\r\n\r\nexport default function SpesePage() {\n  const t = useTranslations();\n  const userEventType = typeof window !== \"undefined\" ? (localStorage.getItem(\"eventType\") || \"wedding\") : \"wedding\";\n  const isBaptism = userEventType === \"baptism\";\n  const country = getUserCountrySafe();\n  const { showToast } = useToast();\n  const [expenses, setExpenses] = useState<Expense[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [message, setMessage] = useState<string | null>(null);\r\n  const [showForm, setShowForm] = useState(false);\r\n  \r\n  const [newExpense, setNewExpense] = useState<Expense>({\r\n    category: ALL_CATEGORIES[0],\r\n    subcategory: CATEGORIES_MAP[ALL_CATEGORIES[0]][0],\r\n    supplier: \"\",\r\n    description: \"\",\r\n    amount: 0,\r\n    spendType: \"common\",\r\n    status: \"pending\",\r\n    date: new Date().toISOString().split(\"T\")[0],\r\n    notes: \"\",\r\n    fromDashboard: false,\r\n  });\r\n\r\n  // For Battesimo force spend type to common\r\n  useEffect(() => {\r\n    if (isBaptism && newExpense.spendType !== \"common\") {\r\n      setNewExpense((prev) => ({ ...prev, spendType: \"common\" }));\r\n    }\r\n  }, [isBaptism, newExpense.spendType]);\r\n\r\n  // Carica le spese\r\n  useEffect(() => {\r\n    loadExpenses();\r\n  }, []);\r\n\r\n  const loadExpenses = async () => {\r\n    try {\r\n      const { data } = await supabase.auth.getSession();\r\n      const jwt = data.session?.access_token;\r\n\r\n      const headers: HeadersInit = {};\r\n      if (jwt) {\r\n        headers.Authorization = `Bearer ${jwt}`;\r\n      }\r\n\r\n      const r = await fetch(\"/api/my/expenses\", { headers });\r\n      const j = await r.json();\r\n\r\n      setExpenses(j.expenses || []);\r\n    } catch (err) {\r\n      console.error(\"Errore caricamento:\", err);\r\n      setExpenses([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const addExpense = async () => {\r\n    setSaving(true);\r\n    setMessage(null);\r\n    try {\r\n      const { data } = await supabase.auth.getSession();\r\n      const jwt = data.session?.access_token;\r\n\r\n      if (!jwt) {\r\n        setMessage(t(\"expensesPage.messages.mustAuthAdd\"));\r\n        setSaving(false);\r\n        return;\r\n      }\r\n\r\n      const r = await fetch(\"/api/my/expenses\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${jwt}`,\r\n        },\r\n        body: JSON.stringify(newExpense),\r\n      });\r\n\r\n      if (!r.ok) {\r\n        const j = await r.json();\r\n        showToast(`Errore: ${j.error || \"Impossibile salvare\"}`, \"error\");\r\n      } else {\r\n        showToast(t(\"expensesPage.messages.successAdded\"), \"success\");\r\n        setShowForm(false);\r\n        loadExpenses();\r\n        // Reset form\r\n        setNewExpense({\r\n          category: ALL_CATEGORIES[0],\r\n          subcategory: CATEGORIES_MAP[ALL_CATEGORIES[0]][0],\r\n          supplier: \"\",\r\n          description: \"\",\r\n          amount: 0,\r\n          spendType: \"common\",\r\n          status: \"pending\",\r\n          date: new Date().toISOString().split(\"T\")[0],\r\n          notes: \"\",\r\n          fromDashboard: false,\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Errore:\", err);\r\n      showToast(t(\"expensesPage.messages.networkError\"), \"error\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const updateExpenseStatus = async (id: string, status: \"approved\" | \"rejected\") => {\r\n    try {\r\n      const { data } = await supabase.auth.getSession();\r\n      const jwt = data.session?.access_token;\r\n\r\n      if (!jwt) {\r\n        setMessage(t(\"expensesPage.messages.mustAuthAdd\"));\r\n        return;\r\n      }\r\n\r\n      const r = await fetch(`/api/my/expenses/${id}`, {\r\n        method: \"PATCH\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${jwt}`,\r\n        },\r\n        body: JSON.stringify({ status }),\r\n      });\r\n\r\n      if (r.ok) {\r\n        setMessage(status === \"approved\" ? t(\"expensesPage.status.approved\") : t(\"expensesPage.status.rejected\"));\r\n        loadExpenses();\r\n        setTimeout(() => setMessage(null), 3000);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Errore:\", err);\r\n    }\r\n  };\r\n\r\n  const totalPending = expenses.filter(e => e.status === \"pending\").reduce((sum, e) => sum + e.amount, 0);\r\n  const totalApproved = expenses.filter(e => e.status === \"approved\").reduce((sum, e) => sum + e.amount, 0);\r\n\r\n  // Raggruppa le spese per categoria e sottocategoria\r\n  const groupedExpenses = expenses.reduce((acc, exp) => {\r\n    const key = `${exp.category}|${exp.subcategory}`;\r\n    if (!acc[key]) {\r\n      acc[key] = {\r\n        category: exp.category,\r\n        subcategory: exp.subcategory,\r\n        expenses: [],\r\n      };\r\n    }\r\n    acc[key].expenses.push(exp);\r\n    return acc;\r\n  }, {} as Record<string, { category: string; subcategory: string; expenses: Expense[] }>);\r\n\r\n  // Ordina i gruppi seguendo l'ordine delle categorie\r\n  const orderedGroups = Object.values(groupedExpenses).sort((a, b) => {\r\n    const catIndexA = ALL_CATEGORIES.indexOf(a.category);\r\n    const catIndexB = ALL_CATEGORIES.indexOf(b.category);\r\n    if (catIndexA !== catIndexB) return catIndexA - catIndexB;\r\n    \r\n    // Ordina sottocategorie all'interno della stessa categoria\r\n    const subsA = CATEGORIES_MAP[a.category] || [];\r\n    const subsB = CATEGORIES_MAP[b.category] || [];\r\n    return subsA.indexOf(a.subcategory) - subsB.indexOf(b.subcategory);\r\n  });\r\n\r\n  if (loading) {\r\n    return (\r\n      <section className=\"pt-6\">\r\n        <h2 className=\"font-serif text-3xl mb-6\">{t(\"expensesPage.title\")}</h2>\r\n        <p className=\"text-gray-500\">{t(\"expensesPage.loading\")}</p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <section className=\"pt-6\">\r\n  <h2 className=\"font-serif text-3xl mb-2\">ð¸ {t(\"expensesPage.title\")}</h2>\r\n      <p className=\"text-gray-600 mb-6 text-sm sm:text-base leading-relaxed\">{t(\"expensesPage.info.lead\")}</p>\r\n\r\n      <PageInfoNote\r\n        icon=\"ð°\"\r\n        title={t(\"expensesPage.info.title\")}\r\n        description={t(\"expensesPage.info.description\")}\r\n        tips={[\r\n          t(\"expensesPage.info.tips.tip1\"),\r\n          t(\"expensesPage.info.tips.tip2\"),\r\n          t(\"expensesPage.info.tips.tip3\"),\r\n          t(\"expensesPage.info.tips.tip4\"),\r\n        ]}\r\n        eventTypeSpecific={{\r\n          wedding: t(\"expensesPage.info.eventTypeSpecific.wedding\"),\r\n          baptism: t(\"expensesPage.info.eventTypeSpecific.baptism\"),\r\n          birthday: t(\"expensesPage.info.eventTypeSpecific.birthday\"),\r\n          graduation: t(\"expensesPage.info.eventTypeSpecific.graduation\"),\r\n        }}\r\n      />\r\n\r\n      {/* Carosello immagini */}\r\n      <ImageCarousel images={getPageImages(\"spese\", country)} height=\"280px\" />\n\r\n      {message && (\r\n        <div className=\"mb-4 p-4 rounded-lg bg-blue-50 border border-blue-200 text-sm\">\r\n          {message}\r\n        </div>\r\n      )}\r\n\r\n      {/* Riepilogo */}\r\n      <div className=\"mb-6 grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n        <div className=\"p-4 rounded-lg bg-yellow-50 border border-yellow-200\">\r\n          <div className=\"text-sm text-gray-600\">{t(\"expensesPage.summary.pending\")}</div>\r\n          <div className=\"text-2xl font-semibold\">{formatEuro(totalPending)}</div>\r\n        </div>\r\n        <div className=\"p-4 rounded-lg bg-green-50 border border-green-200\">\r\n          <div className=\"text-sm text-gray-600\">{t(\"expensesPage.summary.approved\")}</div>\r\n          <div className=\"text-2xl font-semibold\">{formatEuro(totalApproved)}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Bottone aggiungi */}\r\n      <div className=\"mb-6\">\r\n        <button\r\n          onClick={() => setShowForm(!showForm)}\r\n          className=\"bg-[#A3B59D] text-white rounded-lg px-4 py-2 hover:bg-[#8a9d84]\"\r\n        >\r\n          {showForm ? t(\"expensesPage.buttons.cancel\") : t(\"expensesPage.buttons.add\")}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Form nuova spesa */}\r\n      {showForm && (\r\n        <div className=\"mb-6 p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm\">\r\n          <h3 className=\"font-semibold mb-4\">{t(\"expensesPage.form.new\")}</h3>\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t(\"expensesPage.form.category\")}</label>\r\n              <select\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newExpense.category}\r\n                onChange={(e) => setNewExpense({\r\n                  ...newExpense,\r\n                  category: e.target.value,\r\n                  subcategory: CATEGORIES_MAP[e.target.value][0]\r\n                })}\r\n              >\r\n                {ALL_CATEGORIES.map((cat) => (\r\n                  <option key={cat} value={cat}>{cat}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t(\"expensesPage.form.subcategory\")}</label>\r\n              <select\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newExpense.subcategory}\r\n                onChange={(e) => setNewExpense({ ...newExpense, subcategory: e.target.value })}\r\n              >\r\n                {(CATEGORIES_MAP[newExpense.category] || []).map((sub) => (\r\n                  <option key={sub} value={sub}>{sub}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t(\"expensesPage.form.supplier\")}</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newExpense.supplier}\r\n                onChange={(e) => setNewExpense({ ...newExpense, supplier: e.target.value })}\r\n                placeholder={t(\"expensesPage.form.placeholders.supplier\")}\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t(\"expensesPage.form.amount\")}</label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newExpense.amount || \"\"}\r\n                onChange={(e) => setNewExpense({ ...newExpense, amount: Number(e.target.value) || 0 })}\r\n                placeholder={t(\"expensesPage.form.placeholders.amount\")}\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t(\"expensesPage.form.spendType\")}</label>\r\n              <select\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newExpense.spendType}\r\n                onChange={(e) => setNewExpense({ ...newExpense, spendType: e.target.value as any })}\r\n              >\r\n                <option value=\"common\">{t(\"expensesPage.form.spendTypeOptions.common\")}</option>\r\n                {!isBaptism && <option value=\"bride\">{t(\"expensesPage.form.spendTypeOptions.bride\")}</option>}\r\n                {!isBaptism && <option value=\"groom\">{t(\"expensesPage.form.spendTypeOptions.groom\")}</option>}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t(\"expensesPage.form.date\")}</label>\r\n              <input\r\n                type=\"date\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newExpense.date}\r\n                onChange={(e) => setNewExpense({ ...newExpense, date: e.target.value })}\r\n              />\r\n            </div>\r\n            <div className=\"col-span-2\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t(\"expensesPage.form.description\")}</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                value={newExpense.description}\r\n                onChange={(e) => setNewExpense({ ...newExpense, description: e.target.value })}\r\n                placeholder={t(\"expensesPage.form.placeholders.description\")}\r\n              />\r\n            </div>\r\n            <div className=\"col-span-2\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t(\"expensesPage.form.notes\")}</label>\r\n              <textarea\r\n                className=\"border border-gray-300 rounded px-3 py-2 w-full\"\r\n                rows={2}\r\n                value={newExpense.notes}\r\n                onChange={(e) => setNewExpense({ ...newExpense, notes: e.target.value })}\r\n                placeholder={t(\"expensesPage.form.placeholders.notes\")}\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"mt-4\">\r\n            <button\r\n              onClick={addExpense}\r\n              disabled={saving}\r\n              className=\"bg-[#A3B59D] text-white rounded-lg px-6 py-2 hover:bg-[#8a9d84] disabled:opacity-50\"\r\n            >\r\n              {saving ? t(\"loading\", { fallback: \"Salvataggio...\" }) : t(\"expensesPage.buttons.save\")}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Preventivi raggruppati per categoria */}\r\n      <div className=\"space-y-8\">\r\n        {orderedGroups.length === 0 ? (\r\n          <div className=\"p-10 text-center text-gray-400 rounded-2xl border border-gray-200 bg-white/70\">\r\n            {t(\"expensesPage.messages.none\")}\r\n          </div>\r\n        ) : (\r\n          orderedGroups.map((group, idx) => (\r\n            <div key={idx} className=\"rounded-2xl border border-gray-200 bg-white/70 shadow-sm overflow-hidden\">\r\n              {/* Header gruppo */}\r\n              <div className=\"bg-[#A3B59D]/10 px-6 py-3 border-b border-gray-200\">\r\n                <h3 className=\"font-semibold text-gray-800\">\r\n                  {group.category} â {group.subcategory}\r\n                </h3>\r\n                <div className=\"text-xs text-gray-600 mt-1\">\r\n                  {group.expenses.length} preventivo{group.expenses.length !== 1 ? \"i\" : \"\"}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tabella preventivi per questo gruppo (scroll orizzontale su mobile) */}\r\n              <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full min-w-[920px] text-sm\">\r\n                <thead>\r\n                  <tr className=\"border-b border-gray-100 bg-gray-50/50\">\r\n                    <th className=\"px-4 py-2 text-left font-medium text-gray-700\">{t(\"expensesPage.table.supplier\")}</th>\r\n                    <th className=\"px-4 py-2 text-left font-medium text-gray-700\">{t(\"expensesPage.table.description\")}</th>\r\n                    <th className=\"px-4 py-2 text-right font-medium text-gray-700\">{t(\"expensesPage.table.amount\")}</th>\r\n                    <th className=\"px-4 py-2 text-center font-medium text-gray-700\">{t(\"expensesPage.table.type\")}</th>\r\n                    <th className=\"px-4 py-2 text-center font-medium text-gray-700\">{t(\"expensesPage.table.date\")}</th>\r\n                    <th className=\"px-4 py-2 text-center font-medium text-gray-700\">{t(\"expensesPage.table.status\")}</th>\r\n                    <th className=\"px-4 py-2 text-center font-medium text-gray-700\">{t(\"expensesPage.table.fromQuote\")}</th>\r\n                    <th className=\"px-4 py-2 text-center font-medium text-gray-700\">{t(\"expensesPage.table.actions\")}</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {group.expenses.map((exp) => (\r\n                    <tr \r\n                      key={exp.id} \r\n                      className={`border-b border-gray-50 hover:bg-gray-50/60 ${\r\n                        exp.status === \"approved\" ? \"bg-green-50/30\" : \r\n                        exp.status === \"rejected\" ? \"bg-red-50/30\" : \"\"\r\n                      }`}\r\n                    >\r\n                      <td className=\"px-4 py-3 font-medium\">{exp.supplier || \"â\"}</td>\r\n                      <td className=\"px-4 py-3\">{exp.description || \"â\"}</td>\r\n                      <td className=\"px-4 py-3 text-right font-semibold\">{formatEuro(exp.amount)}</td>\r\n                      <td className=\"px-4 py-3 text-center capitalize text-xs\">\r\n                        {isBaptism ? t(\"expensesPage.spendType.common\") : (exp.spendType === \"common\" ? t(\"expensesPage.spendType.common\") : exp.spendType === \"bride\" ? t(\"expensesPage.spendType.bride\") : t(\"expensesPage.spendType.groom\"))}\r\n                      </td>\r\n                      <td className=\"px-4 py-3 text-center text-xs\">{formatDate(new Date(exp.date))}</td>\r\n                      <td className=\"px-4 py-3 text-center\">\r\n                        <span className={`inline-block px-2 py-1 rounded text-xs ${\r\n                          exp.status === \"approved\" ? \"bg-green-100 text-green-800 font-semibold\" :\r\n                          exp.status === \"rejected\" ? \"bg-red-100 text-red-800\" :\r\n                          \"bg-yellow-100 text-yellow-800\"\r\n                        }`}>\r\n                          {exp.status === \"approved\" ? t(\"expensesPage.status.approved\") : exp.status === \"rejected\" ? t(\"expensesPage.status.rejected\") : t(\"expensesPage.status.pending\")}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-3 text-center\">\r\n                        {exp.fromDashboard ? <span className=\"text-green-600 font-bold\">â</span> : \"â\"}\r\n                      </td>\r\n                      <td className=\"px-4 py-3 text-center\">\r\n                        {exp.status === \"pending\" && (\r\n                          <div className=\"flex gap-2 justify-center\">\r\n                            <button\r\n                              onClick={() => updateExpenseStatus(exp.id!, \"approved\")}\r\n                              className=\"text-green-600 hover:text-green-800 text-xs font-medium\"\r\n                            >\r\n                              {t(\"expensesPage.buttons.approve\")}\r\n                            </button>\r\n                            <button\r\n                              onClick={() => updateExpenseStatus(exp.id!, \"rejected\")}\r\n                              className=\"text-red-600 hover:text-red-800 text-xs font-medium\"\r\n                            >\r\n                              {t(\"expensesPage.buttons.reject\")}\r\n                            </button>\r\n                          </div>\r\n                        )}\r\n                        {exp.status === \"approved\" && (\r\n                          <span className=\"text-xs text-gray-400\">{t(\"expensesPage.messages.confirmed\")}</span>\r\n                        )}\r\n                        {exp.status === \"rejected\" && (\r\n                          <span className=\"text-xs text-gray-400\">{t(\"expensesPage.messages.discarded\")}</span>\r\n                        )}\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction formatEuro(n: number) {\r\n  return formatCurrency(n, \"EUR\", { minimumFractionDigits: 0, maximumFractionDigits: 0 });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\suggerimenti\\cose-matrimonio\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\suggerimenti\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\suggerimenti\\page.tsx:13:7\n  11 |     const country = typeof window !== 'undefined' ? (localStorage.getItem('country') || 'it') : 'it';\n  12 |     if (country === 'mx') {\n> 13 |       setSuggestions([\n     |       ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  14 |         'Ricorda di prenotare il Mariachi!',\n  15 |         'Verifica la disponibilitÃÂ  della location almeno 6 mesi prima.',\n  16 |         'Considera una fotocabina a tema per la festa.',","line":13,"column":7,"nodeType":null,"endLine":13,"endColumn":21},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":61,"column":31,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2339,2447],"text":"\r\n          Qui puoi caricare un&apos;immagine (abito, palette, location) per ricevere consigli mirati.\r\n        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2339,2447],"text":"\r\n          Qui puoi caricare un&lsquo;immagine (abito, palette, location) per ricevere consigli mirati.\r\n        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2339,2447],"text":"\r\n          Qui puoi caricare un&#39;immagine (abito, palette, location) per ricevere consigli mirati.\r\n        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2339,2447],"text":"\r\n          Qui puoi caricare un&rsquo;immagine (abito, palette, location) per ricevere consigli mirati.\r\n        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"ï»¿\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useTranslations } from \"next-intl\";\r\n\r\nexport default function SuggerimentiPage() {\r\n  const t = useTranslations();\r\n  const [suggestions, setSuggestions] = useState<string[]>([]);\r\n\r\n  useEffect(() => {\r\n    const country = typeof window !== 'undefined' ? (localStorage.getItem('country') || 'it') : 'it';\r\n    if (country === 'mx') {\r\n      setSuggestions([\r\n        'Ricorda di prenotare il Mariachi!',\r\n        'Verifica la disponibilitÃÂ  della location almeno 6 mesi prima.',\r\n        'Considera una fotocabina a tema per la festa.',\r\n        'Controlla i documenti legali richiesti in Messico.',\r\n      ]);\r\n    } else {\r\n      setSuggestions([\r\n        'Prenota il fotografo con largo anticipo.',\r\n        'Verifica la lista invitati e aggiorna le preferenze.',\r\n        'Controlla le tradizioni locali per arricchire la cerimonia.',\r\n      ]);\r\n    }\r\n  }, []);\r\n\r\n  return (\n    <section className=\"max-w-3xl mx-auto py-8 px-4\">\n      <h1 className=\"font-serif text-3xl mb-4 text-[#A3B59D] font-bold\">\n        {t('suggestions', { fallback: 'Suggerimenti & Consigli' })}\n      </h1>\n      <div className=\"mb-4 flex justify-end\">\r\n        <a href=\"/dashboard\" className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full border text-sm bg-white border-gray-300 hover:bg-gray-50\">Torna in Dashboard</a>\r\n      </div>\r\n      <div className=\"mb-6\">\r\n        <a\r\n          href=\"/chat-ia\"\r\n          className=\"inline-block px-4 py-2 rounded-full border text-sm bg-white border-gray-300 hover:bg-gray-50\"\r\n        >\r\n          Chatta con IA\r\n        </a>\r\n      </div>\r\n      <p className=\"mb-4 text-gray-700 text-base\">\n        Qui troverai consigli personalizzati in base alle scelte che stai facendo, al budget e ai documenti/foto caricati.\n      </p>\n      <ul className=\"space-y-4\">\r\n        {suggestions.map((s, i) => (\r\n          <li\r\n            key={i}\r\n            className=\"bg-white border-l-4 border-[#A3B59D] shadow rounded-xl p-4 text-gray-800 font-medium\"\r\n          >\r\n            {s}\r\n          </li>\r\n        ))}\r\n      </ul>\r\n\r\n      <div className=\"mt-8 p-6 rounded-2xl border-2 border-dashed border-[#A3B59D] bg-[#F7FBF7]\">\n        <h2 className=\"font-semibold text-lg mb-2\">Carica una foto</h2>\n        <p className=\"text-gray-700 mb-3\">\r\n          Qui puoi caricare un'immagine (abito, palette, location) per ricevere consigli mirati.\r\n        </p>\r\n        <label\r\n          className=\"inline-block px-4 py-2 rounded-full text-white cursor-pointer\"\r\n          style={{ background: \"var(--color-sage)\" }}\r\n        >\r\n          Seleziona file...\r\n          <input type=\"file\" accept=\"image/*\" className=\"hidden\" />\r\n        </label>\r\n      </div>\n    </section>\n  );\r\n}\r\n\r\n\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\suggerimenti\\viaggio-di-nozze\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\termini-servizio\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\timeline\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\twitter-image.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\wedding-planner\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPlanners'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [selectedRegion, selectedProvince, loadPlanners]","fix":{"range":[1654,1688],"text":"[selectedRegion, selectedProvince, loadPlanners]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport ImageCarousel from \"@/components/ImageCarousel\";\nimport { getUserCountrySafe } from \"@/constants/geo\";\nimport { getPageImages } from \"@/lib/pageImages\";\nimport Breadcrumb from \"@/components/Breadcrumb\";\n\r\ntype WeddingPlanner = {\r\n  id: string;\r\n  name: string;\r\n  region: string;\r\n  province: string;\r\n  city: string;\r\n  phone?: string;\r\n  email?: string;\r\n  website?: string;\r\n  description?: string;\r\n  price_range?: string;\r\n  services?: string; // es: \"Full planning, Partial planning, Consulenza\"\r\n  verified: boolean;\r\n  status: \"pending\" | \"approved\" | \"rejected\";\r\n};\r\n\r\nconst ITALIAN_REGIONS = [\r\n  \"Abruzzo\", \"Basilicata\", \"Calabria\", \"Campania\", \"Emilia-Romagna\",\r\n  \"Friuli-Venezia Giulia\", \"Lazio\", \"Liguria\", \"Lombardia\", \"Marche\",\r\n  \"Molise\", \"Piemonte\", \"Puglia\", \"Sardegna\", \"Sicilia\", \"Toscana\",\r\n  \"Trentino-Alto Adige\", \"Umbria\", \"Valle d'Aosta\", \"Veneto\"\r\n];\r\n\r\nexport default function WeddingPlannerPage() {\n  const country = getUserCountrySafe();\n  const [planners, setPlanners] = useState<WeddingPlanner[]>([]);\n  const [loading, setLoading] = useState(true);\r\n  const [selectedRegion, setSelectedRegion] = useState(\"\");\r\n  const [selectedProvince, setSelectedProvince] = useState(\"\");\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    region: \"\",\r\n    province: \"\",\r\n    city: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    website: \"\",\r\n    description: \"\",\r\n    price_range: \"\",\r\n    services: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadPlanners();\r\n  }, [selectedRegion, selectedProvince]);\r\n\r\n  async function loadPlanners() {\r\n    try {\r\n      setLoading(true);\r\n      const params = new URLSearchParams();\r\n      if (selectedRegion) params.append(\"region\", selectedRegion);\r\n      if (selectedProvince) params.append(\"province\", selectedProvince);\r\n\r\n      const res = await fetch(`/api/wedding-planner?${params.toString()}`);\r\n      const data = await res.json();\r\n      setPlanners(data.planners || []);\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n\r\n    try {\r\n      const res = await fetch(\"/api/wedding-planner\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      if (res.ok) {\r\n        alert(\"Wedding planner inviato! SarÃ  verificato prima della pubblicazione.\");\r\n        setFormData({\r\n          name: \"\",\r\n          region: \"\",\r\n          province: \"\",\r\n          city: \"\",\r\n          phone: \"\",\r\n          email: \"\",\r\n          website: \"\",\r\n          description: \"\",\r\n          price_range: \"\",\r\n          services: \"\",\r\n        });\r\n        setShowAddForm(false);\r\n        loadPlanners();\r\n      } else {\r\n        alert(\"Errore nell'invio\");\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Errore di rete\");\r\n    }\r\n  }\r\n\r\n  const approvedPlanners = planners.filter(p => p.status === \"approved\");\r\n\r\n  return (\r\n    <section className=\"pt-6\">\r\n      {/* Breadcrumb */}\r\n      <Breadcrumb\r\n        items={[\r\n          { label: \"ð  Home\", href: \"/\" },\r\n          { label: \"Fornitori\", href: \"/fornitori\" },\r\n          { label: \"Wedding Planner\" },\r\n        ]}\r\n      />\r\n\r\n      {/* Header con bottone Torna a Fornitori */}\r\n      <div className=\"flex items-start justify-between mb-4\">\r\n        <div className=\"flex-1\">\r\n          <h2 className=\"font-serif text-3xl mb-2\">Wedding Planner</h2>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Trova wedding planner verificati per organizzare il tuo matrimonio perfetto.\r\n            Puoi proporre nuovi professionisti che verranno verificati prima della pubblicazione.\r\n          </p>\r\n        </div>\r\n        <Link\r\n          href=\"/fornitori\"\r\n          className=\"ml-4 px-4 py-2 bg-white border-2 border-[#A3B59D] text-[#A3B59D] rounded-lg hover:bg-[#A3B59D] hover:text-white transition-colors font-semibold text-sm whitespace-nowrap\"\r\n        >\r\n          â Tutti i Fornitori\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Carosello immagini */}\r\n      <ImageCarousel images={getPageImages(\"wedding-planner\", country)} height=\"280px\" />\n\r\n      {/* Filtri */}\r\n      <div className=\"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Regione</label>\r\n          <select\r\n            className=\"w-full border border-gray-300 rounded-lg px-3 py-2\"\r\n            value={selectedRegion}\r\n            onChange={(e) => {\r\n              setSelectedRegion(e.target.value);\r\n              setSelectedProvince(\"\");\r\n            }}\r\n          >\r\n            <option value=\"\">Tutte le regioni</option>\r\n            {ITALIAN_REGIONS.map(r => (\r\n              <option key={r} value={r}>{r}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Provincia</label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"w-full border border-gray-300 rounded-lg px-3 py-2\"\r\n            placeholder=\"Es: Milano\"\r\n            value={selectedProvince}\r\n            onChange={(e) => setSelectedProvince(e.target.value)}\r\n          />\r\n        </div>\r\n        <div className=\"flex items-end\">\r\n          <button\r\n            onClick={() => setShowAddForm(!showAddForm)}\r\n            className=\"w-full bg-[#A3B59D] text-white rounded-lg px-4 py-2 hover:bg-[#8a9d84]\"\r\n          >\r\n            {showAddForm ? \"Annulla\" : \"+ Proponi un wedding planner\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Form aggiunta */}\r\n      {showAddForm && (\r\n        <div className=\"mb-6 p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm\">\r\n          <h3 className=\"font-semibold mb-4\">Proponi un nuovo wedding planner</h3>\r\n          <form onSubmit={handleSubmit}>\r\n            <div className=\"grid grid-cols-2 gap-4 mb-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Nome / Studio *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Regione *</label>\r\n                <select\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.region}\r\n                  onChange={(e) => setFormData({ ...formData, region: e.target.value })}\r\n                >\r\n                  <option value=\"\">Seleziona...</option>\r\n                  {ITALIAN_REGIONS.map(r => (\r\n                    <option key={r} value={r}>{r}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Provincia *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.province}\r\n                  onChange={(e) => setFormData({ ...formData, province: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">CittÃ  *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.city}\r\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Telefono</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.phone}\r\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email</label>\r\n                <input\r\n                  type=\"email\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  value={formData.email}\r\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Sito web</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"https://...\"\r\n                  value={formData.website}\r\n                  onChange={(e) => setFormData({ ...formData, website: e.target.value })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Fascia di prezzo</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"Es: â¬â¬-â¬â¬â¬\"\r\n                  value={formData.price_range}\r\n                  onChange={(e) => setFormData({ ...formData, price_range: e.target.value })}\r\n                />\r\n              </div>\r\n              <div className=\"col-span-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Servizi offerti</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  placeholder=\"Es: Full planning, Partial planning, Consulenza giorno\"\r\n                  value={formData.services}\r\n                  onChange={(e) => setFormData({ ...formData, services: e.target.value })}\r\n                />\r\n              </div>\r\n              <div className=\"col-span-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Descrizione</label>\r\n                <textarea\r\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n                  rows={3}\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                />\r\n              </div>\r\n            </div>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"bg-[#A3B59D] text-white rounded-lg px-6 py-2 hover:bg-[#8a9d84]\"\r\n            >\r\n              Invia per approvazione\r\n            </button>\r\n          </form>\r\n        </div>\r\n      )}\r\n\r\n      {/* Risultati */}\r\n      {loading ? (\r\n        <div className=\"text-gray-500\">Caricamento...</div>\r\n      ) : approvedPlanners.length === 0 ? (\r\n        <div className=\"p-10 text-center text-gray-400 rounded-2xl border border-gray-200 bg-white/70\">\r\n          Nessun wedding planner trovato per i filtri selezionati\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          {approvedPlanners.map((planner) => (\r\n            <div\r\n              key={planner.id}\r\n              className=\"p-6 rounded-2xl border border-gray-200 bg-white/70 shadow-sm hover:shadow-md transition-shadow\"\r\n            >\r\n              <div className=\"flex items-start justify-between mb-3\">\r\n                <h3 className=\"font-semibold text-lg\">{planner.name}</h3>\r\n                {planner.verified && (\r\n                  <span className=\"bg-green-100 text-green-700 text-xs px-2 py-1 rounded\">â Verificato</span>\r\n                )}\r\n              </div>\r\n              <div className=\"text-sm text-gray-600 space-y-1 mb-3\">\r\n                <div>ð {planner.city}, {planner.province} ({planner.region})</div>\r\n                {planner.phone && <div>ð {planner.phone}</div>}\r\n                {planner.email && <div>ð§ {planner.email}</div>}\r\n                {planner.website && (\r\n                  <div>\r\n                    ð <a href={planner.website} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-[#A3B59D] hover:underline\">\r\n                      {planner.website}\r\n                    </a>\r\n                  </div>\r\n                )}\r\n                {planner.price_range && <div>ð° {planner.price_range}</div>}\r\n                {planner.services && <div>ð¯ {planner.services}</div>}\r\n              </div>\r\n              {planner.description && (\r\n                <p className=\"text-sm text-gray-700 mt-2\">{planner.description}</p>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\progetti\\Progetti\\il-budget-degli-sposi\\src\\app\\welcome\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]